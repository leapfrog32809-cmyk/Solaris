<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>Solar System Logic Mission</title>

  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-space: #020310;
      --accent: #ffd700;
      --accent-soft: rgba(255, 215, 0, 0.2);
      --accent-glow: rgba(255, 215, 0, 0.4);
      --card-bg: rgba(7, 11, 30, 0.92);
      --text-main: #f5f7ff;
      --text-muted: #a4b0d0;
      --error: #ff5577;
      --success: #4ade80;
      --orbit-color: rgba(255, 255, 255, 0.1);
      --transition-fast: 0.35s ease-out;
      --transition-med: 0.6s ease-in-out;
      --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.5);
      --shadow-glow: 0 0 30px rgba(255, 215, 0, 0.3);
      --radius-card: 18px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: "Poppins", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: url("starfield.jpg") center/cover fixed no-repeat, #020310;
      color: var(--text-main);
      height: 100vh;
      height: 100dvh;
      width: 100vw;
      overflow: hidden; /* Prevent scrolling on body, handle inside app-shell */
      display: flex;
      align-items: center;
      justify-content: center;
    }

    body.top-down-view {
      background-image: url("nebula.jpg");
      background-size: cover;
      background-position: center;
    }

    .app-shell {
      width: 100%;
      height: 100%;
      position: relative;
      overflow: hidden;
      padding: 16px;
      display: flex;
      flex-direction: column;
    }

    .frame {
      flex: 1;
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
      border-radius: 26px;
      border: 1.5px solid rgba(255, 215, 0, 0.2);
      box-shadow: 0 22px 55px rgba(0, 0, 0, 0.7), 0 0 40px rgba(255, 215, 0, 0.15);
      backdrop-filter: blur(16px);
      background:
        url("asteroidbelt1.jpg") center/cover no-repeat,
        radial-gradient(circle at top left, rgba(108, 122, 255, 0.15), transparent 55%),
        radial-gradient(circle at bottom right, rgba(255, 215, 0, 0.12), transparent 55%),
        rgba(0, 0, 10, 0.96);
      display: grid;
      grid-template-rows: auto 1fr auto;
      position: relative;
      overflow: hidden;
    }

    /* Mobile handling for frame */
    @media (max-width: 640px) {
      .app-shell {
        padding: 0;
      }
      .frame {
        border-radius: 0;
        border: none;
        border-bottom: 1px solid rgba(255, 215, 0, 0.2);
      }
    }

    header.app-header {
      padding: 16px 22px 8px;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      z-index: 40;
      background: linear-gradient(135deg, rgba(30, 45, 100, 0.15), rgba(15, 25, 60, 0.1));
      border-bottom: 1px solid rgba(255, 215, 0, 0.1);
      flex-shrink: 0;
    }

    .btn-ghost {
      border-radius: 999px;
      padding: 8px 14px;
      border: 1.5px solid rgba(255, 215, 0, 0.3);
      background: radial-gradient(circle at top, rgba(255, 255, 255, 0.15), transparent 60%),
                  rgba(5, 10, 32, 0.85);
      color: var(--text-main);
      cursor: pointer;
      font-size: 0.78rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s ease-out;
      z-index: 100;
    }

    .btn-ghost:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.4), 0 0 20px rgba(255, 215, 0, 0.2);
      background: radial-gradient(circle at top, rgba(255, 255, 255, 0.3), transparent 60%),
                  rgba(10, 18, 54, 0.95);
    }

    .btn-ghost[aria-pressed="true"] {
      border-color: var(--accent);
      background: radial-gradient(circle at top, rgba(255, 215, 0, 0.5), transparent 60%),
                  rgba(40, 30, 0, 0.98);
      box-shadow: 0 0 25px rgba(255, 215, 0, 0.25);
    }

    main.stage {
      position: relative;
      overflow: hidden;
      width: 100%;
      height: 100%;
      /* Center content */
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Solar system scene */
    .solar-system-wrapper {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      perspective: 1200px;
      overflow: hidden;
    }

    .solar-system {
      position: relative;
      /* Fixed base size - we scale this entire div via JS to fit the screen */
      width: 1000px; 
      height: 1000px;
      transform-style: flat;
      transition: opacity var(--transition-med), filter var(--transition-med);
      /* Initial scale, overridden by JS */
      transform: scale(1);
      flex-shrink: 0;
    }

    .solar-system.dimmed {
      opacity: 0.18;
      filter: blur(3px);
    }

    .starfield, .deep-stars, .galaxy-clouds, .nebula-overlay, .dust-particles {
      position: absolute;
      inset: -50%; /* Make larger to cover scaling */
      width: 200%;
      height: 200%;
      pointer-events: none;
    }

    .nebula-overlay {
      background: 
        radial-gradient(circle at 30% 40%, rgba(120, 50, 200, 0.08), transparent 45%),
        radial-gradient(circle at 70% 60%, rgba(50, 100, 255, 0.06), transparent 45%),
        radial-gradient(circle at 50% 10%, rgba(200, 50, 100, 0.05), transparent 50%);
      filter: blur(80px);
      animation: nebula-pulse 30s ease-in-out infinite alternate;
      z-index: -1;
    }

    @keyframes nebula-pulse {
      0% { opacity: 0.4; transform: scale(1); }
      100% { opacity: 0.7; transform: scale(1.1); }
    }

    .dust-particles {
      background-image: 
        radial-gradient(circle, rgba(255, 255, 255, 0.15) 1px, transparent 1px),
        radial-gradient(circle, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
      background-size: 300px 300px, 500px 500px;
      background-position: 0 0, 100px 100px;
      animation: dust-drift 120s linear infinite;
      opacity: 0.5;
    }

    @keyframes dust-drift {
      0% { transform: translate(0, 0); }
      100% { transform: translate(-100px, -50px); }
    }

    .deep-stars {
      background-image: 
        radial-gradient(1px 1px at 10% 15%, rgba(255,255,255,0.4), transparent),
        radial-gradient(1px 1px at 25% 45%, rgba(255,255,255,0.3), transparent),
        radial-gradient(2px 2px at 50% 20%, rgba(255,255,255,0.2), transparent),
        radial-gradient(1px 1px at 75% 65%, rgba(255,255,255,0.3), transparent),
        radial-gradient(2px 2px at 90% 10%, rgba(255,255,255,0.25), transparent);
      background-size: 400px 400px;
      opacity: 0.6;
    }

    .galaxy-clouds {
      background-image: 
        radial-gradient(circle at 20% 20%, rgba(68, 0, 255, 0.08) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(255, 0, 100, 0.06) 0%, transparent 50%),
        radial-gradient(circle at 50% 50%, rgba(0, 255, 200, 0.04) 0%, transparent 60%);
      filter: blur(50px);
      animation: pulse-galaxy 25s ease-in-out infinite alternate;
    }

    @keyframes pulse-galaxy {
      0% { opacity: 0.5; transform: scale(1); }
      100% { opacity: 0.8; transform: scale(1.05); }
    }

    .starfield {
      background-image:
        radial-gradient(circle at 10% 20%, rgba(255, 255, 255, 0.9) 1px, transparent 1px),
        radial-gradient(circle at 80% 30%, rgba(255, 255, 255, 0.8) 1px, transparent 1px),
        radial-gradient(circle at 40% 80%, rgba(255, 255, 255, 0.85) 1px, transparent 1px),
        radial-gradient(circle at 15% 50%, rgba(255, 255, 255, 0.7) 1.5px, transparent 1.5px),
        radial-gradient(circle at 85% 90%, rgba(255, 255, 255, 0.7) 1.5px, transparent 1.5px);
      background-size: 350px 350px;
      opacity: 0.9;
      mix-blend-mode: screen;
      animation: twinkle-stars 10s ease-in-out infinite alternate;
    }

    @keyframes twinkle-stars {
      0% { opacity: 0.75; }
      100% { opacity: 0.95; }
    }
    
    /* Asteroid Belt */
    .asteroid-belt {
      position: absolute;
      top: 50%; left: 50%;
      width: 500px; height: 500px;
      transform: translate(-50%, -50%);
      border-radius: 50%;
      pointer-events: none;
      z-index: 1;
    }
    
    .asteroid-belt::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 50%;
        background-image: 
            radial-gradient(1px 1px at 15% 15%, #999, transparent),
            radial-gradient(1px 1px at 35% 55%, #888, transparent),
            radial-gradient(1.5px 1.5px at 65% 25%, #aaa, transparent),
            radial-gradient(1px 1px at 85% 75%, #777, transparent);
        background-size: 60px 60px;
        animation: asteroid-spin 180s linear infinite reverse;
        opacity: 0.5;
        mask-image: radial-gradient(closest-side, transparent 78%, black 82%, black 88%, transparent 92%);
        -webkit-mask-image: radial-gradient(closest-side, transparent 78%, black 82%, black 88%, transparent 92%);
    }

    .asteroid-belt::after {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 50%;
        background-image: 
            radial-gradient(1.5px 1.5px at 10% 10%, #887, transparent),
            radial-gradient(1.5px 1.5px at 20% 30%, #776, transparent),
            radial-gradient(2px 2px at 40% 40%, #998, transparent),
            radial-gradient(1.5px 1.5px at 60% 20%, #887, transparent),
            radial-gradient(1.5px 1.5px at 80% 80%, #776, transparent),
            radial-gradient(2px 2px at 50% 90%, #998, transparent);
        background-size: 80px 80px;
        animation: asteroid-spin 120s linear infinite;
        opacity: 0.7;
        mask-image: radial-gradient(closest-side, transparent 78%, black 82%, black 88%, transparent 92%);
        -webkit-mask-image: radial-gradient(closest-side, transparent 78%, black 82%, black 88%, transparent 92%);
    }

    @keyframes asteroid-spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    /* Comets */
    .comet-container {
        position: absolute;
        inset: -50%;
        width: 200%; height: 200%;
        pointer-events: none;
        z-index: 0;
    }
    
    .comet {
        position: absolute;
        width: 3px; height: 3px;
        background: #fff;
        border-radius: 50%;
        box-shadow: 0 0 8px #fff;
        opacity: 0;
    }
    
    .comet::after {
        content: "";
        position: absolute;
        top: 50%; right: 0;
        width: 80px; height: 1px;
        background: linear-gradient(to left, rgba(255,255,255,0.6), transparent);
        transform: translateY(-50%);
    }
    
    .comet.one { top: 15%; left: -10%; animation: shoot 18s linear infinite 5s; }
    .comet.two { top: 70%; left: -10%; animation: shoot 25s linear infinite 15s; }
    
    /* Far Galaxies */
    .far-galaxy {
      position: absolute;
      pointer-events: none;
      z-index: -1;
      opacity: 0.6;
      filter: blur(1px);
    }

    .far-galaxy.one {
      top: 12%; left: 75%;
      width: 140px; height: 60px;
      background: radial-gradient(ellipse at center, rgba(180, 200, 255, 0.3), transparent 70%);
      transform: rotate(20deg);
      border-radius: 50%;
    }
    
    .far-galaxy.one::after {
      content: "";
      position: absolute;
      top: 50%; left: 50%;
      width: 60%; height: 20%;
      background: rgba(255, 255, 255, 0.4);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
    }

    .far-galaxy.two {
      bottom: 15%; left: 10%;
      width: 100px; height: 100px;
      background: radial-gradient(circle at center, rgba(255, 100, 150, 0.15), transparent 70%);
      animation: galaxy-spin 200s linear infinite;
    }

    .far-galaxy.two::after {
      content: "";
      position: absolute;
      inset: 0;
      background: 
        radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.3) 1px, transparent 1px),
        radial-gradient(circle at 70% 70%, rgba(255, 255, 255, 0.3) 1px, transparent 1px);
      background-size: 20px 20px;
      transform: rotate(45deg);
    }

    @keyframes galaxy-spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    @keyframes shoot {
        0% { transform: translateX(0) translateY(0) rotate(20deg); opacity: 0; }
        5% { opacity: 1; }
        20% { transform: translateX(120vw) translateY(40vh) rotate(20deg); opacity: 0; }
        100% { opacity: 0; }
    }

    .orbit {
      position: absolute;
      border-radius: 50%;
      border: 2.5px solid rgba(100, 180, 255, 0.45);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none;
      box-shadow: 0 0 8px rgba(100, 180, 255, 0.35);
      will-change: transform;
    }

    .orbit.animate {
      animation: orbit-rotate 60s linear infinite; /* Slowed down slightly for mobile readability */
      transform-origin: center center;
    }

    @keyframes orbit-rotate {
      from { transform: translate(-50%, -50%) rotateZ(0deg); }
      to { transform: translate(-50%, -50%) rotateZ(360deg); }
    }

    .star {
      position: absolute;
      width: 110px;
      height: 110px;
      border-radius: 50%;
      background: radial-gradient(circle at 20% 15%, #ffffff, #ffd36a 40%, #ff9b21 70%, rgba(0, 0, 0, 0) 72%),
                  url("Textures/sun.jpg") center/cover no-repeat;
      box-shadow:
        0 0 50px rgba(255, 150, 40, 1),
        0 0 100px rgba(255, 100, 20, 0.8);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      cursor: pointer;
      z-index: 4;
      transition: all 0.25s ease-out;
    }

    .star::after {
      content: "Click to start";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      white-space: nowrap;
      font-size: 0.9rem;
      font-weight: 700;
      text-transform: uppercase;
      color: rgba(60, 20, 0, 0.8);
      text-shadow: 0 1px 0 rgba(255,255,255,0.4);
      pointer-events: none;
    }

    .star:active {
      transform: translate(-50%, -50%) scale(0.95);
    }

    .planet {
      position: absolute;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      box-shadow: 0 0 10px rgba(100, 180, 255, 0.4);
      transform: translate(-50%, -50%);
      transition: box-shadow 0.3s, filter 0.3s, width 0.3s, height 0.3s;
      /* Ensure clickable area is decent */
      cursor: pointer;
    }

    /* Invisible hit area expansion for mobile */
    .planet::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 40px; /* Minimum touch target size */
      height: 40px;
      border-radius: 50%;
      z-index: -1;
    }

    .planet::after {
      content: attr(data-name);
      position: absolute;
      top: 120%;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.9rem; /* Increased for legibility */
      font-weight: 600;
      color: var(--text-main);
      text-shadow: 0 0 4px #000;
      pointer-events: none;
      white-space: nowrap;
      opacity: 0.8;
    }

    .planet.mercury { width: 14px; height: 14px; background-color: #888; background-image: url("Textures/mercury.jpg"); }
    .planet.venus   { width: 22px; height: 22px; background-color: #e3bb76; background-image: url("Textures/venus.jpg"); }
    .planet.earth   { width: 24px; height: 24px; background-color: #22aaff; background-image: url("Textures/earth.jpg"); }
    .planet.mars    { width: 18px; height: 18px; background-color: #dd4422; background-image: url("Textures/mars.jpg"); }
    .planet.jupiter { width: 50px; height: 50px; background-color: #d8ca9d; background-image: url("Textures/jupiter.jpg"); }
    .planet.saturn  { width: 42px; height: 42px; background-color: #ead6b8; background-image: url("Textures/saturn.jpg"); }
    .planet.uranus  { width: 32px; height: 32px; background-color: #d1e7e7; background-image: url("Textures/uranus.jpg"); }
    .planet.neptune { width: 30px; height: 30px; background-color: #5b5ddf; background-image: url("Textures/neptune.jpg"); }

    /* Saturn Ring visual */
    .planet.saturn::before {
      content: "";
      position: absolute;
      top: 50%; left: 50%;
      width: 180%; height: 50%;
      transform: translate(-50%, -50%) rotate(-15deg);
      border-radius: 50%;
      border: 4px solid rgba(219, 204, 170, 0.6);
      pointer-events: none;
      z-index: -1;
    }

    .planet.highlighted {
      box-shadow: 0 0 25px rgba(255, 255, 255, 0.9);
      filter: brightness(1.3);
      z-index: 10;
    }

    /* Fixed Orbit Sizes (Logic coordinates match these) */
    .orbit.mercury { width: 160px; height: 160px; }
    .orbit.venus   { width: 220px; height: 220px; }
    .orbit.earth   { width: 290px; height: 290px; }
    .orbit.mars    { width: 360px; height: 360px; }
    .orbit.jupiter { width: 520px; height: 520px; }
    .orbit.saturn  { width: 620px; height: 620px; }
    .orbit.uranus  { width: 720px; height: 720px; }
    .orbit.neptune { width: 820px; height: 820px; }

    /* Overlays (Quiz, Summary, Countdown) */
    .overlay, .quiz-wrapper, .summary-wrapper {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.85);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
      z-index: 60;
      padding: 16px;
      overflow-y: auto; /* Allow scrolling within overlays */
    }

    .visible {
      opacity: 1;
      pointer-events: auto;
    }

    .countdown-panel, .quiz-card, .summary-card {
      background: var(--card-bg);
      border: 1px solid var(--accent-soft);
      border-radius: var(--radius-card);
      padding: 20px;
      max-width: 600px;
      width: 100%;
      box-shadow: 0 0 30px rgba(0,0,0,0.5);
      position: relative;
    }

    /* Quiz Layout */
    .quiz-card {
      max-height: 90vh;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 16px;
      /* Base background style */
      background-color: var(--card-bg);
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      /* Smooth transition when planet changes */
      transition: background-image 0.5s ease-in-out;
    }
    
    /* Planet-specific backgrounds with dark overlay for readability */
    .quiz-card[data-planet="Mercury"] { background-image: linear-gradient(rgba(7,11,30,0.88), rgba(7,11,30,0.94)), url("Textures/mercury.jpg"); }
    .quiz-card[data-planet="Venus"]   { background-image: linear-gradient(rgba(7,11,30,0.88), rgba(7,11,30,0.94)), url("Textures/venus.jpg"); }
    .quiz-card[data-planet="Earth"]   { background-image: linear-gradient(rgba(7,11,30,0.88), rgba(7,11,30,0.94)), url("Textures/earth.jpg"); }
    .quiz-card[data-planet="Mars"]    { background-image: linear-gradient(rgba(7,11,30,0.88), rgba(7,11,30,0.94)), url("Textures/mars.jpg"); }
    .quiz-card[data-planet="Jupiter"] { background-image: linear-gradient(rgba(7,11,30,0.88), rgba(7,11,30,0.94)), url("Textures/jupiter.jpg"); }
    .quiz-card[data-planet="Saturn"]  { background-image: linear-gradient(rgba(7,11,30,0.88), rgba(7,11,30,0.94)), url("Textures/saturn.jpg"); }
    .quiz-card[data-planet="Uranus"]  { background-image: linear-gradient(rgba(7,11,30,0.88), rgba(7,11,30,0.94)), url("Textures/uranus.jpg"); }
    .quiz-card[data-planet="Neptune"] { background-image: linear-gradient(rgba(7,11,30,0.88), rgba(7,11,30,0.94)), url("Textures/neptune.jpg"); }

    .truth-table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      overflow: hidden;
      font-size: 0.9rem;
    }
    
    .truth-table th, .truth-table td {
      padding: 10px;
      border: 1px solid rgba(255,255,255,0.1);
      text-align: left;
    }
    
    .truth-table th { background: rgba(255,255,255,0.05); }

    .answer-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn-answer {
      flex: 1;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid var(--accent);
      background: rgba(255, 215, 0, 0.1);
      color: var(--accent);
      font-weight: bold;
      cursor: pointer;
      min-width: 80px;
    }

    .btn-answer:hover { background: var(--accent); color: #000; }
    .btn-answer:disabled { opacity: 0.5; pointer-events: none; }

    .btn-next {
      background: var(--accent);
      color: #000;
      border: none;
      padding: 12px 24px;
      border-radius: 99px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
      margin-top: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .btn-next:disabled { background: #555; color: #999; }

    .btn-outline {
      background: transparent;
      border: 1px solid white;
      color: white;
      padding: 10px 20px;
      border-radius: 99px;
      cursor: pointer;
      margin: 5px;
    }

    .btn-outline:hover { background: rgba(255,255,255,0.1); }

    .quiz-meta {
      background: rgba(255,255,255,0.05);
      padding: 15px;
      border-radius: 12px;
      margin-top: 10px;
    }
    
    .hidden { display: none; }

    .answer-status {
      font-weight: bold;
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
      text-align: center;
    }
    .answer-status.correct { background: rgba(74, 222, 128, 0.2); color: var(--success); }
    .answer-status.incorrect { background: rgba(255, 85, 119, 0.2); color: var(--error); }

    footer.app-footer {
      padding: 10px;
      font-size: 0.7rem;
      color: var(--text-muted);
      text-align: center;
      background: rgba(0,0,0,0.4);
      flex-shrink: 0;
    }

    /* Mobile Text Sizes */
    @media (max-width: 480px) {
      .countdown-number { font-size: 3rem; color: var(--accent); }
      .quiz-card { padding: 15px; }
      .planet::after { font-size: 0.8rem; top: 115%; }
    }

  </style>
</head>
<body>
  <div class="app-shell">
    <div class="frame">
      <header class="app-header">
        <button id="musicToggle" class="btn-ghost" type="button" aria-pressed="true">
          <span>Mute</span>
        </button>
      </header>

      <main class="stage">
        <div class="solar-system-wrapper" id="sceneWrapper">
          <div id="solarSystem" class="solar-system">
            <div class="nebula-overlay"></div>
            <div class="galaxy-clouds"></div>
            <div class="far-galaxy one"></div>
            <div class="far-galaxy two"></div>
            <div class="deep-stars"></div>
            <div class="starfield"></div>
            <div class="dust-particles"></div>
            
            <div class="comet-container">
              <div class="comet one"></div>
              <div class="comet two"></div>
            </div>
            
            <!-- Orbits -->
            <div class="orbit mercury animate"></div>
            <div class="orbit venus animate"></div>
            <div class="orbit earth animate"></div>
            <div class="orbit mars animate"></div>
            <div class="asteroid-belt animate"></div>
            <div class="orbit jupiter animate"></div>
            <div class="orbit saturn animate"></div>
            <div class="orbit uranus animate"></div>
            <div class="orbit neptune animate"></div>

            <!-- Sun -->
            <div id="sun" class="star" role="button" aria-label="Click the Sun to start mission"></div>

            <!-- Planets -->
            <div class="planet mercury orbiting" data-name="Mercury" data-planet-index="0"></div>
            <div class="planet venus orbiting" data-name="Venus" data-planet-index="1"></div>
            <div class="planet earth orbiting" data-name="Earth" data-planet-index="2"></div>
            <div class="planet mars orbiting" data-name="Mars" data-planet-index="3"></div>
            <div class="planet jupiter orbiting" data-name="Jupiter" data-planet-index="4"></div>
            <div class="planet saturn orbiting" data-name="Saturn" data-planet-index="5"></div>
            <div class="planet uranus orbiting" data-name="Uranus" data-planet-index="6"></div>
            <div class="planet neptune orbiting" data-name="Neptune" data-planet-index="7"></div>
          </div>
        </div>

        <!-- Countdown overlay -->
        <div id="countdownOverlay" class="overlay" aria-hidden="true">
          <div class="countdown-panel">
            <h2 style="font-size: 1.5rem; margin-bottom:10px;">Ready?</h2>
            <div id="countdownNumber" class="countdown-number" style="font-size:3rem; font-weight:bold; color:var(--accent);">5</div>
            <p style="color:var(--text-muted); margin:10px 0;">Your logic mission begins in:</p>
            <ul id="countdownFacts" style="text-align:left; font-size:0.9rem; padding-left:20px; line-height:1.5;"></ul>
          </div>
        </div>

        <!-- Quiz card -->
        <div id="quizWrapper" class="quiz-wrapper" aria-hidden="true">
          <article id="quizCard" class="quiz-card" data-planet="">
            <div class="quiz-badge-row" style="display:flex; justify-content:space-between; margin-bottom:10px; color:var(--text-muted); font-size:0.8rem;">
              <span>LOGIC MODULE</span>
              <span>Planet <span id="quizPlanetName" style="color:var(--accent)"></span></span>
            </div>
            
            <div class="quiz-question-heading" id="questionText" style="font-weight:600; margin-bottom:10px;"></div>

            <table class="truth-table">
              <thead>
                <tr>
                  <th style="width: 75%;">Proposition</th>
                  <th style="width: 25%;">Truth</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td id="truthFactCell"></td>
                  <td id="truthAnswerCell" style="text-align:center; font-weight:bold; color:var(--accent);">?</td>
                </tr>
              </tbody>
            </table>

            <div class="answer-buttons">
              <button id="btnTrue" class="btn-answer" type="button">True (T)</button>
              <button id="btnFalse" class="btn-answer" type="button">False (F)</button>
            </div>
            
            <div id="answerStatus" class="answer-status"></div>

            <div class="quiz-meta hidden" id="quizMeta">
              <h3 style="font-size:0.9rem; color:var(--accent); margin-bottom:5px;">Explanation</h3>
              <p id="explanationText" style="font-size:0.85rem; margin-bottom:10px;"></p>
              
              <h3 style="font-size:0.9rem; color:var(--accent); margin-bottom:5px;">Did you know?</h3>
              <p id="planetFactText" style="font-size:0.85rem;"></p>
              
              <div style="margin-top:15px; display:flex; flex-direction:column; gap:5px;">
                <span id="progressText" style="font-size:0.7rem; color:var(--text-muted); text-align:center;">Planet 1 of 8</span>
                <button id="btnNext" class="btn-next" type="button" disabled>Next Planet</button>
              </div>
            </div>
          </article>
        </div>

        <!-- Summary -->
        <div id="summaryWrapper" class="summary-wrapper" aria-hidden="true">
          <section class="summary-card" style="text-align:center;">
            <h2 style="font-size: 1.5rem; margin-bottom:10px;">Mission Complete</h2>
            <div id="summaryScore" style="font-size: 3rem; font-weight:700; color:var(--accent);"></div>
            <p id="summaryDetail" style="color:var(--text-muted); margin:10px 0;"></p>
            <div style="display:flex; justify-content:center; gap:10px; margin:15px 0; font-size:0.9rem;">
              <span id="summaryAccuracy" style="background:rgba(255,255,255,0.1); padding:5px 10px; border-radius:99px;"></span>
              <span id="summaryTier" style="background:rgba(255,255,255,0.1); padding:5px 10px; border-radius:99px;"></span>
            </div>
            <div class="summary-actions">
              <button id="btnRestart" class="btn-outline" type="button">Run Again</button>
              <button id="btnVisitSite" class="btn-outline" type="button" style="border-color:var(--accent); color:var(--accent);">Back to Main Site</button>
            </div>
          </section>
        </div>

        <!-- Audio -->
        <audio id="bgMusic" loop>
          <source src="bg/Alpha(1).mp4" type="audio/mp4" />
        </audio>
      </main>

      <footer class="app-footer">
        <div>Side-on view &rarr; Top-down logic view</div>
        <div>Based on NASA educational resources.</div>
      </footer>
    </div>
  </div>

  <script>
    (function () {
      // --- DATA ---
      const planetQuestionsBank = {
        Mercury: [
          {
            question: "Statement P: Mercury has a thick atmosphere.\nStatement Q: Mercury has extreme temperature variations.\n\nEvaluate: ¬P ∧ Q",
            p: "Mercury does NOT have a thick atmosphere", q: "Mercury has extreme temperature variations",
            pValue: true, qValue: true, correctIsTrue: true,
            explanation: "Mercury possesses a thin exosphere. Day: 800°F, Night: -290°F. Both statements are effectively true.",
            funFact: "Mercury has the most extreme temperature swings in the solar system."
          },
          {
            question: "Statement P: Mercury is closest to the Sun.\nStatement Q: Mercury is the hottest planet.\n\nEvaluate: P ∧ Q",
            p: "Closest to Sun", q: "Hottest planet",
            pValue: true, qValue: false, correctIsTrue: false,
            explanation: "Venus is hotter due to atmosphere. P is True, Q is False.",
            funFact: "Venus is hotter than Mercury despite being farther away."
          }
        ],
        Venus: [
          {
            question: "Statement P: Venus rotates clockwise (retrograde).\nStatement Q: A day on Venus is shorter than a year on Venus.\n\nEvaluate: P ∧ Q",
            pValue: true, qValue: false, correctIsTrue: false,
            explanation: "Venus rotates backwards (P=True), but very slowly. Its day (243 Earth days) is longer than its year (225 Earth days) (Q=False).",
            funFact: "Venus is the only planet where a day is longer than a year."
          }
        ],
        Earth: [
          {
            question: "Statement P: Earth has liquid water.\nStatement Q: Earth has two moons.\n\nEvaluate: P → Q",
            pValue: true, qValue: false, correctIsTrue: false,
            explanation: "Earth has water (True), but only one moon (False). True → False is False.",
            funFact: "Earth is the only planet known to harbor life."
          }
        ],
        Mars: [
          {
            question: "Statement P: Mars is the Red Planet.\nStatement Q: Mars has two moons.\n\nEvaluate: P ∧ Q",
            pValue: true, qValue: true, correctIsTrue: true,
            explanation: "Mars appears red due to iron oxide. It has two moons: Phobos and Deimos.",
            funFact: "Mars is home to Olympus Mons, the tallest volcano in the solar system."
          }
        ],
        Jupiter: [
          {
            question: "Statement P: Jupiter is the largest planet.\nStatement Q: Jupiter has a solid surface.\n\nEvaluate: P ∧ Q",
            pValue: true, qValue: false, correctIsTrue: false,
            explanation: "Jupiter is the largest (True), but it is a gas giant with no true solid surface (False).",
            funFact: "Jupiter's mass is more than twice that of all other planets combined."
          }
        ],
        Saturn: [
          {
            question: "Statement P: Saturn is the only planet with rings.\nStatement Q: Saturn is a gas giant.\n\nEvaluate: P → Q",
            pValue: false, qValue: true, correctIsTrue: true, // F -> T is True
            explanation: "Jupiter, Uranus, and Neptune also have rings (P=False). Saturn is a gas giant (Q=True).",
            funFact: "Saturn is the only planet that is less dense than water."
          }
        ],
        Uranus: [
          {
            question: "Statement P: Uranus is the hottest planet.\nStatement Q: Uranus has no rings.\n\nEvaluate: P ∨ Q",
            pValue: false, qValue: false, correctIsTrue: false,
            explanation: "Uranus is an ice giant (very cold, P=False) and it DOES have rings (Q=False).",
            funFact: "Uranus was the first planet found with the aid of a telescope."
          }
        ],
        Neptune: [
          {
            question: "Statement P: Neptune is visible to the naked eye.\nStatement Q: Neptune has strong winds.\n\nEvaluate: ¬P ∧ Q",
            pValue: false, qValue: true, correctIsTrue: true,
            explanation: "Neptune is too far to be seen without a telescope (P=False). Its winds reach 1,200 mph (Q=True).",
            funFact: "Neptune was the first planet located through mathematical calculations."
          }
        ]
      };

      // --- SETUP ---
      function getRandomQuestion(planetName) {
        const questions = planetQuestionsBank[planetName] || planetQuestionsBank["Mercury"]; // Fallback
        return questions[Math.floor(Math.random() * questions.length)];
      }

      const planets = [
        { name: "Mercury", ...getRandomQuestion("Mercury") },
        { name: "Venus", ...getRandomQuestion("Venus") },
        { name: "Earth", ...getRandomQuestion("Earth") },
        { name: "Mars", ...getRandomQuestion("Mars") },
        { name: "Jupiter", ...getRandomQuestion("Jupiter") },
        { name: "Saturn", ...getRandomQuestion("Saturn") },
        { name: "Uranus", ...getRandomQuestion("Uranus") },
        { name: "Neptune", ...getRandomQuestion("Neptune") }
      ];

      // --- DOM ELEMENTS ---
      const solarSystemEl = document.getElementById("solarSystem");
      const sceneWrapper = document.getElementById("sceneWrapper");
      const sunEl = document.getElementById("sun");
      const countdownOverlay = document.getElementById("countdownOverlay");
      const countdownNumberEl = document.getElementById("countdownNumber");
      const countdownFactsEl = document.getElementById("countdownFacts");
      const quizWrapper = document.getElementById("quizWrapper");
      const quizCard = document.getElementById("quizCard");
      const quizPlanetNameEl = document.getElementById("quizPlanetName");
      const questionTextEl = document.getElementById("questionText");
      const truthFactCellEl = document.getElementById("truthFactCell");
      const truthAnswerCellEl = document.getElementById("truthAnswerCell");
      const btnTrue = document.getElementById("btnTrue");
      const btnFalse = document.getElementById("btnFalse");
      const answerStatusEl = document.getElementById("answerStatus");
      const explanationTextEl = document.getElementById("explanationText");
      const planetFactTextEl = document.getElementById("planetFactText");
      const btnNext = document.getElementById("btnNext");
      const progressTextEl = document.getElementById("progressText");
      const summaryWrapper = document.getElementById("summaryWrapper");
      const summaryScoreEl = document.getElementById("summaryScore");
      const summaryDetailEl = document.getElementById("summaryDetail");
      const summaryAccuracyEl = document.getElementById("summaryAccuracy");
      const summaryTierEl = document.getElementById("summaryTier");
      const btnRestart = document.getElementById("btnRestart");
      const musicToggle = document.getElementById("musicToggle");
      const bgMusic = document.getElementById("bgMusic");
      if (bgMusic) bgMusic.volume = 0.1;
      const quizMetaEl = document.getElementById("quizMeta");
      const planetElements = Array.from(document.querySelectorAll(".planet"));

      let currentPlanetIndex = 0;
      let score = 0;
      let answersGiven = 0;
      let countdownTimer = null;
      let animationFrameId;

      // --- SCALING LOGIC (FIX FOR MOBILE) ---
      // We use a fixed coordinate system (1000x1000) for logic, and scale the visual container
      const BASE_SIZE = 1000; 
      const MAX_ORBIT_DIAMETER = 820; // Neptune's orbit size in pixels
      const SAFE_PADDING = 40; // Pixels padding

      function handleResize() {
        if (!sceneWrapper || !solarSystemEl) return;
        
        const availableWidth = sceneWrapper.clientWidth;
        const availableHeight = sceneWrapper.clientHeight;
        
        // Determine the limiting dimension
        const minDimension = Math.min(availableWidth, availableHeight);
        
        // Calculate scale needed to fit the largest orbit into the available space
        // We add some padding so Neptune doesn't touch the edge
        let scaleFactor = (minDimension - SAFE_PADDING) / MAX_ORBIT_DIAMETER;
        
        // Cap the scale at 1.2 so it doesn't get absurdly huge on 4k screens
        scaleFactor = Math.min(scaleFactor, 1.2);
        
        // Apply scale
        solarSystemEl.style.transform = `scale(${scaleFactor})`;
        
        // Counter-scale interactive elements so they remain clickable/readable on small screens
        // If the scene is tiny (0.4), we want planets to be 2.5x larger relative to the scene
        const counterScale = Math.max(1, 0.8 / scaleFactor);
        
        planetElements.forEach(el => {
            // We only scale the visual size, not the position
            // But actually, simple CSS 'transform' on the planet might conflict with the position transform
            // So we change the width/height to make them visually larger without affecting orbit math
            // OR we rely on the ::before pseudo element for hit area, which is constant px
        });
        
        // Update Sun touch target
        if(sunEl) {
             // Keep sun reasonably sized
        }
      }

      // Listen for resize events
      window.addEventListener('resize', handleResize);
      // Call once on init
      setTimeout(handleResize, 100);

      // --- ORBIT LOGIC ---
      const orbitRadii = [80, 110, 145, 180, 260, 310, 360, 410];
      const orbitSpeeds = [4.1, 1.6, 1.0, 0.53, 0.35, 0.18, 0.095, 0.055];

      function animateOrbits(timestamp) {
        const orbitTime = timestamp * 0.0002;
        
        // Center of the 1000x1000 container
        const centerX = 500; 
        const centerY = 500;

        planetElements.forEach((el, index) => {
          const radius = orbitRadii[index];
          const speed = orbitSpeeds[index];
          const angle = orbitTime * speed + index * 0.9;
          
          const x = centerX + radius * Math.cos(angle);
          const y = centerY + radius * Math.sin(angle);

          el.style.left = `${x}px`;
          el.style.top = `${y}px`;
          // Transform is just for centering the element on its coordinate
          el.style.transform = `translate(-50%, -50%)`;
        });

        animationFrameId = window.requestAnimationFrame(animateOrbits);
      }
      
      // Start animation
      animationFrameId = window.requestAnimationFrame(animateOrbits);


      // --- GAMEPLAY FUNCTIONS ---

      function highlightCurrentPlanet(index) {
        planetElements.forEach((el) => el.classList.remove("highlighted"));
        const match = planetElements.find((el) => Number(el.dataset.planetIndex) === index);
        if (match) { match.classList.add("highlighted"); }
      }

      function startCountdown() {
        // Ensure music is playing if autoplay failed
        if (bgMusic && bgMusic.paused) {
             bgMusic.play().catch(() => {});
        }
        
        document.body.classList.add("top-down-view");
        
        const facts = [
            "Inner planets are rock; outer planets are gas/ice.",
            "The Sun is 99% of the solar system's mass.",
            "Jupiter spins the fastest of all planets."
        ];
        
        countdownFactsEl.innerHTML = "";
        facts.forEach(f => {
            const li = document.createElement("li");
            li.textContent = f;
            li.style.marginBottom = "5px";
            countdownFactsEl.appendChild(li);
        });

        countdownNumberEl.textContent = "5";
        countdownOverlay.classList.add("visible");
        countdownOverlay.setAttribute("aria-hidden", "false");

        let remaining = 5;
        if(countdownTimer) clearInterval(countdownTimer);
        
        countdownTimer = setInterval(() => {
          remaining -= 1;
          countdownNumberEl.textContent = String(remaining);
          if (remaining <= 0) {
            clearInterval(countdownTimer);
            beginQuiz();
          }
        }, 1000);
      }

      function beginQuiz() {
        countdownOverlay.classList.remove("visible");
        countdownOverlay.setAttribute("aria-hidden", "true");
        solarSystemEl.classList.remove("dimmed");
        
        currentPlanetIndex = 0;
        score = 0;
        answersGiven = 0;
        summaryWrapper.classList.remove("visible");
        summaryWrapper.setAttribute("aria-hidden", "true");

        showQuestionForPlanet(currentPlanetIndex);
      }

      function showQuestionForPlanet(index) {
        const planet = planets[index];
        if (!planet) return;

        highlightCurrentPlanet(index);

        quizCard.dataset.planet = planet.name;
        quizPlanetNameEl.textContent = planet.name;
        questionTextEl.textContent = "Evaluate the Truth Table";
        truthFactCellEl.innerText = planet.question; // Use innerText to preserve newlines
        truthAnswerCellEl.textContent = "?";
        truthAnswerCellEl.style.color = "var(--accent)";

        explanationTextEl.textContent = "";
        planetFactTextEl.textContent = "";
        quizMetaEl.classList.add("hidden");

        answerStatusEl.textContent = "";
        answerStatusEl.className = "answer-status"; // Reset classes

        btnTrue.disabled = false;
        btnFalse.disabled = false;
        btnNext.disabled = true;

        progressTextEl.textContent = `Planet ${index + 1} of ${planets.length}`;
        quizWrapper.classList.add("visible");
        quizWrapper.setAttribute("aria-hidden", "false");
      }

      function handleAnswer(isTrueSelected) {
        const planet = planets[currentPlanetIndex];
        
        truthAnswerCellEl.textContent = isTrueSelected ? "T" : "F";
        const correct = planet.correctIsTrue === isTrueSelected;
        
        truthAnswerCellEl.style.color = correct ? "var(--success)" : "var(--error)";

        if (correct) {
          score++;
          answerStatusEl.textContent = "CORRECT";
          answerStatusEl.classList.add("correct");
        } else {
          answerStatusEl.textContent = "INCORRECT";
          answerStatusEl.classList.add("incorrect");
        }

        explanationTextEl.textContent = planet.explanation;
        planetFactTextEl.textContent = planet.funFact;
        quizMetaEl.classList.remove("hidden");

        btnTrue.disabled = true;
        btnFalse.disabled = true;
        btnNext.disabled = false;
      }

      function goToNextPlanet() {
        if (currentPlanetIndex + 1 >= planets.length) {
          finishMission();
        } else {
          currentPlanetIndex++;
          showQuestionForPlanet(currentPlanetIndex);
        }
      }

      function finishMission() {
        quizWrapper.classList.remove("visible");
        quizWrapper.setAttribute("aria-hidden", "true");
        planetElements.forEach(el => el.classList.remove("highlighted"));

        const accuracy = Math.round((score / planets.length) * 100);
        summaryScoreEl.textContent = `${score} / ${planets.length}`;
        summaryDetailEl.textContent = "Mission Debrief Complete";
        summaryAccuracyEl.textContent = `Accuracy: ${accuracy}%`;
        
        if (accuracy === 100) summaryTierEl.textContent = "Rank: Admiral";
        else if (accuracy >= 75) summaryTierEl.textContent = "Rank: Commander";
        else if (accuracy >= 50) summaryTierEl.textContent = "Rank: Pilot";
        else summaryTierEl.textContent = "Rank: Cadet";

        summaryWrapper.classList.add("visible");
        summaryWrapper.setAttribute("aria-hidden", "false");
      }

      function restartMission() {
        summaryWrapper.classList.remove("visible");
        summaryWrapper.setAttribute("aria-hidden", "true");
        document.body.classList.remove("top-down-view");
        
        // Force re-layout
        handleResize();
      }

      function toggleMusic() {
        if (!bgMusic) return;
        bgMusic.muted = !bgMusic.muted;
        updateMusicButton();
      }

      function updateMusicButton() {
        if (bgMusic.muted) {
          musicToggle.innerHTML = "<span>Unmute</span>";
          musicToggle.setAttribute("aria-pressed", "false");
          musicToggle.style.borderColor = "rgba(255,215,0,0.3)";
        } else {
          musicToggle.innerHTML = "<span>Mute</span>";
          musicToggle.setAttribute("aria-pressed", "true");
          musicToggle.style.borderColor = "var(--accent)";
        }
      }

      // --- EVENTS ---
      // Try to play immediately
      if (bgMusic) {
          bgMusic.play().catch(e => {
              console.log("Autoplay prevented, waiting for interaction");
          });
      }

      sunEl.addEventListener("click", startCountdown);
      btnTrue.addEventListener("click", () => handleAnswer(true));
      btnFalse.addEventListener("click", () => handleAnswer(false));
      btnNext.addEventListener("click", goToNextPlanet);
      btnRestart.addEventListener("click", restartMission);
      musicToggle.addEventListener("click", toggleMusic);
      
      document.getElementById('btnVisitSite').addEventListener('click', function() {
        window.open('https://sirp0o0kiebear.wixsite.com/solar-system', '_blank');
      });

    })();
  </script>
</body>
</html>
