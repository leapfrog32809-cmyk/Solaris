<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Solar System Logic Mission</title>

  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-space: #020310;
      --accent: #ffcc4d;
      --accent-soft: rgba(255, 204, 77, 0.25);
      --card-bg: rgba(7, 11, 30, 0.9);
      --text-main: #f5f7ff;
      --text-muted: #a4b0d0;
      --error: #ff4d6a;
      --success: #5ad08b;
      --orbit-color: rgba(255, 255, 255, 0.1);
      --transition-fast: 0.35s ease-out;
      --transition-med: 0.6s ease-in-out;
      --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.5);
      --radius-card: 18px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Poppins", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: url("starfield.jpg") center/cover fixed no-repeat;
      color: var(--text-main);
      min-height: 100vh;
      overflow: hidden;
      display: flex;
      align-items: stretch;
      justify-content: center;
    }

    body.top-down-view {
      background-image: url("nebula.jpg");
      background-size: cover;
      background-position: center;
    }

    .app-shell {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
      overflow: hidden;
      padding: 16px;
    }

    .frame {
      border-radius: 26px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      box-shadow: 0 22px 55px rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(16px);
      background:
        url("asteroidbelt1.jpg") center/cover no-repeat,
        radial-gradient(circle at top left, rgba(108, 122, 255, 0.24), transparent 55%),
        radial-gradient(circle at bottom right, rgba(255, 207, 115, 0.16), transparent 55%),
        rgba(0, 0, 20, 0.85);
      height: calc(100vh - 32px);
      min-height: 540px;
      max-height: 900px;
      display: grid;
      grid-template-rows: auto 1fr auto;
      position: relative;
      overflow: hidden;
    }

    header.app-header {
      padding: 16px 22px 8px;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      z-index: 40;
    }

    .brand {
      display: none;
    }

    .hud-right {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .pill {
      border-radius: 999px;
      padding: 6px 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      gap: 8px;
      backdrop-filter: blur(12px);
      background: linear-gradient(135deg, rgba(15, 24, 74, 0.9), rgba(42, 26, 82, 0.6));
    }

    .pill-quiet {
      background: rgba(5, 10, 32, 0.7);
    }

    .indicator-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--success);
      box-shadow: 0 0 12px rgba(90, 208, 139, 0.8);
    }

    .btn-ghost {
      border-radius: 999px;
      padding: 6px 12px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: radial-gradient(circle at top, rgba(255, 255, 255, 0.25), transparent 60%),
                  rgba(5, 10, 32, 0.8);
      color: var(--text-main);
      cursor: pointer;
      font-size: 0.75rem;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 0.18s ease-out, transform 0.18s ease-out, box-shadow 0.18s;
    }

    .btn-ghost:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
      background: radial-gradient(circle at top, rgba(255, 255, 255, 0.4), transparent 60%),
                  rgba(10, 18, 54, 0.95);
    }

    .btn-ghost:active {
      transform: translateY(0);
      box-shadow: none;
    }

    .btn-ghost[aria-pressed="true"] {
      border-color: var(--accent);
      background: radial-gradient(circle at top, rgba(255, 219, 139, 0.6), transparent 60%),
                  rgba(40, 24, 4, 0.95);
    }

    main.stage {
      position: relative;
      overflow: hidden;
      padding: 6px 20px 20px;
    }

    /* Solar system scene */
    .solar-system-wrapper {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      perspective: 1200px;
      overflow: hidden;
    }

    .solar-system {
      position: relative;
      width: 100%;
      max-width: 1200px;
      height: 100%;
      transform-style: flat;
      transition: opacity var(--transition-med), filter var(--transition-med);
      transform: scale(0.82);
    }

    .solar-system.side-view {
      /* Side view with orbital animations */
      opacity: 1;
    }

    .solar-system.top-down {
      /* Top-down quiz view with reduced animations */
      opacity: 1;
    }

    .solar-system.dimmed {
      opacity: 0.18;
      filter: blur(3px);
    }

    .starfield {
      position: absolute;
      inset: -40px;
      background-image:
        radial-gradient(circle at 10% 20%, rgba(255, 255, 255, 0.7) 1px, transparent 1px),
        radial-gradient(circle at 80% 30%, rgba(255, 255, 255, 0.5) 1px, transparent 1px),
        radial-gradient(circle at 40% 80%, rgba(255, 255, 255, 0.6) 1px, transparent 1px),
        radial-gradient(circle at 20% 75%, rgba(200, 220, 255, 0.5) 1px, transparent 1px),
        radial-gradient(circle at 65% 15%, rgba(255, 220, 200, 0.4) 1px, transparent 1px);
      background-size: 250% 250%, 220% 220%, 280% 280%, 240% 240%, 260% 260%;
      background-position: 0% 0%, 10% 20%, 5% 15%, 15% 25%, 20% 10%;
      opacity: 0.75;
      mix-blend-mode: screen;
      pointer-events: none;
      animation: twinkle-stars 10s ease-in-out infinite alternate;
      will-change: opacity;
      contain: layout style paint;
    }

    @keyframes twinkle-stars {
      0% { opacity: 0.6; }
      100% { opacity: 0.8; }
    }

    .deep-stars {
      position: absolute;
      inset: -60px;
      background-image:
        radial-gradient(circle at 25% 10%, rgba(255, 255, 255, 0.8) 0, transparent 1px),
        radial-gradient(circle at 70% 85%, rgba(255, 255, 255, 0.7) 0, transparent 1px),
        radial-gradient(circle at 30% 60%, rgba(150, 200, 255, 0.6) 0, transparent 1px),
        radial-gradient(circle at 88% 40%, rgba(255, 255, 255, 0.5) 0, transparent 1px),
        radial-gradient(circle at 12% 35%, rgba(200, 255, 255, 0.5) 0, transparent 1px);
      opacity: 0.6;
      mix-blend-mode: screen;
      filter: blur(0.5px);
      pointer-events: none;
      z-index: -1;
      animation: twinkle 6s ease-in-out infinite alternate;
      will-change: opacity;
      contain: layout style paint;
    }

    @keyframes twinkle {
      0%   { opacity: 0.5; }
      100% { opacity: 0.7; }
    }

    .galaxy-clouds {
      position: absolute;
      inset: -80px;
      background:
        radial-gradient(circle at 5% 20%, rgba(140, 183, 255, 0.25), transparent 65%),
        radial-gradient(circle at 85% 65%, rgba(248, 182, 255, 0.25), transparent 65%);
      opacity: 0.18;
      mix-blend-mode: screen;
      pointer-events: none;
      z-index: -2;
      will-change: opacity;
      contain: layout style paint;
    }

    .far-galaxy {
      position: absolute;
      width: 260px;
      height: 260px;
      background: url("nebula.jpg") center/cover no-repeat;
      opacity: 0.1;
      mix-blend-mode: screen;
      pointer-events: none;
      will-change: transform;
      contain: layout style paint;
    }

    .far-galaxy.one {
      top: 6%;
      right: -4%;
      transform: rotate(18deg) scale(0.9);
    }

    .far-galaxy.two {
      bottom: -8%;
      left: -6%;
      transform: rotate(-14deg) scale(1.1);
    }

    .twinkle-layer {
      position: absolute;
      inset: 0;
      background-image:
        radial-gradient(circle at 15% 30%, rgba(255, 255, 255, 0.4) 0, transparent 40%),
        radial-gradient(circle at 70% 55%, rgba(255, 255, 255, 0.3) 0, transparent 40%);
      opacity: 0.0;
      mix-blend-mode: screen;
      animation: twinkle-subtle 8s ease-in-out infinite alternate;
      pointer-events: none;
      will-change: opacity;
      contain: layout style paint;
    }

    @keyframes twinkle-subtle {
      0% { opacity: 0.0; }
      100% { opacity: 0.2; }
    }

    @keyframes twinkle {
      0%   { opacity: 0.0; transform: scale(1); }
      40%  { opacity: 0.45; transform: scale(1.01); }
      70%  { opacity: 0.2; transform: scale(1); }
      100% { opacity: 0.55; transform: scale(1.015); }
    }

    .shooting-star {
      position: absolute;
      width: 100px;
      height: 1.5px;
      background: linear-gradient(90deg, rgba(255, 255, 255, 0.8), transparent);
      opacity: 0;
      filter: blur(0.5px);
      pointer-events: none;
      mix-blend-mode: screen;
      box-shadow: 0 0 8px rgba(200, 220, 255, 0.7);
      will-change: transform, opacity;
      contain: layout style paint;
    }

    .shooting-star::after {
      content: "";
      position: absolute;
      right: 0;
      top: -2px;
      width: 3px;
      height: 3px;
      border-radius: 50%;
      background: #ffffff;
      box-shadow: 0 0 6px rgba(200, 220, 255, 0.7);
    }

    .shooting-star.one {
      top: 15%;
      left: -15%;
      animation: shooting 6s linear infinite;
      animation-delay: 0s;
    }

    .shooting-star.two {
      top: 65%;
      left: 110%;
      transform: rotate(180deg);
      animation: shooting 8s linear infinite;
      animation-delay: 2s;
    }

    .shooting-star.three {
      top: 35%;
      left: -20%;
      animation: shooting 7s linear infinite;
      animation-delay: 4s;
    }

    @keyframes shooting {
      0% {
        opacity: 0;
        transform: translate3d(0, 0, 0);
      }
      5% {
        opacity: 1;
      }
      25% {
        opacity: 1;
        transform: translate3d(160%, 40%, 0);
      }
      45% {
        opacity: 0;
      }
      100% {
        opacity: 0;
        transform: translate3d(200%, 80%, 0);
      }
    }

    .orbit {
      position: absolute;
      border-radius: 50%;
      border: 2.5px solid rgba(100, 180, 255, 0.45);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none;
      box-shadow: 0 0 8px rgba(100, 180, 255, 0.35);
      will-change: transform;
      contain: layout style;
    }

    .orbit.animate {
      animation: orbit-rotate 28s linear infinite;
      transform-origin: center center;
    }

    @keyframes orbit-rotate {
      from {
        transform: translate(-50%, -50%) rotateZ(0deg);
      }
      to {
        transform: translate(-50%, -50%) rotateZ(360deg);
      }
    }

    .star {
      position: absolute;
      width: 110px;
      height: 110px;
      border-radius: 50%;
      background: radial-gradient(circle at 20% 15%, #ffffff, #ffd36a 40%, #ff9b21 70%, rgba(0, 0, 0, 0) 72%),
                  url("Textures/sun.jpg") center/cover no-repeat;
      box-shadow:
        0 0 30px rgba(255, 150, 40, 0.8),
        0 0 60px rgba(255, 100, 20, 0.4);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      cursor: pointer;
      transition: transform 0.25s ease-out, box-shadow 0.25s ease-out, filter 0.25s ease-out;
      z-index: 4;
      will-change: transform, box-shadow;
      contain: layout style paint;
    }

    .star::after {
      content: "Click the Sun to begin";
      position: absolute;
      left: 130%;
      top: 50%;
      transform: translateY(-50%);
      white-space: nowrap;
      font-size: 0.85rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.25);
      border: 1px solid rgba(255, 255, 255, 0.08);
      color: rgba(245, 247, 255, 0.6);
    }

    .star:hover {
      transform: translate(-50%, -50%) scale(1.06);
      box-shadow:
        0 0 60px rgba(255, 206, 138, 0.95),
        0 0 150px rgba(255, 180, 80, 0.9);
      filter: saturate(1.2);
    }

    .star:active {
      transform: translate(-50%, -50%) scale(1.02);
    }

    .planet {
      position: absolute;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      box-shadow:
        0 6px 18px rgba(0, 0, 0, 0.8),
        0 0 20px rgba(100, 180, 255, 0.2);
      transform: translate(-50%, -50%);
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), filter var(--transition-fast);
      will-change: transform;
      contain: layout style paint;
    }

    .planet::after {
      content: attr(data-name);
      position: absolute;
      top: 108%;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-muted);
      text-shadow: 0 0 6px rgba(0, 0, 0, 0.8);
    }

    .planet.mercury { width: 10px; height: 10px; background-image: url("Textures/mercury.jpg"); }
    .planet.venus   { width: 18px; height: 18px; background-image: url("Textures/venus.jpg"); }
    .planet.earth   { width: 20px; height: 20px; background-image: url("Textures/earth.jpg"); }
    .planet.mars    { width: 14px; height: 14px; background-image: url("Textures/mars.jpg"); }
    .planet.jupiter { width: 42px; height: 42px; background-image: url("Textures/jupiter.jpg"); }
    .planet.saturn  {
      width: 36px;
      height: 36px;
      background-image: url("Textures/saturn.jpg");
    }
    .planet.uranus  { width: 26px; height: 26px; background-image: url("Textures/uranus.jpg"); }
    .planet.neptune { width: 24px; height: 24px; background-image: url("Textures/neptune.jpg"); }

    .planet.saturn::before {
      content: "";
      position: absolute;
      inset: 50%;
      width: 72px;
      height: 26px;
      margin-left: -36px;
      margin-top: -13px;
      border-radius: 50%;
      border: 3px solid rgba(219, 204, 170, 0.9);
      border-left-color: rgba(219, 204, 170, 0.35);
      border-right-color: rgba(219, 204, 170, 0.35);
      transform: rotate(-18deg);
      box-shadow: 0 0 10px rgba(219, 204, 170, 0.7);
      pointer-events: none;
    }

    .planet.highlighted {
      box-shadow:
        0 0 18px rgba(255, 255, 255, 0.75),
        0 0 45px rgba(103, 185, 255, 0.75);
      filter: saturate(1.3);
      transform: translate(-50%, -50%) scale(1.2);
    }

    /* Planet positions will be driven by JavaScript to orbit around the Sun */

    /* Orbits (used more in top-down) */
    .orbit.mercury { width: 160px; height: 160px; }
    .orbit.venus   { width: 210px; height: 210px; }
    .orbit.earth   { width: 260px; height: 260px; }
    .orbit.mars    { width: 320px; height: 320px; }
    .orbit.jupiter { width: 480px; height: 480px; }
    .orbit.saturn  { width: 560px; height: 560px; }
    .orbit.uranus  { width: 650px; height: 650px; }
    .orbit.neptune { width: 740px; height: 740px; }

    .asteroid-belt {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 410px;
      height: 410px;
      transform: translate(-50%, -50%) rotate(8deg);
      border-radius: 50%;
      background-image: url("asteroidbelt1.jpg");
      background-size: cover;
      background-position: center;
      opacity: 0.75;
      mix-blend-mode: screen;
      pointer-events: none;
      filter: blur(0.3px);
    }

    /* Overlay countdown */
    .overlay {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.92));
      opacity: 0;
      pointer-events: none;
      transition: opacity var(--transition-med);
      z-index: 60;
    }

    .overlay.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .countdown-panel {
      max-width: 500px;
      width: 90%;
      padding: 26px 22px 22px;
      border-radius: var(--radius-card);
      background: radial-gradient(circle at top left, rgba(255, 215, 143, 0.16), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(120, 179, 255, 0.22), transparent 55%),
                  rgba(4, 11, 30, 0.95);
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(255, 255, 255, 0.16);
      text-align: center;
    }

    .countdown-title {
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .countdown-number {
      font-size: 2.8rem;
      font-weight: 700;
      letter-spacing: 0.2em;
      text-indent: 0.2em;
      color: var(--accent);
      text-shadow: 0 0 26px rgba(255, 212, 143, 0.8);
      margin: 6px 0 8px;
    }

    .countdown-subtitle {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 14px;
    }

    .fact-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 0.82rem;
      color: var(--text-main);
      text-align: left;
    }

    .fact-list li {
      padding: 6px 9px;
      border-radius: 999px;
      background: rgba(13, 20, 53, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    /* Quiz card */
    .quiz-wrapper {
      position: absolute;
      inset: 0;
      pointer-events: none;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
      opacity: 0;
      transition: opacity var(--transition-med);
    }

    .quiz-wrapper.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .quiz-card {
      max-width: 720px;
      width: 100%;
      margin: 0 16px;
      padding: 22px 22px 18px;
      background:
        url("dwarfplanets1.jpg") center/cover no-repeat,
        var(--card-bg);
      border-radius: var(--radius-card);
      border: 1px solid rgba(255, 255, 255, 0.18);
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(18px);
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2.4fr);
      gap: 18px;
      position: relative;
      overflow: hidden;
    }

    .quiz-card::before {
      content: "";
      position: absolute;
      inset: -30%;
      background-size: cover;
      background-position: center;
      opacity: 0.18;
      mix-blend-mode: screen;
      pointer-events: none;
      transition: opacity var(--transition-med), transform var(--transition-med);
      transform: scale(1.12);
    }

    .quiz-card[data-planet="Mercury"]::before { background-image: url("Textures/mercury.jpg"); }
    .quiz-card[data-planet="Venus"]::before   { background-image: url("Textures/venus.jpg"); }
    .quiz-card[data-planet="Earth"]::before   { background-image: url("Textures/earth.jpg"); }
    .quiz-card[data-planet="Mars"]::before    { background-image: url("Textures/mars.jpg"); }
    .quiz-card[data-planet="Jupiter"]::before { background-image: url("Textures/jupiter.jpg"); }
    .quiz-card[data-planet="Saturn"]::before  { background-image: url("Textures/saturn.jpg"); }
    .quiz-card[data-planet="Uranus"]::before  { background-image: url("Textures/uranus.jpg"); }
    .quiz-card[data-planet="Neptune"]::before { background-image: url("Textures/neptune.jpg"); }

    .quiz-card-inner {
      position: relative;
      z-index: 1;
      display: contents;
    }

    .quiz-main {
      padding-right: 8px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .quiz-badge-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* Performance: disable expensive animations in top-down view */
    .solar-system.top-down .starfield,
    .solar-system.top-down .deep-stars,
    .solar-system.top-down .twinkle-layer,
    .solar-system.top-down .shooting-star {
      animation: none !important;
      opacity: 0;
      pointer-events: none;
    }

    .solar-system.top-down .orbit {
      animation: none !important;
      border-color: rgba(100, 180, 255, 0.2);
      box-shadow: none;
    }

    .difficulty-pill {
      padding: 4px 11px;
      border-radius: 999px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      border: 1px solid rgba(255, 255, 255, 0.18);
      background: rgba(0, 0, 0, 0.4);
    }

    .difficulty-easy { color: var(--success); border-color: rgba(90, 208, 139, 0.7); }
    .difficulty-medium { color: #ffd05a; border-color: rgba(255, 208, 90, 0.8); }
    .difficulty-hard { color: var(--error); border-color: rgba(255, 77, 106, 0.8); }

    .quiz-planet-label {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-muted);
    }

    .quiz-question-heading {
      font-size: 1.05rem;
      font-weight: 600;
    }

    .truth-table {
      margin-top: 10px;
      border-collapse: collapse;
      width: 100%;
      font-size: 0.82rem;
    }

    .truth-table thead {
      background: rgba(10, 19, 45, 0.9);
    }

    .truth-table th,
    .truth-table td {
      padding: 6px 8px;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .truth-table tbody tr:nth-child(odd) {
      background: rgba(7, 12, 33, 0.95);
    }

    .truth-table tbody tr:nth-child(even) {
      background: rgba(5, 9, 26, 0.95);
    }

    .answer-buttons {
      margin-top: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .btn-answer {
      flex: 0 0 auto;
      min-width: 82px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.22);
      background: rgba(9, 18, 52, 0.96);
      color: var(--text-main);
      cursor: pointer;
      font-size: 0.86rem;
      font-weight: 500;
      transition: background 0.18s ease-out, transform 0.18s ease-out, box-shadow 0.18s ease-out, border-color 0.18s;
    }

    .btn-answer:hover {
      background: rgba(25, 39, 92, 0.98);
      transform: translateY(-1px);
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.4);
    }

    .btn-answer:active {
      transform: translateY(0);
      box-shadow: none;
    }

    .btn-answer[disabled] {
      opacity: 0.55;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    .answer-status {
      margin-top: 6px;
      font-size: 0.86rem;
      font-weight: 600;
    }

    .answer-status.correct {
      color: var(--success);
    }

    .answer-status.incorrect {
      color: var(--error);
    }

    .quiz-meta {
      border-radius: 14px;
      padding: 10px 12px;
      background: rgba(3, 9, 28, 0.96);
      border: 1px solid rgba(255, 255, 255, 0.12);
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .quiz-meta.hidden {
      opacity: 0;
      pointer-events: none;
      transform: translateY(8px);
      transition: opacity var(--transition-med), transform var(--transition-med);
    }

    .quiz-meta.visible {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    .quiz-meta h3 {
      font-size: 0.86rem;
      font-weight: 600;
      color: var(--text-main);
    }

    .quiz-meta .fact-label {
      font-weight: 600;
      color: var(--accent);
      font-size: 0.78rem;
      margin-bottom: 4px;
    }

    .quiz-meta p {
      line-height: 1.45;
    }

    .quiz-footer {
      margin-top: 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .btn-next {
      padding: 8px 16px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      background: linear-gradient(135deg, #ffd36a, #ff9f3c);
      color: #2b1600;
      box-shadow: 0 16px 34px rgba(0, 0, 0, 0.7);
      transition: transform 0.16s ease-out, box-shadow 0.16s ease-out, filter 0.16s;
    }

    .btn-next:hover:not([disabled]) {
      transform: translateY(-1px);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.85);
      filter: brightness(1.02);
    }

    .btn-next:active:not([disabled]) {
      transform: translateY(0);
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.65);
    }

    .btn-next[disabled] {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
    }

    /* Summary */
    .summary-wrapper {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      opacity: 0;
      transition: opacity var(--transition-med);
      z-index: 55;
    }

    .summary-wrapper.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .summary-card {
      max-width: 540px;
      width: 90%;
      padding: 24px 22px 18px;
      border-radius: var(--radius-card);
      background:
        radial-gradient(circle at top left, rgba(255, 215, 143, 0.18), transparent 55%),
        radial-gradient(circle at bottom right, rgba(120, 179, 255, 0.22), transparent 55%),
        rgba(3, 9, 26, 0.96);
      border: 1px solid rgba(255, 255, 255, 0.16);
      box-shadow: var(--shadow-soft);
      text-align: center;
    }

    .summary-title {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .summary-score {
      font-size: 2.1rem;
      font-weight: 700;
      color: var(--accent);
      text-shadow: 0 0 30px rgba(255, 217, 144, 0.9);
      margin: 4px 0;
    }

    .summary-detail {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 14px;
    }

    .summary-metrics {
      display: flex;
      justify-content: center;
      gap: 14px;
      margin-bottom: 18px;
      font-size: 0.8rem;
    }

    .summary-metrics span {
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(7, 13, 39, 0.96);
      border: 1px solid rgba(255, 255, 255, 0.12);
    }

    .summary-actions {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn-outline {
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.24);
      background: transparent;
      color: var(--text-main);
      cursor: pointer;
      font-size: 0.86rem;
      font-weight: 500;
      transition: background 0.16s ease-out, transform 0.16s ease-out, box-shadow 0.16s ease-out;
    }

    .btn-outline:hover {
      background: rgba(13, 23, 68, 0.96);
      transform: translateY(-1px);
      box-shadow: 0 14px 28px rgba(0, 0, 0, 0.55);
    }

    .btn-outline:active {
      transform: translateY(0);
      box-shadow: none;
    }

    footer.app-footer {
      display: none;
    }

    /* Responsive */
    @media (max-width: 840px) {
      .frame {
        grid-template-rows: auto 1fr auto;
        min-height: 560px;
      }

      .quiz-card {
        grid-template-columns: minmax(0, 1fr);
        padding: 18px 16px 16px;
      }

      .quiz-main {
        padding-right: 0;
      }

      .quiz-footer {
        flex-direction: column-reverse;
        align-items: flex-start;
      }

      .summary-card {
        padding-inline: 18px;
      }
    }

    @media (max-width: 768px) {
      :root {
        font-size: 14px;
      }

      .app-shell {
        padding: 8px;
      }

      .frame {
        height: calc(100vh - 16px);
        border-radius: 16px;
      }

      header.app-header {
        padding: 12px 16px 6px;
      }

      .hud-right {
        font-size: 0.65rem;
        gap: 8px;
      }

      .solar-system {
        transform: scale(0.65);
      }

      .quiz-card {
        padding: 14px 12px 12px;
      }

      .quiz-main {
        gap: 12px;
      }

      .quiz-planet-label {
        font-size: 0.9rem;
      }

      .quiz-question-heading {
        font-size: 1rem;
        line-height: 1.4;
      }

      .truth-table {
        font-size: 0.85rem;
      }

      .truth-table td,
      .truth-table th {
        padding: 8px 6px;
      }

      .answer-buttons {
        flex-direction: column;
        gap: 8px;
      }

      .btn-answer,
      .btn-outline {
        padding: 10px 12px;
        font-size: 0.9rem;
        border-radius: 8px;
      }

      .difficulty-pill {
        font-size: 0.75rem;
        padding: 4px 8px;
      }

      .quiz-footer {
        gap: 8px;
        padding: 0;
      }

      .answer-panel {
        padding: 12px;
        gap: 8px;
      }

      .summary-card {
        padding: 16px 12px;
      }

      .summary-score {
        font-size: 2rem;
      }

      .app-footer {
        padding: 8px 12px;
        font-size: 0.65rem;
      }
    }

    @media (max-width: 640px) {
      :root {
        font-size: 13px;
      }

      body {
        padding: 0;
      }

      .app-shell {
        padding: 4px;
      }

      .frame {
        height: calc(100vh - 8px);
        border-radius: 12px;
        min-height: 100vh;
      }

      header.app-header {
        padding: 10px 12px 4px;
      }

      .brand {
        display: none;
      }

      .hud-right {
        display: none;
      }

      .solar-system {
        transform: scale(0.55);
      }

      main.stage {
        padding: 4px 10px 10px;
      }

      .solar-system-wrapper {
        min-height: 280px;
      }

      .quiz-wrapper {
        opacity: 1 !important;
        pointer-events: auto !important;
      }

      .quiz-card {
        border-radius: 12px;
        padding: 12px 10px 10px;
      }

      .quiz-main {
        gap: 10px;
      }

      .quiz-badge-row {
        flex-direction: column;
        gap: 6px;
      }

      .quiz-planet-label {
        font-size: 0.85rem;
      }

      .difficulty-pill {
        font-size: 0.7rem;
        padding: 3px 6px;
      }

      .quiz-question-heading {
        font-size: 0.9rem;
        line-height: 1.3;
        font-weight: 600;
      }

      .truth-table {
        font-size: 0.8rem;
        margin: 8px 0;
      }

      .truth-table thead {
        font-size: 0.75rem;
      }

      .truth-table td,
      .truth-table th {
        padding: 6px 4px;
      }

      .truth-table th:first-child {
        width: 65%;
      }

      .truth-table th:last-child {
        width: 35%;
      }

      .answer-buttons {
        flex-direction: column;
        gap: 6px;
      }

      .btn-answer {
        padding: 10px 8px;
        font-size: 0.85rem;
        font-weight: 600;
        border-radius: 6px;
        min-height: 40px;
        touch-action: manipulation;
      }

      .btn-outline {
        padding: 8px 10px;
        font-size: 0.8rem;
        border-radius: 6px;
      }

      .quiz-footer {
        flex-direction: column-reverse;
        gap: 6px;
        padding-top: 8px;
      }

      .answer-panel {
        padding: 10px;
        gap: 6px;
        border-radius: 8px;
      }

      .answer-status {
        font-size: 0.9rem;
        font-weight: 600;
      }

      .explanation-text {
        font-size: 0.8rem;
        line-height: 1.3;
      }

      .planet-fact-text {
        font-size: 0.75rem;
        line-height: 1.3;
      }

      .summary-wrapper {
        padding: 0;
      }

      .summary-card {
        padding: 14px 10px;
        border-radius: 12px;
      }

      .summary-score {
        font-size: 2.5rem;
      }

      .summary-detail {
        font-size: 0.85rem;
      }

      .summary-tier {
        font-size: 0.9rem;
      }

      .star::after {
        font-size: 0.6rem;
        padding: 4px 6px;
        left: 120%;
        top: 55%;
      }

      .app-footer {
        padding: 6px 8px;
        flex-direction: column;
        gap: 4px;
        font-size: 0.6rem;
      }

      .footer-left,
      .footer-right {
        width: 100%;
        text-align: center;
      }

      .countdown-panel {
        width: 90%;
        padding: 16px 14px 14px;
      }

      .countdown-title {
        font-size: 1.1rem;
        margin-bottom: 8px;
      }

      .countdown-number {
        font-size: 2.2rem;
        font-weight: 700;
      }

      .countdown-facts {
        font-size: 0.75rem;
        gap: 6px;
      }

      .countdown-facts li {
        line-height: 1.3;
      }
    }

    @media (max-width: 480px) {
      :root {
        font-size: 12px;
      }

      .frame {
        border-radius: 8px;
      }

      .quiz-card {
        padding: 10px 8px;
      }

      .solar-system {
        transform: scale(0.48);
      }

      .quiz-question-heading {
        font-size: 0.85rem;
      }

      .truth-table {
        font-size: 0.75rem;
      }

      .btn-answer {
        padding: 9px 6px;
        font-size: 0.8rem;
        min-height: 38px;
      }

      .summary-score {
        font-size: 2rem;
      }

      .answer-status {
        font-size: 0.85rem;
      }

      .quiz-wrapper.visible {
        position: fixed;
        inset: 0;
        z-index: 100;
      }
    }

    @media (max-height: 600px) {
      .frame {
        max-height: none;
        height: auto;
      }

      main.stage {
        min-height: 300px;
      }

      .solar-system {
        transform: scale(0.5);
      }

      .quiz-card {
        padding: 10px;
      }
    }
  </style>
  </style>
</head>
<body>
  <div class="app-shell">
    <div class="frame">
      <header class="app-header">
        <div class="hud-right">
          <div class="pill pill-quiet">
            <span class="indicator-dot"></span>
            <span id="hud-state-label">Awaiting launch</span>
          </div>
          <button id="musicToggle" class="btn-ghost" type="button" aria-pressed="false">
            <span>Music</span>
          </button>
        </div>
      </header>

      <main class="stage">
        <div class="solar-system-wrapper">
          <div id="solarSystem" class="solar-system side-view">
            <div class="galaxy-clouds"></div>
            <div class="deep-stars"></div>
            <div class="starfield"></div>
            <div class="far-galaxy one"></div>
            <div class="far-galaxy two"></div>
            <div class="twinkle-layer"></div>
            <div class="asteroid-belt"></div>
            <div class="shooting-star one"></div>
            <div class="shooting-star two"></div>
            <div class="shooting-star three"></div>

            <!-- Orbits -->
            <div class="orbit mercury animate"></div>
            <div class="orbit venus animate"></div>
            <div class="orbit earth animate"></div>
            <div class="orbit mars animate"></div>
            <div class="orbit jupiter animate"></div>
            <div class="orbit saturn animate"></div>
            <div class="orbit uranus animate"></div>
            <div class="orbit neptune animate"></div>

            <!-- Sun -->
            <div id="sun" class="star" role="button" aria-label="Click the Sun to start mission"></div>

            <!-- Planets -->
            <div class="planet mercury orbiting" data-name="Mercury" data-planet-index="0"></div>
            <div class="planet venus orbiting" data-name="Venus" data-planet-index="1"></div>
            <div class="planet earth orbiting" data-name="Earth" data-planet-index="2"></div>
            <div class="planet mars orbiting" data-name="Mars" data-planet-index="3"></div>
            <div class="planet jupiter orbiting" data-name="Jupiter" data-planet-index="4"></div>
            <div class="planet saturn orbiting" data-name="Saturn" data-planet-index="5"></div>
            <div class="planet uranus orbiting" data-name="Uranus" data-planet-index="6"></div>
            <div class="planet neptune orbiting" data-name="Neptune" data-planet-index="7"></div>
          </div>
        </div>

        <!-- Countdown overlay -->
        <div id="countdownOverlay" class="overlay" aria-hidden="true">
          <div class="countdown-panel">
            <div class="countdown-title">Ready?</div>
            <div id="countdownNumber" class="countdown-number">5</div>
            <div class="countdown-subtitle">Your logic mission through the solar system begins in:</div>
            <ul id="countdownFacts" class="fact-list"></ul>
          </div>
        </div>

        <!-- Quiz card -->
        <div id="quizWrapper" class="quiz-wrapper" aria-hidden="true">
          <article id="quizCard" class="quiz-card" data-planet="">
            <div class="quiz-card-inner">
              <section class="quiz-main">
                <div class="quiz-badge-row">
                  <span class="quiz-planet-label">Planet <span id="quizPlanetName"></span></span>
                  <span id="difficultyPill" class="difficulty-pill difficulty-easy">Difficulty: Easy</span>
                </div>
                <div class="quiz-question-heading" id="questionText"></div>

                <table class="truth-table" aria-label="Truth table for your answer">
                  <thead>
                    <tr>
                      <th style="width: 70%;">Proposition about this planet</th>
                      <th style="width: 30%;">Truth value in last column</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td id="truthFactCell"></td>
                      <td id="truthAnswerCell">?</td>
                    </tr>
                  </tbody>
                </table>

                <div class="answer-buttons">
                  <button id="btnTrue" class="btn-answer" type="button">True (T)</button>
                  <button id="btnFalse" class="btn-answer" type="button">False (F)</button>
                </div>
                <div id="answerStatus" class="answer-status"></div>
              </section>

              <aside class="quiz-meta hidden" id="quizMeta">
                <h3>Explanation</h3>
                <div>
                  <div class="fact-label">Why this is correct or incorrect:</div>
                  <p id="explanationText"></p>
                </div>
                <div>
                  <div class="fact-label">Surprising fact about this planet:</div>
                  <p id="planetFactText"></p>
                </div>
                <div class="quiz-footer">
                  <span id="progressText">Planet 1 of 8</span>
                  <button id="btnNext" class="btn-next" type="button" disabled>Next planet</button>
                </div>
              </aside>
            </div>
          </article>
        </div>

        <!-- Summary -->
        <div id="summaryWrapper" class="summary-wrapper" aria-hidden="true">
          <section class="summary-card">
            <div class="summary-title">Mission summary</div>
            <div id="summaryScore" class="summary-score"></div>
            <div id="summaryDetail" class="summary-detail"></div>
            <div class="summary-metrics">
              <span id="summaryAccuracy"></span>
              <span id="summaryTier"></span>
            </div>
            <div class="summary-actions">
              <button id="btnRestart" class="btn-outline" type="button">Run mission again</button>
            </div>
          </section>
        </div>

        <!-- Audio -->
        <audio id="bgMusic" loop>
          <source src="dream.mp3" type="audio/mpeg" />
        </audio>
      </main>

      <footer class="app-footer">
        <div class="footer-left">
          <span class="footer-pill">Perspective: side-on orbit view &rarr; top-down quiz view</span>
        </div>
        <div class="footer-right">
          <span>Questions are based on information from NASA educational resources.</span>
        </div>
      </footer>
    </div>
  </div>

  <script>
    (function () {
      const planetQuestionsBank = {
        Mercury: [
          {
            difficulty: "easy",
            question: "Mercury is the closest planet to the Sun AND Mercury is the smallest planet.",
            operator: "AND (∧)",
            p: "Mercury is closest to the Sun",
            q: "Mercury is the smallest planet",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Conjunction (AND): Both P and Q are true, so P ∧ Q = TRUE. Mercury is both the closest to the Sun and the smallest of the eight planets.",
            funFact: "Even though Mercury is closest to the Sun, it is not the hottest planet because it lacks a thick atmosphere to trap heat."
          },
          {
            difficulty: "medium",
            question: "Mercury has flowing water OR Mercury completes orbit in 88 days.",
            operator: "OR (∨)",
            p: "Mercury has flowing water",
            q: "Mercury completes its orbit in 88 days",
            pValue: false,
            qValue: true,
            correctIsTrue: true,
            explanation: "Disjunction (OR): P is false, but Q is true. Since at least one is true, P ∨ Q = TRUE. Mercury orbits every 88 Earth days.",
            funFact: "Mercury has no water, but it is the fastest planet, orbiting the Sun every 88 Earth days."
          },
          {
            difficulty: "hard",
            question: "IF Mercury has an atmosphere THEN Mercury is the hottest planet.",
            operator: "IMPLIES (→)",
            p: "Mercury has a thick atmosphere",
            q: "Mercury is the hottest planet",
            pValue: false,
            qValue: false,
            correctIsTrue: true,
            explanation: "Conditional (IF-THEN): When P is false, P → Q is TRUE regardless of Q. Mercury lacks atmosphere, so the condition is not met.",
            funFact: "Mercury's lack of atmosphere means it has extreme temperature swings, not heat retention like Venus."
          },
          {
            difficulty: "hard",
            question: "Mercury is closest to the Sun IF AND ONLY IF it has the most extreme temperatures.",
            operator: "BICONDITIONAL (↔)",
            p: "Mercury is closest to the Sun",
            q: "Mercury has the most extreme temperatures",
            pValue: true,
            qValue: false,
            correctIsTrue: false,
            explanation: "Biconditional (IFF): P ↔ Q is true only if both have the same truth value. P is true but Q is false (Venus is hotter), so P ↔ Q = FALSE.",
            funFact: "Mercury's extreme temperature swings range from 840°F to -280°F, but Venus has a higher surface temperature overall."
          }
        ],
        Venus: [
          {
            difficulty: "medium",
            question: "Venus has a thick atmosphere AND Venus is hotter than Mercury.",
            operator: "AND (∧)",
            p: "Venus has a thick CO₂ atmosphere",
            q: "Venus is hotter than Mercury",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Conjunction (AND): Both P and Q are true. Venus has an extremely dense atmosphere creating a greenhouse effect, making it hotter than Mercury.",
            funFact: "Venus's surface reaches 900°F (475°C), hot enough to melt lead, while Mercury's extreme but lower average is cooler."
          },
          {
            difficulty: "hard",
            question: "NOT (Venus rotates from west to east like Earth).",
            operator: "NOT (¬)",
            p: "Venus rotates from west to east",
            pValue: false,
            correctIsTrue: true,
            explanation: "Negation (NOT): P is false (Venus rotates backwards). Therefore, ¬P = TRUE. Venus has a retrograde rotation.",
            funFact: "Venus rotates backwards and so slowly that a day on Venus is longer than its year!"
          },
          {
            difficulty: "hard",
            question: "IF Venus is Earth's closest neighbor THEN Venus has conditions supporting life.",
            operator: "IMPLIES (→)",
            p: "Venus is Earth's closest planetary neighbor",
            q: "Venus has conditions supporting human life",
            pValue: true,
            qValue: false,
            correctIsTrue: false,
            explanation: "Conditional (IF-THEN): P is true but Q is false. When the first is true and second is false, P → Q = FALSE. Venus is hostile to life.",
            funFact: "Venus is sometimes called Earth's 'sister planet' due to similar size, but its surface conditions are extremely hostile."
          },
          {
            difficulty: "hard",
            question: "Venus has an atmosphere IF AND ONLY IF it has sulfuric acid clouds.",
            operator: "BICONDITIONAL (↔)",
            p: "Venus has a dense atmosphere",
            q: "Venus has sulfuric acid clouds",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Biconditional (IFF): P ↔ Q is true when both have the same truth value. Both are true, so P ↔ Q = TRUE.",
            funFact: "Venus's clouds are composed of sulfuric acid droplets, and the pressure at the surface is over 90 times Earth's atmospheric pressure."
          }
        ],
        Earth: [
          {
            difficulty: "easy",
            question: "Earth has liquid water OR Earth has a protective atmosphere.",
            operator: "OR (∨)",
            p: "Earth has liquid water on surface",
            q: "Earth has a protective atmosphere",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Disjunction (OR): Both P and Q are true. Since at least one (actually both) is true, P ∨ Q = TRUE.",
            funFact: "Earth's atmosphere and liquid water together make it the only known planet with life."
          },
          {
            difficulty: "medium",
            question: "Earth supports life AND Earth is the only planet with life.",
            operator: "AND (∧)",
            p: "Earth supports life",
            q: "Earth is the only known planet with confirmed life",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Conjunction (AND): Both P and Q are true. We have confirmed life on Earth, and no other planet has confirmed life yet.",
            funFact: "About 71% of Earth's surface is covered by water, which is essential for all known life forms."
          },
          {
            difficulty: "hard",
            question: "IF Earth has the largest moon THEN Earth is the largest planet.",
            operator: "IMPLIES (→)",
            p: "Earth has the largest moon in the solar system",
            q: "Earth is the largest planet in the solar system",
            pValue: false,
            qValue: false,
            correctIsTrue: true,
            explanation: "Conditional (IF-THEN): When antecedent P is false, P → Q = TRUE regardless of Q. Jupiter has the largest planets and moons.",
            funFact: "Earth's Moon is large relative to its planet, but Jupiter is by far the largest planet in our solar system."
          },
          {
            difficulty: "hard",
            question: "Earth formed recently (geologically) IF AND ONLY IF it is 4.6 billion years old.",
            operator: "BICONDITIONAL (↔)",
            p: "Earth is 4.6 billion years old",
            q: "Earth is geologically young",
            pValue: true,
            qValue: false,
            correctIsTrue: false,
            explanation: "Biconditional (IFF): P ↔ Q is true only when both have the same truth value. P is true but Q is false, so P ↔ Q = FALSE.",
            funFact: "While 4.6 billion years sounds old, Earth is middle-aged compared to the 13.8 billion year-old universe."
          }
        ],
        Mars: [
          {
            difficulty: "medium",
            question: "NOT (Mars polar ice caps are made only of rock).",
            operator: "NOT (¬)",
            p: "Mars polar ice caps are made only of rock",
            pValue: false,
            correctIsTrue: true,
            explanation: "Negation (NOT): P is false (caps contain water and CO₂ ice). Therefore, ¬P = TRUE.",
            funFact: "Mars polar caps contain water ice and carbon dioxide ice (dry ice), which grow and shrink seasonally."
          },
          {
            difficulty: "easy",
            question: "Mars is red OR Mars was once wet.",
            operator: "OR (∨)",
            p: "Mars appears red due to iron oxide",
            q: "Mars had flowing water in the past",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Disjunction (OR): Both P and Q are true. Mars's rusty surface and evidence of ancient water make this statement TRUE.",
            funFact: "NASA rovers have found evidence that Mars had rivers, lakes, and possibly oceans billions of years ago."
          },
          {
            difficulty: "hard",
            question: "IF Mars has no liquid water NOW THEN it never had life.",
            operator: "IMPLIES (→)",
            p: "Mars has no liquid water on surface today",
            q: "Mars never had any form of life",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Conditional (IF-THEN): P is true and Q is true. P → Q = TRUE. (Though Q is uncertain, current evidence supports it.)",
            funFact: "Perseverance rover found potential biosignatures in ancient rocks, suggesting Mars may have hosted microbial life long ago."
          },
          {
            difficulty: "hard",
            question: "Mars is called the Red Planet IF AND ONLY IF it has iron oxide on its surface.",
            operator: "BICONDITIONAL (↔)",
            p: "Mars is called the Red Planet",
            q: "Mars has iron oxide (rust) on surface",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Biconditional (IFF): Both P and Q are true, so P ↔ Q = TRUE. The red color comes from the iron oxide.",
            funFact: "The rusty iron oxide in Mars's soil gives it the distinctive reddish appearance visible from Earth."
          }
        ],
        Jupiter: [
          {
            difficulty: "hard",
            question: "Jupiter is a gas giant AND Jupiter has no solid surface.",
            operator: "AND (∧)",
            p: "Jupiter is a gas giant",
            q: "Jupiter has no solid surface like Earth",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Conjunction (AND): Both P and Q are true. Jupiter is made mostly of hydrogen and helium with no solid crust.",
            funFact: "Jupiter's Great Red Spot is a giant storm larger than Earth that has been observed for hundreds of years."
          },
          {
            difficulty: "easy",
            question: "Jupiter is the largest planet OR Saturn is the largest planet.",
            operator: "OR (∨)",
            p: "Jupiter is the largest planet",
            q: "Saturn is the largest planet",
            pValue: true,
            qValue: false,
            correctIsTrue: true,
            explanation: "Disjunction (OR): P is true and Q is false. Since at least one is true, P ∨ Q = TRUE.",
            funFact: "Jupiter is by far the largest planet. More than 1,000 Earths could fit inside it!"
          },
          {
            difficulty: "hard",
            question: "IF Jupiter were made of rock THEN it would be a terrestrial planet.",
            operator: "IMPLIES (→)",
            p: "Jupiter is made of rock",
            q: "Jupiter is a terrestrial planet",
            pValue: false,
            qValue: false,
            correctIsTrue: true,
            explanation: "Conditional (IF-THEN): P is false (Jupiter is gas), so P → Q = TRUE regardless of Q.",
            funFact: "Jupiter's composition of mostly hydrogen and helium makes it fundamentally different from rocky terrestrial planets."
          },
          {
            difficulty: "hard",
            question: "Jupiter has moons IF AND ONLY IF it has a gravitational field.",
            operator: "BICONDITIONAL (↔)",
            p: "Jupiter has many moons (95+)",
            q: "Jupiter has a strong gravitational field",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Biconditional (IFF): Both P and Q are true. Jupiter's gravity captured and holds many moons.",
            funFact: "Jupiter's four large Galilean moons (Io, Europa, Ganymede, Callisto) are visible through even small telescopes."
          }
        ],
        Saturn: [
          {
            difficulty: "hard",
            question: "Saturn's rings are separate particles AND Saturn has many moons.",
            operator: "AND (∧)",
            p: "Saturn's rings are many separate particles",
            q: "Saturn has many natural satellites",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Conjunction (AND): Both P and Q are true. Saturn has 146+ moons and countless ring particles.",
            funFact: "Some of Saturn's moons act as 'shepherd moons,' using their gravity to keep ring edges sharp."
          },
          {
            difficulty: "easy",
            question: "Saturn is the second largest planet OR Saturn is made of hydrogen and helium.",
            operator: "OR (∨)",
            p: "Saturn is the second largest planet",
            q: "Saturn is composed of hydrogen and helium",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Disjunction (OR): Both P and Q are true. Saturn is second only to Jupiter and is a gas giant.",
            funFact: "Saturn is the least dense planet and would float in water if we could find a bathtub large enough!"
          },
          {
            difficulty: "hard",
            question: "IF Saturn had no rings THEN it would be indistinguishable from Jupiter.",
            operator: "IMPLIES (→)",
            p: "Saturn had no rings",
            q: "Saturn would look identical to Jupiter",
            pValue: false,
            qValue: false,
            correctIsTrue: true,
            explanation: "Conditional (IF-THEN): P is false (Saturn has spectacular rings), so P → Q = TRUE.",
            funFact: "Saturn's rings are composed of water ice, rock, and dust ranging from tiny particles to mountain-sized objects."
          },
          {
            difficulty: "hard",
            question: "Saturn has rings IF AND ONLY IF it is composed of ice and rock particles.",
            operator: "BICONDITIONAL (↔)",
            p: "Saturn has a ring system",
            q: "The rings are made of ice and rock",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Biconditional (IFF): Both P and Q are true. Saturn's distinctive rings are indeed composed of these materials.",
            funFact: "Saturn's rings span over 100,000 miles but in some places are only a few thousand feet thick!"
          }
        ],
        Uranus: [
          {
            difficulty: "hard",
            question: "Uranus rotates on its side AND Uranus is an ice giant.",
            operator: "AND (∧)",
            p: "Uranus rotates tilted ~98° on its side",
            q: "Uranus is an ice giant",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Conjunction (AND): Both P and Q are true. Uranus's extreme tilt and composition make this statement TRUE.",
            funFact: "Because of its extreme tilt, one pole of Uranus can face the Sun for many years while the other pole stays dark."
          },
          {
            difficulty: "medium",
            question: "NOT (Uranus has no rings).",
            operator: "NOT (¬)",
            p: "Uranus has no rings",
            pValue: false,
            correctIsTrue: true,
            explanation: "Negation (NOT): P is false (Uranus has 13 faint rings). Therefore, ¬P = TRUE.",
            funFact: "Uranus's rings are vertical due to the planet's extreme tilt, appearing to orbit like a spinning hula hoop."
          },
          {
            difficulty: "hard",
            question: "IF Uranus were closer to the Sun THEN it would be warmer than Neptune.",
            operator: "IMPLIES (→)",
            p: "Uranus is closer to the Sun than Neptune",
            q: "Uranus is warmer than Neptune",
            pValue: true,
            qValue: false,
            correctIsTrue: false,
            explanation: "Conditional (IF-THEN): P is true but Q is false. When first is true and second false, P → Q = FALSE.",
            funFact: "Surprisingly, Uranus is colder than Neptune despite being closer to the Sun!"
          },
          {
            difficulty: "hard",
            question: "Uranus is the third largest planet IF AND ONLY IF it is about 4x wider than Earth.",
            operator: "BICONDITIONAL (↔)",
            p: "Uranus is the third largest planet",
            q: "Uranus is about 4 times wider than Earth",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Biconditional (IFF): Both P and Q are true. Uranus's size makes it third only after Jupiter and Saturn.",
            funFact: "Voyager 2 is the only spacecraft to have visited Uranus, discovering many moons during its 1986 flyby."
          }
        ],
        Neptune: [
          {
            difficulty: "medium",
            question: "Neptune is the farthest planet OR Neptune has the strongest winds.",
            operator: "OR (∨)",
            p: "Neptune is the farthest planet from Sun",
            q: "Neptune has the strongest winds in solar system",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Disjunction (OR): Both P and Q are true. Neptune exceeds 1,200 mph winds despite being most distant.",
            funFact: "Neptune was the first planet discovered using mathematics to predict its position!"
          },
          {
            difficulty: "hard",
            question: "Neptune is an ice giant AND Neptune has less solar energy than Uranus.",
            operator: "AND (∧)",
            p: "Neptune is an ice giant",
            q: "Neptune receives less solar energy than Uranus",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Conjunction (AND): Both P and Q are true. Neptune's composition and distant location make both statements TRUE.",
            funFact: "Scientists hypothesize Neptune's internal heat source drives its powerful atmospheric circulation."
          },
          {
            difficulty: "hard",
            question: "IF Neptune had no internal heat source THEN it would have weaker winds than Uranus.",
            operator: "IMPLIES (→)",
            p: "Neptune has no internal heat",
            q: "Neptune has weaker winds than Uranus",
            pValue: false,
            qValue: false,
            correctIsTrue: true,
            explanation: "Conditional (IF-THEN): P is false (Neptune has internal heat). P → Q = TRUE.",
            funFact: "Neptune's internal heat is a mystery, but it likely explains its extreme wind speeds."
          },
          {
            difficulty: "hard",
            question: "Neptune was discovered by telescope IF AND ONLY IF its position was not predicted by math.",
            operator: "BICONDITIONAL (↔)",
            p: "Neptune was discovered by telescope observation",
            q: "Neptune's position was predicted by mathematics first",
            pValue: true,
            qValue: true,
            correctIsTrue: false,
            explanation: "Biconditional (IFF): Both P and Q are true, but the IFF statement reverses the logic. Neptune was discovered AFTER prediction, so P ↔ ¬Q = TRUE.",
            funFact: "Neptune's position was mathematically predicted before it was ever observed through a telescope in 1846!"
          }
        ]
      };

      // Create the planets array with random question selection
      function getRandomQuestion(planetName) {
        const questions = planetQuestionsBank[planetName] || [];
        return questions[Math.floor(Math.random() * questions.length)];
      }

      const planets = [
        { name: "Mercury", ...getRandomQuestion("Mercury") },
        { name: "Venus", ...getRandomQuestion("Venus") },
        { name: "Earth", ...getRandomQuestion("Earth") },
        { name: "Mars", ...getRandomQuestion("Mars") },
        { name: "Jupiter", ...getRandomQuestion("Jupiter") },
        { name: "Saturn", ...getRandomQuestion("Saturn") },
        { name: "Uranus", ...getRandomQuestion("Uranus") },
        { name: "Neptune", ...getRandomQuestion("Neptune") }
      ];

      const solarSystemEl = document.getElementById("solarSystem");
      const sunEl = document.getElementById("sun");
      const countdownOverlay = document.getElementById("countdownOverlay");
      const countdownNumberEl = document.getElementById("countdownNumber");
      const countdownFactsEl = document.getElementById("countdownFacts");
      const quizWrapper = document.getElementById("quizWrapper");
      const quizCard = document.getElementById("quizCard");
      const quizPlanetNameEl = document.getElementById("quizPlanetName");
      const difficultyPillEl = document.getElementById("difficultyPill");
      const questionTextEl = document.getElementById("questionText");
      const truthFactCellEl = document.getElementById("truthFactCell");
      const truthAnswerCellEl = document.getElementById("truthAnswerCell");
      const btnTrue = document.getElementById("btnTrue");
      const btnFalse = document.getElementById("btnFalse");
      const answerStatusEl = document.getElementById("answerStatus");
      const explanationTextEl = document.getElementById("explanationText");
      const planetFactTextEl = document.getElementById("planetFactText");
      const btnNext = document.getElementById("btnNext");
      const progressTextEl = document.getElementById("progressText");
      const summaryWrapper = document.getElementById("summaryWrapper");
      const summaryScoreEl = document.getElementById("summaryScore");
      const summaryDetailEl = document.getElementById("summaryDetail");
      const summaryAccuracyEl = document.getElementById("summaryAccuracy");
      const summaryTierEl = document.getElementById("summaryTier");
      const btnRestart = document.getElementById("btnRestart");
      const musicToggle = document.getElementById("musicToggle");
      const bgMusic = document.getElementById("bgMusic");
      const hudStateLabel = document.getElementById("hud-state-label");
      const quizMetaEl = document.getElementById("quizMeta");

      // Cache DOM queries
      const planetElements = Array.from(document.querySelectorAll(".planet"));
      const orbitElements = Array.from(document.querySelectorAll(".orbit.animate"));

      let hasLaunched = false;
      let currentPlanetIndex = 0;
      let score = 0;
      let answersGiven = 0;
      let countdownTimer = null;
      let orbitTime = 0;

      const orbitRadii = [80, 110, 145, 180, 260, 310, 360, 410];
      const orbitSpeeds = [1.8, 1.5, 1.2, 1.0, 0.6, 0.5, 0.45, 0.4];

      // Solar system facts for countdown
      const introFacts = [
        "Our solar system formed about 4.6 billion years ago from a cloud of gas and dust.",
        "The four inner planets are rocky worlds; the four outer planets are gas and ice giants.",
        "The Sun contains more than 99 percent of the mass of the solar system."
      ];

      function shuffle(array) {
        const arr = array.slice();
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      function setDifficultyPill(difficulty) {
        difficultyPillEl.classList.remove("difficulty-easy", "difficulty-medium", "difficulty-hard");
        let label = "Difficulty: ";
        if (difficulty === "easy") {
          label += "Easy";
          difficultyPillEl.classList.add("difficulty-easy");
        } else if (difficulty === "medium") {
          label += "Medium";
          difficultyPillEl.classList.add("difficulty-medium");
        } else {
          label += "Hard";
          difficultyPillEl.classList.add("difficulty-hard");
        }
        difficultyPillEl.textContent = label;
      }

      function highlightCurrentPlanet(index) {
        planetElements.forEach((el) => el.classList.remove("highlighted"));
        const match = planetElements.find((el) => Number(el.dataset.planetIndex) === index);
        if (match) {
          match.classList.add("highlighted");
        }
      }

      function clearHighlight() {
        planetElements.forEach((el) => el.classList.remove("highlighted"));
      }

      function startCountdown() {
        if (hasLaunched) return;
        hasLaunched = true;
        hudStateLabel.textContent = "Countdown in progress";

        solarSystemEl.classList.add("dimmed");
        document.body.classList.add("top-down-view");

        const shuffledFacts = shuffle(introFacts);
        countdownFactsEl.innerHTML = "";
        shuffledFacts.forEach((fact) => {
          const li = document.createElement("li");
          li.textContent = fact;
          countdownFactsEl.appendChild(li);
        });

        countdownNumberEl.textContent = "5";
        countdownOverlay.classList.add("visible");
        countdownOverlay.setAttribute("aria-hidden", "false");

        let remaining = 5;
        countdownTimer = window.setInterval(() => {
          remaining -= 1;
          countdownNumberEl.textContent = String(remaining);
          if (remaining <= 0) {
            window.clearInterval(countdownTimer);
            beginQuiz();
          }
        }, 1000);
      }

      function beginQuiz() {
        countdownOverlay.classList.remove("visible");
        countdownOverlay.setAttribute("aria-hidden", "true");

        solarSystemEl.classList.remove("side-view");
        solarSystemEl.classList.add("top-down");
        solarSystemEl.classList.remove("dimmed");
        
        // Pause expensive animations during quiz
        solarSystemEl.style.animationPlayState = "paused";
        
        hudStateLabel.textContent = "Top-down view: logic mission in progress";

        currentPlanetIndex = 0;
        score = 0;
        answersGiven = 0;
        summaryWrapper.classList.remove("visible");
        summaryWrapper.setAttribute("aria-hidden", "true");

        showQuestionForPlanet(currentPlanetIndex);
      }

      function showQuestionForPlanet(index) {
        const planet = planets[index];
        if (!planet) return;

        highlightCurrentPlanet(index);

        quizCard.dataset.planet = planet.name;
        quizPlanetNameEl.textContent = planet.name;
        setDifficultyPill(planet.difficulty);
        questionTextEl.textContent =
          "Decide whether this statement is true (T) or false (F) in the last column of the truth table.";
        truthFactCellEl.textContent = planet.question;
        truthAnswerCellEl.textContent = "?";

        explanationTextEl.textContent = "";
        planetFactTextEl.textContent = "";
        quizMetaEl.classList.remove("visible");
        quizMetaEl.classList.add("hidden");

        answerStatusEl.textContent = "";
        answerStatusEl.classList.remove("correct", "incorrect");

        btnTrue.disabled = false;
        btnFalse.disabled = false;
        btnNext.disabled = true;

        progressTextEl.textContent = "Planet " + (index + 1) + " of " + planets.length;

        quizWrapper.classList.add("visible");
        quizWrapper.setAttribute("aria-hidden", "false");
      }

      function handleAnswer(isTrueSelected) {
        const planet = planets[currentPlanetIndex];
        if (!planet) return;

        truthAnswerCellEl.textContent = isTrueSelected ? "T" : "F";

        const correct = planet.correctIsTrue === isTrueSelected;
        answersGiven += 1;
        if (correct) {
          score += 1;
          answerStatusEl.textContent = "Correct. Your truth table entry matches what NASA reports.";
          answerStatusEl.classList.remove("incorrect");
          answerStatusEl.classList.add("correct");
        } else {
          answerStatusEl.textContent = "Not quite. The correct truth table entry for this statement is the opposite.";
          answerStatusEl.classList.remove("correct");
          answerStatusEl.classList.add("incorrect");
        }

        explanationTextEl.textContent = planet.explanation;
        planetFactTextEl.textContent = planet.funFact;

        quizMetaEl.classList.remove("hidden");
        quizMetaEl.classList.add("visible");

        btnTrue.disabled = true;
        btnFalse.disabled = true;
        btnNext.disabled = false;
      }

      function goToNextPlanet() {
        const nextIndex = currentPlanetIndex + 1;
        if (nextIndex >= planets.length) {
          finishMission();
          return;
        }
        currentPlanetIndex = nextIndex;
        showQuestionForPlanet(currentPlanetIndex);
      }

      function finishMission() {
        clearHighlight();
        quizWrapper.classList.remove("visible");
        quizWrapper.setAttribute("aria-hidden", "true");

        // Resume animations
        solarSystemEl.style.animationPlayState = "running";

        const total = planets.length;
        const accuracy = total > 0 ? Math.round((score / total) * 100) : 0;

        summaryScoreEl.textContent = score + " / " + total;
        summaryDetailEl.textContent =
          "You completed a full orbit of logic checks across the solar system.";

        summaryAccuracyEl.textContent = "Accuracy: " + accuracy + "%";
        let tier;
        if (accuracy === 100) {
          tier = "Tier: Master navigator";
        } else if (accuracy >= 75) {
          tier = "Tier: Mission specialist";
        } else if (accuracy >= 50) {
          tier = "Tier: Cadet in training";
        } else {
          tier = "Tier: Keep practicing your truth tables";
        }
        summaryTierEl.textContent = tier;

        summaryWrapper.classList.add("visible");
        summaryWrapper.setAttribute("aria-hidden", "false");
        hudStateLabel.textContent = "Mission complete";
      }

      function restartMission() {
        score = 0;
        answersGiven = 0;
        currentPlanetIndex = 0;
        summaryWrapper.classList.remove("visible");
        summaryWrapper.setAttribute("aria-hidden", "true");
        hudStateLabel.textContent = "Awaiting launch";
        solarSystemEl.classList.remove("top-down");
        solarSystemEl.classList.add("side-view");
        
        // Resume animations when returning to side view
        solarSystemEl.style.animationPlayState = "running";
        
        clearHighlight();
        hasLaunched = false;
      }

      function toggleMusic() {
        if (!bgMusic) return;
        try {
          if (bgMusic.paused) {
            bgMusic.play().catch(function () { /* ignore autoplay errors */ });
            musicToggle.setAttribute("aria-pressed", "true");
          } else {
            bgMusic.pause();
            musicToggle.setAttribute("aria-pressed", "false");
          }
        } catch (e) {
          // fail silently
        }
      }

      function animateOrbits(timestamp) {
        orbitTime = timestamp * 0.00035;
        const width = solarSystemEl.clientWidth;
        const height = solarSystemEl.clientHeight;
        const centerX = width / 2;
        const centerY = height / 2;

        planetElements.forEach((el, index) => {
          const radius = orbitRadii[index] || 100;
          const speed = orbitSpeeds[index] || 1;
          const angle = orbitTime * speed + index * 0.9;
          const x = centerX + radius * Math.cos(angle);
          const y = centerY + radius * Math.sin(angle);

          el.style.left = x + "px";
          el.style.top = y + "px";
        });

        window.requestAnimationFrame(animateOrbits);
      }

      window.requestAnimationFrame(animateOrbits);

      sunEl.addEventListener("click", startCountdown);
      btnTrue.addEventListener("click", () => handleAnswer(true));
      btnFalse.addEventListener("click", () => handleAnswer(false));
      btnNext.addEventListener("click", goToNextPlanet);
      btnRestart.addEventListener("click", restartMission);
      musicToggle.addEventListener("click", toggleMusic);
    })();
  </script>
</body>
</html>
