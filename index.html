<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Solar System Logic Mission</title>

  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-space: #020310;
      --accent: #ffd700;
      --accent-soft: rgba(255, 215, 0, 0.2);
      --accent-glow: rgba(255, 215, 0, 0.4);
      --card-bg: rgba(7, 11, 30, 0.92);
      --text-main: #f5f7ff;
      --text-muted: #a4b0d0;
      --error: #ff5577;
      --success: #4ade80;
      --orbit-color: rgba(255, 255, 255, 0.1);
      --transition-fast: 0.35s ease-out;
      --transition-med: 0.6s ease-in-out;
      --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.5);
      --shadow-glow: 0 0 30px rgba(255, 215, 0, 0.3);
      --radius-card: 18px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Poppins", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: url("starfield.jpg") center/cover fixed no-repeat;
      color: var(--text-main);
      min-height: 100vh;
      min-height: 100dvh;
      overflow: auto;
      display: flex;
      align-items: stretch;
      justify-content: center;
    }

    body.top-down-view {
      background-image: url("nebula.jpg");
      background-size: cover;
      background-position: center;
    }

    .app-shell {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
      overflow: hidden;
      padding: 16px;
      min-height: 100vh;
      min-height: 100dvh;
    }

    .frame {
      border-radius: 26px;
      border: 1.5px solid rgba(255, 215, 0, 0.2);
      box-shadow: 0 22px 55px rgba(0, 0, 0, 0.7), 0 0 40px rgba(255, 215, 0, 0.15);
      backdrop-filter: blur(16px);
      background:
        url("asteroidbelt1.jpg") center/cover no-repeat,
        radial-gradient(circle at top left, rgba(108, 122, 255, 0.15), transparent 55%),
        radial-gradient(circle at bottom right, rgba(255, 215, 0, 0.12), transparent 55%),
        rgba(0, 0, 10, 0.96);
      height: auto;
      min-height: 540px;
      max-height: 900px;
      display: grid;
      grid-template-rows: auto 1fr auto;
      position: relative;
      overflow: hidden;
    }

    @media (max-height: 768px) {
      .frame {
        min-height: auto;
        max-height: none;
      }
    }

    header.app-header {
      padding: 16px 22px 8px;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      z-index: 40;
      background: linear-gradient(135deg, rgba(30, 45, 100, 0.15), rgba(15, 25, 60, 0.1));
      border-bottom: 1px solid rgba(255, 215, 0, 0.1);
    }

    .brand {
      display: none;
    }

    .hud-right {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .btn-ghost {
      border-radius: 999px;
      padding: 8px 14px;
      border: 1.5px solid rgba(255, 215, 0, 0.3);
      background: radial-gradient(circle at top, rgba(255, 255, 255, 0.15), transparent 60%),
                  rgba(5, 10, 32, 0.85);
      color: var(--text-main);
      cursor: pointer;
      font-size: 0.78rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s ease-out;
    }

    .btn-ghost:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.4), 0 0 20px rgba(255, 215, 0, 0.2);
      background: radial-gradient(circle at top, rgba(255, 255, 255, 0.3), transparent 60%),
                  rgba(10, 18, 54, 0.95);
    }

    .btn-ghost:active {
      transform: translateY(0);
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.15);
    }

    .btn-ghost[aria-pressed="true"] {
      border-color: var(--accent);
      background: radial-gradient(circle at top, rgba(255, 215, 0, 0.5), transparent 60%),
                  rgba(40, 30, 0, 0.98);
      box-shadow: 0 0 25px rgba(255, 215, 0, 0.25);
    }

    main.stage {
      position: relative;
      overflow: hidden;
      padding: 6px 20px 20px;
    }

    /* Solar system scene */
    .solar-system-wrapper {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      perspective: 1200px;
      overflow: hidden;
    }

    .solar-system {
      position: relative;
      width: 100%;
      max-width: 1200px;
      height: 100%;
      transform-style: flat;
      transition: opacity var(--transition-med), filter var(--transition-med);
      transform: scale(0.82);
    }

    .solar-system.dimmed {
      opacity: 0.18;
      filter: blur(3px);
    }

    .starfield {
      position: absolute;
      inset: -40px;
      background-image:
        radial-gradient(circle at 10% 20%, rgba(255, 255, 255, 0.9) 1px, transparent 1px),
        radial-gradient(circle at 80% 30%, rgba(255, 255, 255, 0.8) 1px, transparent 1px),
        radial-gradient(circle at 40% 80%, rgba(255, 255, 255, 0.85) 1px, transparent 1px),
        radial-gradient(circle at 20% 75%, rgba(200, 220, 255, 0.8) 1px, transparent 1px),
        radial-gradient(circle at 65% 15%, rgba(255, 220, 200, 0.7) 1px, transparent 1px);
      background-size: 250% 250%, 220% 220%, 280% 280%, 240% 240%, 260% 260%;
      background-position: 0% 0%, 10% 20%, 5% 15%, 15% 25%, 20% 10%;
      opacity: 0.9;
      mix-blend-mode: screen;
      pointer-events: none;
      animation: twinkle-stars 10s ease-in-out infinite alternate;
      will-change: opacity;
      contain: layout style paint;
    }

    @keyframes twinkle-stars {
      0% { opacity: 0.75; }
      100% { opacity: 0.95; }
    }

    .deep-stars {
      position: absolute;
      inset: -60px;
      background-image:
        radial-gradient(circle at 25% 10%, rgba(255, 255, 255, 0.95) 0, transparent 1px),
        radial-gradient(circle at 70% 85%, rgba(255, 255, 255, 0.9) 0, transparent 1px),
        radial-gradient(circle at 30% 60%, rgba(150, 200, 255, 0.85) 0, transparent 1px),
        radial-gradient(circle at 88% 40%, rgba(255, 255, 255, 0.8) 0, transparent 1px),
        radial-gradient(circle at 12% 35%, rgba(200, 255, 255, 0.8) 0, transparent 1px);
      opacity: 0.8;
      mix-blend-mode: screen;
      filter: blur(0.5px);
      pointer-events: none;
      z-index: -1;
      animation: twinkle 6s ease-in-out infinite alternate;
      will-change: opacity;
      contain: layout style paint;
    }

    @keyframes twinkle {
      0%   { opacity: 0.5; }
      100% { opacity: 0.7; }
    }

    .galaxy-clouds {
      position: absolute;
      inset: -80px;
      background:
        radial-gradient(circle at 5% 20%, rgba(140, 183, 255, 0.25), transparent 65%),
        radial-gradient(circle at 85% 65%, rgba(248, 182, 255, 0.25), transparent 65%);
      opacity: 0.18;
      mix-blend-mode: screen;
      pointer-events: none;
      z-index: -2;
      will-change: opacity;
      contain: layout style paint;
    }

    .far-galaxy {
      display: none;
    }

    .twinkle-layer {
      display: none;
    }

    .orbit {
      position: absolute;
      border-radius: 50%;
      border: 2.5px solid rgba(100, 180, 255, 0.45);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none;
      box-shadow: 0 0 8px rgba(100, 180, 255, 0.35);
      will-change: transform;
      contain: layout style;
    }

    .orbit.animate {
      animation: orbit-rotate 28s linear infinite;
      transform-origin: center center;
    }

    @keyframes orbit-rotate {
      from {
        transform: translate(-50%, -50%) rotateZ(0deg);
      }
      to {
        transform: translate(-50%, -50%) rotateZ(360deg);
      }
    }

    .star {
      position: absolute;
      width: 110px;
      height: 110px;
      border-radius: 50%;
      background: radial-gradient(circle at 20% 15%, #ffffff, #ffd36a 40%, #ff9b21 70%, rgba(0, 0, 0, 0) 72%),
                  url("Textures/sun.jpg") center/cover no-repeat;
      box-shadow:
        0 0 50px rgba(255, 150, 40, 1),
        0 0 100px rgba(255, 100, 20, 0.8),
        0 0 150px rgba(255, 150, 40, 0.5);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      cursor: pointer;
      transition: all 0.25s ease-out;
      z-index: 4;
      will-change: transform, box-shadow;
      contain: layout style paint;
      filter: brightness(1.2);
    }

    .star::after {
      content: "Click the Sun to begin";
      position: absolute;
      left: 130%;
      top: 50%;
      transform: translateY(-50%);
      white-space: nowrap;
      font-size: 0.85rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.25);
      border: 1px solid rgba(255, 255, 255, 0.08);
      color: rgba(245, 247, 255, 0.6);
    }

    .star:hover {
      transform: translate(-50%, -50%) scale(1.06);
      box-shadow:
        0 0 60px rgba(255, 206, 138, 0.95),
        0 0 150px rgba(255, 180, 80, 0.9);
      filter: saturate(1.2);
    }

    .star:active {
      transform: translate(-50%, -50%) scale(1.02);
    }

    .planet {
      position: absolute;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      box-shadow:
        0 6px 18px rgba(0, 0, 0, 0.8),
        0 0 20px rgba(100, 180, 255, 0.2);
      transform: translate(-50%, -50%);
      transition: all var(--transition-fast);
      will-change: transform;
      contain: layout style paint;
      backface-visibility: hidden;
      perspective: 1000px;
    }

    .planet::after {
      content: attr(data-name);
      position: absolute;
      top: 108%;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-muted);
      text-shadow: 0 0 6px rgba(0, 0, 0, 0.8);
    }

    .planet.mercury { width: 10px; height: 10px; background-image: url("Textures/mercury.jpg"); }
    .planet.venus   { width: 18px; height: 18px; background-image: url("Textures/venus.jpg"); }
    .planet.earth   { width: 20px; height: 20px; background-image: url("Textures/earth.jpg"); }
    .planet.mars    { width: 14px; height: 14px; background-image: url("Textures/mars.jpg"); }
    .planet.jupiter { width: 42px; height: 42px; background-image: url("Textures/jupiter.jpg"); }
    .planet.saturn  {
      width: 36px;
      height: 36px;
      background-image: url("Textures/saturn.jpg");
    }
    .planet.uranus  { width: 26px; height: 26px; background-image: url("Textures/uranus.jpg"); }
    .planet.neptune { width: 24px; height: 24px; background-image: url("Textures/neptune.jpg"); }

    .planet.saturn::before {
      content: "";
      position: absolute;
      inset: 50%;
      width: 72px;
      height: 26px;
      margin-left: -36px;
      margin-top: -13px;
      border-radius: 50%;
      border: 3px solid rgba(219, 204, 170, 0.9);
      border-left-color: rgba(219, 204, 170, 0.35);
      border-right-color: rgba(219, 204, 170, 0.35);
      transform: rotate(-18deg);
      box-shadow: 0 0 10px rgba(219, 204, 170, 0.7);
      pointer-events: none;
    }

    .planet.highlighted {
      box-shadow:
        0 0 18px rgba(255, 255, 255, 0.75),
        0 0 45px rgba(103, 185, 255, 0.75);
      filter: saturate(1.3);
      transform: translate(-50%, -50%) scale(1.2);
    }

    /* Planet positions will be driven by JavaScript to orbit around the Sun */

    /* Orbits (used more in top-down) */
    .orbit.mercury { width: 160px; height: 160px; }
    .orbit.venus   { width: 220px; height: 220px; }
    .orbit.earth   { width: 290px; height: 290px; }
    .orbit.mars    { width: 360px; height: 360px; }
    .orbit.jupiter { width: 520px; height: 520px; }
    .orbit.saturn  { width: 620px; height: 620px; }
    .orbit.uranus  { width: 720px; height: 720px; }
    .orbit.neptune { width: 820px; height: 820px; }

    .asteroid-belt {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 410px;
      height: 410px;
      transform: translate(-50%, -50%) rotate(8deg);
      border-radius: 50%;
      background-image: url("asteroidbelt1.jpg");
      background-size: cover;
      background-position: center;
      opacity: 0.35;
      mix-blend-mode: multiply;
      pointer-events: none;
      filter: blur(0.3px);
    }

    /* Overlay countdown */
    .overlay {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.92));
      opacity: 0;
      pointer-events: none;
      transition: opacity var(--transition-med);
      z-index: 60;
    }

    .overlay.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .countdown-panel {
      max-width: 500px;
      width: 90%;
      padding: 26px 22px 22px;
      border-radius: var(--radius-card);
      background: radial-gradient(circle at top left, rgba(255, 215, 0, 0.18), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(120, 179, 255, 0.22), transparent 55%),
                  rgba(4, 11, 30, 0.96);
      box-shadow: var(--shadow-soft), 0 0 35px rgba(255, 215, 0, 0.12);
      border: 1.5px solid rgba(255, 215, 0, 0.2);
      text-align: center;
    }

    .countdown-title {
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .countdown-number {
      font-size: 2.8rem;
      font-weight: 700;
      letter-spacing: 0.2em;
      text-indent: 0.2em;
      color: var(--accent);
      text-shadow: 0 0 26px rgba(255, 212, 143, 0.8);
      margin: 6px 0 8px;
    }

    .countdown-subtitle {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 14px;
    }

    .fact-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 0.82rem;
      color: var(--text-main);
      text-align: left;
    }

    .fact-list li {
      padding: 6px 9px;
      border-radius: 999px;
      background: rgba(13, 20, 53, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    /* Quiz card */
    .quiz-wrapper {
      position: absolute;
      inset: 0;
      pointer-events: none;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
      opacity: 0;
      transition: opacity var(--transition-med);
    }

    .quiz-wrapper.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .quiz-card {
      max-width: 720px;
      width: 100%;
      margin: 0 16px;
      padding: 22px 22px 18px;
      background:
        url("dwarfplanets1.jpg") center/cover no-repeat,
        var(--card-bg);
      border-radius: var(--radius-card);
      border: 1.5px solid rgba(255, 215, 0, 0.2);
      box-shadow: var(--shadow-soft), 0 0 35px rgba(255, 215, 0, 0.12);
      backdrop-filter: blur(18px);
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2.4fr);
      gap: 18px;
      position: relative;
      overflow: hidden;
    }

    .quiz-card::before {
      content: "";
      position: absolute;
      inset: -30%;
      background-size: cover;
      background-position: center;
      opacity: 0.18;
      mix-blend-mode: screen;
      pointer-events: none;
      transition: all var(--transition-med);
      transform: scale(1.12);
    }

    .quiz-card[data-planet="Mercury"]::before { background-image: url("Textures/mercury.jpg"); }
    .quiz-card[data-planet="Venus"]::before   { background-image: url("Textures/venus.jpg"); }
    .quiz-card[data-planet="Earth"]::before   { background-image: url("Textures/earth.jpg"); }
    .quiz-card[data-planet="Mars"]::before    { background-image: url("Textures/mars.jpg"); }
    .quiz-card[data-planet="Jupiter"]::before { background-image: url("Textures/jupiter.jpg"); }
    .quiz-card[data-planet="Saturn"]::before  { background-image: url("Textures/saturn.jpg"); }
    .quiz-card[data-planet="Uranus"]::before  { background-image: url("Textures/uranus.jpg"); }
    .quiz-card[data-planet="Neptune"]::before { background-image: url("Textures/neptune.jpg"); }

    .quiz-main {
      padding-right: 8px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .quiz-badge-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* Performance: disable expensive animations in top-down view */
    .solar-system.top-down .starfield,
    .solar-system.top-down .deep-stars,
    .solar-system.top-down .twinkle-layer {
      animation: none !important;
      opacity: 0;
      pointer-events: none;
    }

    .solar-system.top-down .orbit {
      animation: none !important;
      border-color: rgba(100, 180, 255, 0.2);
      box-shadow: none;
    }

    .quiz-planet-label {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-muted);
    }

    .quiz-question-heading {
      font-size: 1.05rem;
      font-weight: 600;
    }

    .truth-table {
      margin-top: 10px;
      border-collapse: collapse;
      width: 100%;
      font-size: 0.82rem;
      background: linear-gradient(135deg, rgba(15, 25, 60, 0.8), rgba(10, 18, 50, 0.9));
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.08);
    }

    .truth-table thead {
      background: linear-gradient(135deg, rgba(20, 35, 80, 0.95), rgba(15, 28, 70, 0.95));
      border-bottom: 1.5px solid rgba(255, 215, 0, 0.15);
    }

    .truth-table th,
    .truth-table td {
      padding: 8px 10px;
      border: 1px solid rgba(255, 215, 0, 0.08);
    }

    .truth-table tbody tr:nth-child(odd) {
      background: rgba(10, 18, 50, 0.85);
    }

    .truth-table tbody tr:nth-child(even) {
      background: rgba(8, 15, 42, 0.85);
    }

    .answer-buttons {
      margin-top: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .btn-answer {
      flex: 0 0 auto;
      min-width: 90px;
      padding: 10px 16px;
      border-radius: 999px;
      border: 1.5px solid rgba(255, 215, 0, 0.25);
      background: linear-gradient(135deg, rgba(30, 45, 100, 0.8), rgba(15, 25, 60, 0.9));
      color: var(--text-main);
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      transition: all 0.2s ease-out;
    }

    .btn-answer:hover {
      background: linear-gradient(135deg, rgba(50, 70, 140, 0.95), rgba(25, 40, 90, 1));
      transform: translateY(-2px);
      box-shadow: 0 14px 32px rgba(0, 0, 0, 0.5), 0 0 20px rgba(255, 215, 0, 0.15);
      border-color: rgba(255, 215, 0, 0.4);
    }

    .btn-answer:active {
      transform: translateY(0);
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
    }

    .btn-answer[disabled] {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    .answer-status {
      margin-top: 8px;
      padding: 6px 8px;
      border-radius: 8px;
      font-size: 0.86rem;
      font-weight: 600;
    }

    .answer-status.correct {
      color: #4ade80;
      background: rgba(74, 222, 128, 0.15);
      border-left: 3px solid #4ade80;
      padding-left: 10px;
    }

    .answer-status.incorrect {
      color: #ff5577;
      background: rgba(255, 85, 119, 0.15);
      border-left: 3px solid #ff5577;
      padding-left: 10px;
    }

    .quiz-meta {
      border-radius: 14px;
      padding: 12px 14px;
      background: linear-gradient(135deg, rgba(10, 20, 50, 0.8), rgba(5, 12, 35, 0.9));
      border: 1.5px solid rgba(255, 215, 0, 0.15);
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.08);
      display: flex;
      flex-direction: column;
      gap: 10px;
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .quiz-meta.hidden {
      opacity: 0;
      pointer-events: none;
      transform: translateY(8px);
      transition: all var(--transition-med);
    }

    .quiz-meta.visible {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    .quiz-meta h3 {
      font-size: 0.86rem;
      font-weight: 600;
      color: var(--text-main);
    }

    .quiz-meta .fact-label {
      font-weight: 600;
      color: var(--accent);
      font-size: 0.78rem;
      margin-bottom: 4px;
    }

    .quiz-meta p {
      line-height: 1.45;
    }

    .quiz-footer {
      margin-top: 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .btn-next {
      padding: 10px 20px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      background: linear-gradient(135deg, #ffd700, #ffaa00);
      color: #1a1000;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.8), 0 0 30px rgba(255, 215, 0, 0.3);
      transition: all 0.2s ease-out;
    }

    .btn-next:hover:not([disabled]) {
      transform: translateY(-2px);
      box-shadow: 0 22px 50px rgba(0, 0, 0, 0.9), 0 0 40px rgba(255, 215, 0, 0.5);
      filter: brightness(1.08);
    }

    .btn-next:active:not([disabled]) {
      transform: translateY(0);
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.7), 0 0 20px rgba(255, 215, 0, 0.25);
    }

    .btn-next[disabled] {
      opacity: 0.5;
      cursor: default;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
    }

    /* Summary */
    .summary-wrapper {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      opacity: 0;
      transition: opacity var(--transition-med);
      z-index: 55;
    }

    .summary-wrapper.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .summary-card {
      max-width: 540px;
      width: 90%;
      padding: 24px 22px 18px;
      border-radius: var(--radius-card);
      background:
        radial-gradient(circle at top left, rgba(255, 215, 0, 0.18), transparent 55%),
        radial-gradient(circle at bottom right, rgba(120, 179, 255, 0.22), transparent 55%),
        rgba(3, 9, 26, 0.97);
      border: 1.5px solid rgba(255, 215, 0, 0.2);
      box-shadow: var(--shadow-soft), 0 0 35px rgba(255, 215, 0, 0.12);
      text-align: center;
    }

    .summary-title {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .summary-score {
      font-size: 2.1rem;
      font-weight: 700;
      color: var(--accent);
      text-shadow: 0 0 30px rgba(255, 217, 144, 0.9);
      margin: 4px 0;
    }

    .summary-detail {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 14px;
    }

    .summary-metrics {
      display: flex;
      justify-content: center;
      gap: 14px;
      margin-bottom: 18px;
      font-size: 0.8rem;
    }

    .summary-metrics span {
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(7, 13, 39, 0.96);
      border: 1px solid rgba(255, 255, 255, 0.12);
    }

    .summary-actions {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn-outline {
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.24);
      background: transparent;
      color: var(--text-main);
      cursor: pointer;
      font-size: 0.86rem;
      font-weight: 500;
      transition: all 0.16s ease-out;
    }

    .btn-outline:hover {
      background: rgba(13, 23, 68, 0.96);
      transform: translateY(-1px);
      box-shadow: 0 14px 28px rgba(0, 0, 0, 0.55);
    }

    .btn-outline:active {
      transform: translateY(0);
      box-shadow: none;
    }

    footer.app-footer {
      display: none;
    }

    /* Responsive */
    @media (max-width: 840px) {
      .frame {
        grid-template-rows: auto 1fr auto;
        min-height: 560px;
      }

      .quiz-card {
        grid-template-columns: minmax(0, 1fr);
        padding: 18px 16px 16px;
      }

      .quiz-main {
        padding-right: 0;
      }

      .quiz-footer {
        flex-direction: column-reverse;
        align-items: flex-start;
      }

      .summary-card {
        padding-inline: 18px;
      }
    }

    @media (max-width: 768px) {
      :root {
        font-size: 14px;
      }

      .app-shell {
        padding: 8px;
      }

      .frame {
        height: calc(100vh - 16px);
        border-radius: 16px;
      }

      header.app-header {
        padding: 12px 16px 6px;
      }

      .hud-right {
        font-size: 0.65rem;
        gap: 8px;
      }

      .solar-system {
        transform: scale(0.65);
      }

      .quiz-card {
        padding: 14px 12px 12px;
      }

      .quiz-main {
        gap: 12px;
      }

      .quiz-planet-label {
        font-size: 0.9rem;
      }

      .quiz-question-heading {
        font-size: 1rem;
        line-height: 1.4;
      }

      .truth-table {
        font-size: 0.85rem;
      }

      .truth-table td,
      .truth-table th {
        padding: 8px 6px;
      }

      .answer-buttons {
        flex-direction: column;
        gap: 8px;
      }

      .btn-answer,
      .btn-outline {
        padding: 10px 12px;
        font-size: 0.9rem;
        border-radius: 8px;
      }

      .quiz-footer {
        gap: 8px;
        padding: 0;
      }

      .answer-panel {
        padding: 12px;
        gap: 8px;
      }

      .summary-card {
        padding: 16px 12px;
      }

      .summary-score {
        font-size: 2rem;
      }

      .app-footer {
        padding: 8px 12px;
        font-size: 0.65rem;
      }
    }

    @media (max-width: 640px) {
      :root {
        font-size: 13px;
      }

      body {
        padding: 0;
      }

      .app-shell {
        padding: 4px;
      }

      .frame {
        height: calc(100vh - 8px);
        border-radius: 12px;
        min-height: 100vh;
      }

      header.app-header {
        padding: 10px 12px 4px;
      }

      .brand {
        display: none;
      }

      .hud-right {
        display: none;
      }

      .solar-system {
        transform: scale(0.55);
      }

      main.stage {
        padding: 4px 10px 10px;
      }

      .solar-system-wrapper {
        min-height: 280px;
      }

      .quiz-wrapper {
        opacity: 1 !important;
        pointer-events: auto !important;
      }

      .quiz-card {
        border-radius: 12px;
        padding: 12px 10px 10px;
      }

      .quiz-main {
        gap: 10px;
      }

      .quiz-badge-row {
        flex-direction: column;
        gap: 6px;
      }

      .quiz-planet-label {
        font-size: 0.85rem;
      }

      .quiz-question-heading {
        font-size: 0.9rem;
        line-height: 1.3;
        font-weight: 600;
      }

      .truth-table {
        font-size: 0.8rem;
        margin: 8px 0;
      }

      .truth-table thead {
        font-size: 0.75rem;
      }

      .truth-table td,
      .truth-table th {
        padding: 6px 4px;
      }

      .truth-table th:first-child {
        width: 65%;
      }

      .truth-table th:last-child {
        width: 35%;
      }

      .answer-buttons {
        flex-direction: column;
        gap: 6px;
      }

      .btn-answer {
        padding: 10px 8px;
        font-size: 0.85rem;
        font-weight: 600;
        border-radius: 6px;
        min-height: 40px;
        touch-action: manipulation;
      }

      .btn-outline {
        padding: 8px 10px;
        font-size: 0.8rem;
        border-radius: 6px;
      }

      .quiz-footer {
        flex-direction: column-reverse;
        gap: 6px;
        padding-top: 8px;
      }

      .answer-panel {
        padding: 10px;
        gap: 6px;
        border-radius: 8px;
      }

      .answer-status {
        font-size: 0.9rem;
        font-weight: 600;
      }

      .explanation-text {
        font-size: 0.8rem;
        line-height: 1.3;
      }

      .planet-fact-text {
        font-size: 0.75rem;
        line-height: 1.3;
      }

      .summary-wrapper {
        padding: 0;
      }

      .summary-card {
        padding: 14px 10px;
        border-radius: 12px;
      }

      .summary-score {
        font-size: 2.5rem;
      }

      .summary-detail {
        font-size: 0.85rem;
      }

      .summary-tier {
        font-size: 0.9rem;
      }

      .star::after {
        font-size: 0.6rem;
        padding: 4px 6px;
        left: 120%;
        top: 55%;
      }

      .app-footer {
        padding: 6px 8px;
        flex-direction: column;
        gap: 4px;
        font-size: 0.6rem;
      }

      .footer-left,
      .footer-right {
        width: 100%;
        text-align: center;
      }

      .countdown-panel {
        width: 90%;
        padding: 16px 14px 14px;
      }

      .countdown-title {
        font-size: 1.1rem;
        margin-bottom: 8px;
      }

      .countdown-number {
        font-size: 2.2rem;
        font-weight: 700;
      }

      .countdown-facts {
        font-size: 0.75rem;
        gap: 6px;
      }

      .countdown-facts li {
        line-height: 1.3;
      }
    }

    @media (max-width: 480px) {
      :root {
        font-size: 12px;
      }

      .frame {
        border-radius: 8px;
      }

      .quiz-card {
        padding: 10px 8px;
      }

      .solar-system {
        transform: scale(0.48);
      }

      .quiz-question-heading {
        font-size: 0.85rem;
      }

      .truth-table {
        font-size: 0.75rem;
      }

      .btn-answer {
        padding: 9px 6px;
        font-size: 0.8rem;
        min-height: 38px;
      }

      .summary-score {
        font-size: 2rem;
      }

      .answer-status {
        font-size: 0.85rem;
      }

      .quiz-wrapper.visible {
        position: fixed;
        inset: 0;
        z-index: 100;
      }
    }

    @media (max-height: 600px) {
      .frame {
        max-height: none;
        height: auto;
      }

      main.stage {
        min-height: 300px;
      }

      .solar-system {
        transform: scale(0.5);
      }

      .quiz-card {
        padding: 10px;
      }
    }

    /* Additional mobile touch improvements */
    @media (hover: none) and (pointer: coarse) {
      .btn-answer,
      .btn-outline,
      .btn-ghost,
      .star {
        min-height: 44px;
        min-width: 44px;
        padding: 12px;
      }

      .btn-answer:active,
      .btn-outline:active,
      .btn-ghost:active {
        opacity: 0.8;
        background: var(--accent);
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <div class="frame">
      <header class="app-header">
        <button id="musicToggle" class="btn-ghost" type="button" aria-pressed="false">
          <span>Music</span>
        </button>
      </header>

      <main class="stage">
        <div class="solar-system-wrapper">
          <div id="solarSystem" class="solar-system side-view">
            <div class="galaxy-clouds"></div>
            <div class="deep-stars"></div>
            <div class="starfield"></div>
            <div class="asteroid-belt"></div>

            <!-- Orbits -->
            <div class="orbit mercury animate"></div>
            <div class="orbit venus animate"></div>
            <div class="orbit earth animate"></div>
            <div class="orbit mars animate"></div>
            <div class="orbit jupiter animate"></div>
            <div class="orbit saturn animate"></div>
            <div class="orbit uranus animate"></div>
            <div class="orbit neptune animate"></div>

            <!-- Sun -->
            <div id="sun" class="star" role="button" aria-label="Click the Sun to start mission"></div>

            <!-- Planets -->
            <div class="planet mercury orbiting" data-name="Mercury" data-planet-index="0"></div>
            <div class="planet venus orbiting" data-name="Venus" data-planet-index="1"></div>
            <div class="planet earth orbiting" data-name="Earth" data-planet-index="2"></div>
            <div class="planet mars orbiting" data-name="Mars" data-planet-index="3"></div>
            <div class="planet jupiter orbiting" data-name="Jupiter" data-planet-index="4"></div>
            <div class="planet saturn orbiting" data-name="Saturn" data-planet-index="5"></div>
            <div class="planet uranus orbiting" data-name="Uranus" data-planet-index="6"></div>
            <div class="planet neptune orbiting" data-name="Neptune" data-planet-index="7"></div>
          </div>
        </div>

        <!-- Countdown overlay -->
        <div id="countdownOverlay" class="overlay" aria-hidden="true">
          <div class="countdown-panel">
            <div class="countdown-title">Ready?</div>
            <div id="countdownNumber" class="countdown-number">5</div>
            <div class="countdown-subtitle">Your logic mission through the solar system begins in:</div>
            <ul id="countdownFacts" class="fact-list"></ul>
          </div>
        </div>

        <!-- Quiz card -->
        <div id="quizWrapper" class="quiz-wrapper" aria-hidden="true">
          <article id="quizCard" class="quiz-card" data-planet="">
            <div class="quiz-card-inner">
              <section class="quiz-main">
                <div class="quiz-badge-row">
                  <span class="quiz-planet-label">Planet <span id="quizPlanetName"></span></span>
                </div>
                <div class="quiz-question-heading" id="questionText"></div>

                <table class="truth-table" aria-label="Truth table for your answer">
                  <thead>
                    <tr>
                      <th style="width: 70%;">Proposition about this planet</th>
                      <th style="width: 30%;">Truth value in last column</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td id="truthFactCell"></td>
                      <td id="truthAnswerCell">?</td>
                    </tr>
                  </tbody>
                </table>

                <div class="answer-buttons">
                  <button id="btnTrue" class="btn-answer" type="button">True (T)</button>
                  <button id="btnFalse" class="btn-answer" type="button">False (F)</button>
                </div>
                <div id="answerStatus" class="answer-status"></div>
              </section>

              <aside class="quiz-meta hidden" id="quizMeta">
                <h3>Explanation</h3>
                <div>
                  <div class="fact-label">Why this is correct or incorrect:</div>
                  <p id="explanationText"></p>
                </div>
                <div>
                  <div class="fact-label">Surprising fact about this planet:</div>
                  <p id="planetFactText"></p>
                </div>
                <div class="quiz-footer">
                  <span id="progressText">Planet 1 of 8</span>
                  <button id="btnNext" class="btn-next" type="button" disabled>Next planet</button>
                </div>
              </aside>
            </div>
          </article>
        </div>

        <!-- Summary -->
        <div id="summaryWrapper" class="summary-wrapper" aria-hidden="true">
          <section class="summary-card">
            <div class="summary-title">Mission summary</div>
            <div id="summaryScore" class="summary-score"></div>
            <div id="summaryDetail" class="summary-detail"></div>
            <div class="summary-metrics">
              <span id="summaryAccuracy"></span>
              <span id="summaryTier"></span>
            </div>
            <div class="summary-actions">
              <button id="btnRestart" class="btn-outline" type="button">Run mission again</button>
              <!-- ADDED BUTTON HERE -->
              <button id="btnVisitSite" class="btn-outline" type="button">Visit Solar System Site</button>
            </div>
          </section>
        </div>

        <!-- Audio -->
        <audio id="bgMusic" loop>
          <source src="dream.mp3" type="audio/mpeg" />
        </audio>
      </main>

      <footer class="app-footer">
        <div class="footer-left">
          <span class="footer-pill">Perspective: side-on orbit view &rarr; top-down quiz view</span>
        </div>
        <div class="footer-right">
          <span>Questions are based on information from NASA educational resources.</span>
        </div>
      </footer>
    </div>
  </div>

  <script>
    (function () {
      const planetQuestionsBank = {
        Mercury: [
          {
            question: "Statement P: Mercury has a thick atmosphere.\nStatement Q: Mercury has extreme temperature variations.\n\nEvaluate: ¬P ∧ Q",
            operator: "Negation & Conjunction (¬P ∧ Q)",
            p: "Mercury does NOT have a thick atmosphere",
            q: "Mercury has extreme temperature variations",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Mercury possesses a thin exosphere made up of atoms blasted off the surface. Day temperatures reach 800°F (430°C) while nighttime temperatures drop to -290°F (-180°C). Both statements are true.",
            funFact: "Mercury has the most extreme temperature swings in the solar system due to its thin atmosphere."
          },
          {
            question: "Statement P: Mercury is the closest planet to the Sun.\nStatement Q: Mercury is the hottest planet in the solar system.\n\nEvaluate: P ∧ Q",
            operator: "Conjunction (∧)",
            p: "Mercury is the closest planet to the Sun",
            q: "Mercury is the hottest planet",
            pValue: true,
            qValue: false,
            correctIsTrue: false,
            explanation: "Mercury is the closest planet to the Sun, but Venus is the hottest due to its thick atmosphere. Since Q is false, P ∧ Q = FALSE.",
            funFact: "Venus is the hottest planet, not Mercury, despite being farther from the Sun."
          },
          {
            question: "Statement P: Mercury has a metallic core.\nStatement Q: Mercury has many impact craters.\nStatement R: Mercury has a magnetic field.\n\nEvaluate: P ∧ Q ∧ R",
            operator: "Conjunction (∧)",
            p: "Mercury has a metallic core",
            q: "Mercury has many impact craters",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Mercury has a large metallic core (85% of planet's radius), its surface is scarred by many impact craters, and it has a magnetic field with 1% Earth's strength. All three statements are true.",
            funFact: "Mercury's huge metallic core makes it one of the densest planets relative to its size."
          }
        ],
        Venus: [
          {
            question: "Statement P: Venus has the hottest surface temperature in the solar system (excluding Sun).\nStatement Q: Venus has a thick atmosphere with carbon dioxide.\n\nEvaluate: P ↔ Q",
            operator: "Biconditional (↔)",
            p: "Venus has the hottest surface temperature (excluding Sun)",
            q: "Venus has a thick CO₂ atmosphere",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Venus has the hottest surface in the solar system apart from the Sun, with an atmosphere mostly of carbon dioxide creating extreme greenhouse effect. Both statements are true.",
            funFact: "Venus's atmosphere is 90 times denser than Earth's and creates a surface temperature hot enough to melt lead."
          },
          {
            question: "Statement P: Venus rotates the same direction as Earth.\nStatement Q: Venus day is shorter than its year.\n\nEvaluate: P ∨ Q",
            operator: "Disjunction (∨)",
            p: "Venus rotates the same direction as Earth",
            q: "Venus day is shorter than its year",
            pValue: false,
            qValue: false,
            correctIsTrue: false,
            explanation: "Venus rotates backwards and has a longer day than its year. Both statements are false, so P ∨ Q = FALSE.",
            funFact: "Venus has a retrograde rotation, meaning the Sun rises in the west and sets in the east."
          },
          {
            question: "Statement P: Venus has its own internally generated magnetic field.\nStatement Q: Venus has thick carbon dioxide clouds.\n\nEvaluate: P ∧ Q",
            operator: "Conjunction (∧)",
            p: "Venus has its own internally generated magnetic field",
            q: "Venus has thick CO₂ clouds",
            pValue: false,
            qValue: true,
            correctIsTrue: false,
            explanation: "Venus does not have its own internally generated magnetic field, but it does have thick CO₂ clouds. Since P is false, P ∧ Q = FALSE.",
            funFact: "Venus's induced magnetic field is created by solar wind interactions with its upper atmosphere."
          }
        ],
        Earth: [
          {
            question: "Statement P: Earth has liquid water in its atmosphere.\nStatement Q: Earth supports complex life.\n\nEvaluate: P ∧ Q",
            operator: "Conjunction (∧)",
            p: "Earth has liquid water in its atmosphere only",
            q: "Earth supports complex life",
            pValue: false,
            qValue: true,
            correctIsTrue: false,
            explanation: "Earth has liquid water on its surface (not just atmosphere). Although Q is true, since P is false, P ∧ Q = FALSE.",
            funFact: "Liquid water on Earth's surface, not just in atmosphere, is essential for life."
          },
          {
            question: "Statement P: Earth is the largest planet in the solar system.\nStatement Q: Earth has one moon.\nStatement R: Earth has oxygen in atmosphere.\n\nEvaluate: P ∧ Q ∧ R",
            operator: "Conjunction (∧)",
            p: "Earth is the largest planet",
            q: "Earth has one moon",
            pValue: false,
            qValue: true,
            correctIsTrue: false,
            explanation: "Earth is not the largest planet (Jupiter is). Although Q and R are true, since P is false, P ∧ Q ∧ R = FALSE.",
            funFact: "Jupiter is so massive that over 1,000 Earths could fit inside it."
          },
          {
            question: "Statement P: Earth is the largest rocky planet in the solar system.\nStatement Q: Earth is the largest planet in the solar system overall.\n\nEvaluate: P ∧ Q",
            operator: "Conjunction (∧)",
            p: "Earth is the largest rocky planet",
            q: "Earth is the largest planet overall",
            pValue: true,
            qValue: false,
            correctIsTrue: false,
            explanation: "Earth is the largest rocky planet, but it is not the largest planet overall. Since Q is false, P ∧ Q = FALSE.",
            funFact: "Jupiter is by far the largest planet in our solar system."
          }
        ],
        Mars: [
          {
            question: "Statement P: Mars has liquid water on its surface today.\nStatement Q: Mars has evidence of ancient water flows.\n\nEvaluate: P ∨ Q",
            operator: "Disjunction (∨)",
            p: "Mars has liquid water on its surface today",
            q: "Mars has evidence of ancient water flows",
            pValue: false,
            qValue: true,
            correctIsTrue: true,
            explanation: "Mars' thin atmosphere prevents liquid water from existing long on the surface today, but there is abundant evidence of ancient river valleys, deltas, and lakebeds from about 3.5 billion years ago. Q is true, so the disjunction is TRUE.",
            funFact: "Mars had a much thicker atmosphere and warmer climate billions of years ago when water flowed freely."
          },
          {
            question: "Statement P: Mars has a strong global magnetic field.\nStatement Q: Mars atmosphere blocks solar radiation.\n\nEvaluate: P ∨ Q",
            operator: "Disjunction (∨)",
            p: "Mars has a strong global magnetic field",
            q: "Mars atmosphere blocks solar radiation",
            pValue: false,
            qValue: false,
            correctIsTrue: false,
            explanation: "Mars lacks a global magnetic field and has a thin atmosphere that offers little protection. Both statements are false, so P ∨ Q = FALSE.",
            funFact: "Mars lost its global magnetic field billions of years ago, exposing it to solar radiation."
          },
          {
            question: "Statement P: Mars has two moons.\nStatement Q: Mars has a red appearance.\nStatement R: Mars has polar ice caps made only of water ice.\n\nEvaluate: (P ∧ Q) ∧ ¬R",
            operator: "Conjunction & Negation ((P ∧ Q) ∧ ¬R)",
            p: "Mars has two moons",
            q: "Mars has a red appearance",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Mars has two moons (Phobos and Deimos), appears red due to iron oxide, and has polar ice caps containing both water ice and frozen carbon dioxide (not only water ice). P∧Q is TRUE, R is FALSE so ¬R is TRUE. Result is TRUE.",
            funFact: "Mars's two small moons, Phobos and Deimos, are named after the Greek gods of fear and panic."
          }
        ],
        Jupiter: [
          {
            question: "Statement P: Jupiter is the largest planet in the solar system.\nStatement Q: Jupiter has the strongest magnetic field of all planets.\n\nEvaluate: P → Q",
            operator: "Conditional (→)",
            p: "Jupiter is the largest planet in the solar system",
            q: "Jupiter has the strongest magnetic field of all planets",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Jupiter is the largest planet and has a magnetic field 16-54 times more powerful than Earth's, making it the strongest planetary magnetic field. Both P and Q are true, making the conditional TRUE.",
            funFact: "Jupiter's magnetic field is so powerful it can be detected from billions of miles away."
          },
          {
            question: "Statement P: Jupiter is a gas giant.\nStatement Q: Jupiter has no solid surface to land on.\n\nEvaluate: P ↔ Q",
            operator: "Biconditional (↔)",
            p: "Jupiter is a gas giant",
            q: "Jupiter has no solid surface to land on",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "As a gas giant, Jupiter doesn't have a true surface and is mostly swirling gases and liquids deeper down. Both statements are true and definitionally related, making the biconditional TRUE.",
            funFact: "The densest parts of Jupiter are at the core, where extreme pressure creates exotic states of matter."
          },
          {
            question: "Statement P: Jupiter is made of solid rock.\nStatement Q: Jupiter has a magnetic field.\nStatement R: Jupiter is the largest planet.\n\nEvaluate: P ∧ Q ∧ R",
            operator: "Conjunction (∧)",
            p: "Jupiter is made of solid rock",
            q: "Jupiter has a magnetic field",
            pValue: false,
            qValue: true,
            correctIsTrue: false,
            explanation: "Jupiter is a gas giant, not solid rock. Although Q and R are true, since P is false, P ∧ Q ∧ R = FALSE.",
            funFact: "Jupiter is composed mostly of hydrogen and helium with no solid surface."
          }
        ],
        Saturn: [
          {
            question: "Statement P: Saturn has prominent rings.\nStatement Q: Saturn is less dense than water.\nStatement R: Saturn is NOT a gas giant.\n\nEvaluate: P ∧ Q ∧ R",
            operator: "Conjunction (∧)",
            p: "Saturn has prominent rings",
            q: "Saturn is less dense than water",
            pValue: true,
            qValue: true,
            correctIsTrue: false,
            explanation: "Saturn has spectacular rings and is less dense than water, but Saturn IS a gas giant (statement R was true, so ¬R is false). P ∧ Q ∧ ¬R = FALSE.",
            funFact: "Saturn would actually float in water if we could find a bathtub large enough!"
          },
          {
            question: "Statement P: Saturn has a hexagonal jet stream at its north pole.\nStatement Q: This hexagonal pattern exists on all planets.\n\nEvaluate: P ∧ Q",
            operator: "Conjunction (∧)",
            p: "Saturn has a hexagonal jet stream at its north pole",
            q: "This hexagonal pattern exists on ALL planets",
            pValue: true,
            qValue: false,
            correctIsTrue: false,
            explanation: "Saturn's north pole does have a unique six-sided jet stream, but this pattern does NOT exist on other planets. Since Q is false, P ∧ Q = FALSE.",
            funFact: "Saturn's hexagonal jet stream is one of the most peculiar and mysterious atmospheric features in the solar system."
          },
          {
            question: "Statement P: Saturn is the only planet with moons.\nStatement Q: Many planets have moons.\n\nEvaluate: P ∧ Q",
            operator: "Conjunction (∧)",
            p: "Saturn is the only planet with moons",
            q: "Many planets have moons",
            pValue: false,
            qValue: true,
            correctIsTrue: false,
            explanation: "Saturn is not the only planet with moons. Many planets have moons. Since P is false, P ∧ Q = FALSE.",
            funFact: "All of the gas giants and many terrestrial planets have moons in our solar system."
          }
        ],
        Uranus: [
          {
            question: "Statement P: Uranus rotates upright like most planets.\nStatement Q: Uranus appears blue-green in color.\n\nEvaluate: P ∨ Q",
            operator: "Disjunction (∨)",
            p: "Uranus rotates upright like most planets",
            q: "Uranus appears blue-green in color",
            pValue: false,
            qValue: true,
            correctIsTrue: true,
            explanation: "Uranus does not rotate upright; it rotates on its side at 98° tilt. But Q is true, so P ∨ Q = TRUE.",
            funFact: "Uranus essentially rolls around the Sun like a ball due to its extreme 98-degree axial tilt."
          },
          {
            question: "Statement P: Uranus is an ice giant.\nStatement Q: Most of Uranus' mass is made of water, methane, and ammonia.\n\nEvaluate: P → Q",
            operator: "Conditional (→)",
            p: "Uranus is an ice giant",
            q: "Most of Uranus' mass is made of water, methane, and ammonia",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Uranus is one of two ice giants. Most (80% or more) of the planet's mass is made up of a hot dense fluid of 'icy' materials – water, methane, and ammonia. Both P and Q are true, making the conditional TRUE.",
            funFact: "The 'ice' in ice giants doesn't mean frozen solid—it refers to the composition of dense exotic materials."
          },
          {
            question: "Statement P: Uranus has a magnetic field aligned with its rotation axis.\nStatement Q: Uranus has auroras aligned with its poles.\n\nEvaluate: P ↔ Q",
            operator: "Biconditional (↔)",
            p: "Uranus has aligned magnetic field",
            q: "Uranus has pole-aligned auroras",
            pValue: false,
            qValue: false,
            correctIsTrue: true,
            explanation: "Uranus's magnetic axis is tilted nearly 60 degrees from its rotation axis, so it's not aligned. Its auroras are not in line with the poles. Both statements are false, so ¬P ↔ ¬Q = TRUE.",
            funFact: "Uranus's extreme magnetic tilt creates unusual aurora patterns that don't align with its poles."
          }
        ],
        Neptune: [
          {
            question: "Statement P: Neptune is the farthest planet from the Sun.\nStatement Q: Neptune has the strongest winds in the solar system.\nStatement R: Neptune is blue in color.\n\nEvaluate: P ∧ Q ∧ R",
            operator: "Conjunction (∧)",
            p: "Neptune is the farthest planet from the Sun",
            q: "Neptune has the strongest winds in the solar system",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Neptune is the eighth and farthest planet from the Sun. Neptune's winds can exceed 1,200 mph (2,000 km/h), three times stronger than Jupiter's and nine times stronger than Earth's. Neptune appears blue due to methane. All three statements are true.",
            funFact: "Neptune's winds are powered partly by internal heat, despite receiving very little solar energy."
          },
          {
            question: "Statement P: Neptune is far from the Sun with low energy input.\nStatement Q: Neptune has weak or no winds.\n\nEvaluate: P → Q",
            operator: "Conditional (→)",
            p: "Neptune is far from the Sun with low energy input",
            q: "Neptune has weak or no winds",
            pValue: true,
            qValue: false,
            correctIsTrue: false,
            explanation: "Despite its great distance and low energy input from the Sun, Neptune is our solar system's windiest world with winds exceeding 1,200 mph. P is TRUE but Q is FALSE, making the conditional FALSE.",
            funFact: "Neptune's powerful winds are one of the greatest mysteries in planetary science."
          },
          {
            question: "Statement P: Neptune was discovered by mathematical prediction.\nStatement Q: Neptune position was confirmed by telescope.\n\nEvaluate: P ∧ Q",
            operator: "Conjunction (∧)",
            p: "Neptune was discovered by mathematical prediction",
            q: "Neptune position was confirmed by telescope",
            pValue: true,
            qValue: true,
            correctIsTrue: true,
            explanation: "Neptune was mathematically predicted and then confirmed through telescope observation. Both statements are true, so P ∧ Q = TRUE.",
            funFact: "Neptune was mathematically predicted before it was ever directly observed through a telescope in 1846."
          }
        ]
      };

      // Create the planets array with random question selection
      function getRandomQuestion(planetName) {
        const questions = planetQuestionsBank[planetName] || [];
        return questions[Math.floor(Math.random() * questions.length)];
      }

      const planets = [
        { name: "Mercury", ...getRandomQuestion("Mercury") },
        { name: "Venus", ...getRandomQuestion("Venus") },
        { name: "Earth", ...getRandomQuestion("Earth") },
        { name: "Mars", ...getRandomQuestion("Mars") },
        { name: "Jupiter", ...getRandomQuestion("Jupiter") },
        { name: "Saturn", ...getRandomQuestion("Saturn") },
        { name: "Uranus", ...getRandomQuestion("Uranus") },
        { name: "Neptune", ...getRandomQuestion("Neptune") }
      ];

      const solarSystemEl = document.getElementById("solarSystem");
      const sunEl = document.getElementById("sun");
      const countdownOverlay = document.getElementById("countdownOverlay");
      const countdownNumberEl = document.getElementById("countdownNumber");
      const countdownFactsEl = document.getElementById("countdownFacts");
      const quizWrapper = document.getElementById("quizWrapper");
      const quizCard = document.getElementById("quizCard");
      const quizPlanetNameEl = document.getElementById("quizPlanetName");
      const questionTextEl = document.getElementById("questionText");
      const truthFactCellEl = document.getElementById("truthFactCell");
      const truthAnswerCellEl = document.getElementById("truthAnswerCell");
      const btnTrue = document.getElementById("btnTrue");
      const btnFalse = document.getElementById("btnFalse");
      const answerStatusEl = document.getElementById("answerStatus");
      const explanationTextEl = document.getElementById("explanationText");
      const planetFactTextEl = document.getElementById("planetFactText");
      const btnNext = document.getElementById("btnNext");
      const progressTextEl = document.getElementById("progressText");
      const summaryWrapper = document.getElementById("summaryWrapper");
      const summaryScoreEl = document.getElementById("summaryScore");
      const summaryDetailEl = document.getElementById("summaryDetail");
      const summaryAccuracyEl = document.getElementById("summaryAccuracy");
      const summaryTierEl = document.getElementById("summaryTier");
      const btnRestart = document.getElementById("btnRestart");
      const musicToggle = document.getElementById("musicToggle");
      const bgMusic = document.getElementById("bgMusic");
      const quizMetaEl = document.getElementById("quizMeta");

      // Cache DOM queries
      const planetElements = Array.from(document.querySelectorAll(".planet"));
      const orbitElements = Array.from(document.querySelectorAll(".orbit.animate"));

      let hasLaunched = false;
      let currentPlanetIndex = 0;
      let score = 0;
      let answersGiven = 0;
      let countdownTimer = null;
      let orbitTime = 0;

      const orbitRadii = [80, 110, 145, 180, 260, 310, 360, 410];
      const orbitSpeeds = [4.1, 1.6, 1.0, 0.53, 0.35, 0.18, 0.095, 0.055];

      // Solar system facts for countdown
      const introFacts = [
        "Our solar system formed about 4.6 billion years ago from a cloud of gas and dust.",
        "The four inner planets are rocky worlds; the four outer planets are gas and ice giants.",
        "The Sun contains more than 99 percent of the mass of the solar system."
      ];

      function shuffle(array) {
        const arr = array.slice();
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      function highlightCurrentPlanet(index) {
        planetElements.forEach((el) => el.classList.remove("highlighted"));
        const match = planetElements.find((el) => Number(el.dataset.planetIndex) === index);
        if (match) {
          match.classList.add("highlighted");
        }
      }

      function clearHighlight() {
        planetElements.forEach((el) => el.classList.remove("highlighted"));
      }

      function startCountdown() {
        if (hasLaunched) return;
        hasLaunched = true;

        solarSystemEl.classList.add("dimmed");
        document.body.classList.add("top-down-view");

        const shuffledFacts = shuffle(introFacts);
        countdownFactsEl.innerHTML = "";
        shuffledFacts.forEach((fact) => {
          const li = document.createElement("li");
          li.textContent = fact;
          countdownFactsEl.appendChild(li);
        });

        countdownNumberEl.textContent = "5";
        countdownOverlay.classList.add("visible");
        countdownOverlay.setAttribute("aria-hidden", "false");

        let remaining = 5;
        countdownTimer = window.setInterval(() => {
          remaining -= 1;
          countdownNumberEl.textContent = String(remaining);
          if (remaining <= 0) {
            window.clearInterval(countdownTimer);
            beginQuiz();
          }
        }, 1000);
      }

      function beginQuiz() {
        countdownOverlay.classList.remove("visible");
        countdownOverlay.setAttribute("aria-hidden", "true");

        solarSystemEl.classList.remove("side-view");
        solarSystemEl.classList.add("top-down");
        solarSystemEl.classList.remove("dimmed");
        
        // Pause expensive animations during quiz
        solarSystemEl.style.animationPlayState = "paused";

        currentPlanetIndex = 0;
        score = 0;
        answersGiven = 0;
        summaryWrapper.classList.remove("visible");
        summaryWrapper.setAttribute("aria-hidden", "true");

        showQuestionForPlanet(currentPlanetIndex);
      }

      function showQuestionForPlanet(index) {
        const planet = planets[index];
        if (!planet) return;

        highlightCurrentPlanet(index);

        quizCard.dataset.planet = planet.name;
        quizPlanetNameEl.textContent = planet.name;
        questionTextEl.textContent =
          "Decide whether this statement is true (T) or false (F) in the last column of the truth table.";
        truthFactCellEl.textContent = planet.question;
        truthAnswerCellEl.textContent = "?";

        explanationTextEl.textContent = "";
        planetFactTextEl.textContent = "";
        quizMetaEl.classList.remove("visible");
        quizMetaEl.classList.add("hidden");

        answerStatusEl.textContent = "";
        answerStatusEl.classList.remove("correct", "incorrect");

        btnTrue.disabled = false;
        btnFalse.disabled = false;
        btnNext.disabled = true;

        progressTextEl.textContent = "Planet " + (index + 1) + " of " + planets.length;

        quizWrapper.classList.add("visible");
        quizWrapper.setAttribute("aria-hidden", "false");
      }

      function handleAnswer(isTrueSelected) {
        const planet = planets[currentPlanetIndex];
        if (!planet) return;

        truthAnswerCellEl.textContent = isTrueSelected ? "T" : "F";

        const correct = planet.correctIsTrue === isTrueSelected;
        answersGiven += 1;
        if (correct) {
          score += 1;
          answerStatusEl.textContent = "Correct. Your truth table entry matches what NASA reports.";
          answerStatusEl.classList.remove("incorrect");
          answerStatusEl.classList.add("correct");
        } else {
          answerStatusEl.textContent = "Not quite. The correct truth table entry for this statement is the opposite.";
          answerStatusEl.classList.remove("correct");
          answerStatusEl.classList.add("incorrect");
        }

        explanationTextEl.textContent = planet.explanation;
        planetFactTextEl.textContent = planet.funFact;

        quizMetaEl.classList.remove("hidden");
        quizMetaEl.classList.add("visible");

        btnTrue.disabled = true;
        btnFalse.disabled = true;
        btnNext.disabled = false;
      }

      function goToNextPlanet() {
        const nextIndex = currentPlanetIndex + 1;
        if (nextIndex >= planets.length) {
          finishMission();
          return;
        }
        currentPlanetIndex = nextIndex;
        showQuestionForPlanet(currentPlanetIndex);
      }

      function finishMission() {
        clearHighlight();
        quizWrapper.classList.remove("visible");
        quizWrapper.setAttribute("aria-hidden", "true");

        // Resume animations
        solarSystemEl.style.animationPlayState = "running";

        const total = planets.length;
        const accuracy = total > 0 ? Math.round((score / total) * 100) : 0;

        summaryScoreEl.textContent = score + " / " + total;
        summaryDetailEl.textContent =
          "You completed a full orbit of logic checks across the solar system.";

        summaryAccuracyEl.textContent = "Accuracy: " + accuracy + "%";
        let tier;
        if (accuracy === 100) {
          tier = "Tier: Master navigator";
        } else if (accuracy >= 75) {
          tier = "Tier: Mission specialist";
        } else if (accuracy >= 50) {
          tier = "Tier: Cadet in training";
        } else {
          tier = "Tier: Keep practicing your truth tables";
        }
        summaryTierEl.textContent = tier;

        summaryWrapper.classList.add("visible");
        summaryWrapper.setAttribute("aria-hidden", "false");
      }

      function restartMission() {
        score = 0;
        answersGiven = 0;
        currentPlanetIndex = 0;
        summaryWrapper.classList.remove("visible");
        summaryWrapper.setAttribute("aria-hidden", "true");
        solarSystemEl.classList.remove("top-down");
        solarSystemEl.classList.add("side-view");
        
        // Resume animations when returning to side view
        solarSystemEl.style.animationPlayState = "running";
        
        clearHighlight();
        hasLaunched = false;
      }

      function toggleMusic() {
        if (!bgMusic) return;
        try {
          if (bgMusic.paused) {
            bgMusic.play().catch(function () { /* ignore autoplay errors */ });
            musicToggle.setAttribute("aria-pressed", "true");
          } else {
            bgMusic.pause();
            musicToggle.setAttribute("aria-pressed", "false");
          }
        } catch (e) {
          // fail silently
        }
      }

      function animateOrbits(timestamp) {
        orbitTime = timestamp * 0.0002;
        const width = solarSystemEl.clientWidth;
        const height = solarSystemEl.clientHeight;
        const centerX = width / 2;
        const centerY = height / 2;

        planetElements.forEach((el, index) => {
          const radius = orbitRadii[index] || 100;
          const speed = orbitSpeeds[index] || 1;
          const angle = orbitTime * speed + index * 0.9;
          const x = centerX + radius * Math.cos(angle);
          const y = centerY + radius * Math.sin(angle);

          el.style.transform = `translate(${x}px, ${y}px) translate(-50%, -50%)`;
        });

        window.requestAnimationFrame(animateOrbits);
      }

      window.requestAnimationFrame(animateOrbits);

      sunEl.addEventListener("click", startCountdown);
      btnTrue.addEventListener("click", () => handleAnswer(true));
      btnFalse.addEventListener("click", () => handleAnswer(false));
      btnNext.addEventListener("click", goToNextPlanet);
      btnRestart.addEventListener("click", restartMission);
      musicToggle.addEventListener("click", toggleMusic);
      
      // ADDED EVENT LISTENER FOR NEW BUTTON
      document.getElementById('btnVisitSite').addEventListener('click', function() {
        window.open('https://sirp0o0kiebear.wixsite.com/solar-system', '_blank');
      });
    })();
  </script>
</body>
</html>
