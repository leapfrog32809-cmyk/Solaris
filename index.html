<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>Solar System Logic Mission</title>

  <!-- Fonts: use system stack to avoid external network dependencies -->

  <style>
    :root {
      --bg-space: #020310;
      --accent: #ffd700;
      --accent-soft: rgba(255, 215, 0, 0.2);
      --accent-glow: rgba(255, 215, 0, 0.4);
      --card-bg: rgba(7, 11, 30, 0.92);
      --text-main: #f5f7ff;
      --text-muted: #a4b0d0;
      --error: #ff5577;
      --success: #4ade80;
      --orbit-color: rgba(255, 255, 255, 0.1);
      --transition-fast: 0.35s ease-out;
      --transition-med: 0.6s ease-in-out;
      --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.5);
      --shadow-glow: 0 0 30px rgba(255, 215, 0, 0.3);
      --radius-card: 18px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(135deg, #020310 0%, #0a0a2e 50%, #020310 100%);
      color: var(--text-main);
      height: 100vh;
      height: 100dvh;
      width: 100vw;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 30%, rgba(120, 50, 200, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(50, 100, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 80%, rgba(200, 50, 100, 0.05) 0%, transparent 50%);
      pointer-events: none;
      z-index: -1;
    }

    body.top-down-view {
      background: linear-gradient(135deg, #0a0a2e 0%, #1a1a4a 50%, #0a0a2e 100%);
    }

    .app-shell {
      width: 100%;
      height: 100%;
      position: relative;
      overflow: hidden;
      padding: 16px;
      display: flex;
      flex-direction: column;
    }

    .frame {
      flex: 1;
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
      border-radius: 26px;
      border: 1.5px solid rgba(255, 215, 0, 0.2);
      box-shadow: 0 22px 55px rgba(0, 0, 0, 0.7), 0 0 40px rgba(255, 215, 0, 0.15);
      backdrop-filter: blur(16px);
      background: 
        radial-gradient(circle at top left, rgba(108, 122, 255, 0.15), transparent 55%),
        radial-gradient(circle at bottom right, rgba(255, 215, 0, 0.12), transparent 55%),
        rgba(0, 0, 10, 0.96);
      display: grid;
      grid-template-rows: auto 1fr;
      position: relative;
      overflow: hidden;
    }

    /* Mobile handling for frame */
    @media (max-width: 640px) {
      .app-shell {
        padding: 0;
      }
      .frame {
        border-radius: 0;
        border: none;
        border-bottom: 1px solid rgba(255, 215, 0, 0.2);
      }
    }

    header.app-header {
      padding: 16px 22px 8px;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      z-index: 40;
      background: linear-gradient(135deg, rgba(30, 45, 100, 0.15), rgba(15, 25, 60, 0.1));
      border-bottom: 1px solid rgba(255, 215, 0, 0.1);
      flex-shrink: 0;
    }

    .btn-ghost {
      border-radius: 999px;
      padding: 8px 14px;
      border: 1.5px solid rgba(255, 215, 0, 0.3);
      background: radial-gradient(circle at top, rgba(255, 255, 255, 0.15), transparent 60%),
                  rgba(5, 10, 32, 0.85);
      color: var(--text-main);
      cursor: pointer;
      font-size: 0.78rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s ease-out;
      z-index: 100;
    }

    .btn-ghost:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.4), 0 0 20px rgba(255, 215, 0, 0.2);
      background: radial-gradient(circle at top, rgba(255, 255, 255, 0.3), transparent 60%),
                  rgba(10, 18, 54, 0.95);
    }

    .btn-ghost[aria-pressed="true"] {
      border-color: var(--accent);
      background: radial-gradient(circle at top, rgba(255, 215, 0, 0.5), transparent 60%),
                  rgba(40, 30, 0, 0.98);
      box-shadow: 0 0 25px rgba(255, 215, 0, 0.25);
    }

    main.stage {
      position: relative;
      overflow: hidden;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Solar system scene */
    .solar-system-wrapper {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      perspective: 1200px;
      overflow: hidden;
    }

    .solar-system {
      position: relative;
      width: 1000px; 
      height: 1000px;
      transform-style: flat;
      transition: opacity var(--transition-med), filter var(--transition-med);
      transform: scale(1);
      flex-shrink: 0;
    }

    .solar-system.dimmed {
      opacity: 0.18;
      filter: blur(3px);
    }

    .starfield, .deep-stars, .galaxy-clouds, .nebula-overlay, .dust-particles {
      position: absolute;
      inset: -50%;
      width: 200%;
      height: 200%;
      pointer-events: none;
      contain: layout paint size style;
    }

    .nebula-overlay {
      background: 
        radial-gradient(circle at 30% 40%, rgba(120, 50, 200, 0.08), transparent 45%),
        radial-gradient(circle at 70% 60%, rgba(50, 100, 255, 0.06), transparent 45%),
        radial-gradient(circle at 50% 10%, rgba(200, 50, 100, 0.05), transparent 50%);
      filter: blur(80px);
      animation: nebula-pulse 30s ease-in-out infinite alternate;
      z-index: -1;
    }

    @keyframes nebula-pulse {
      0% { opacity: 0.4; transform: scale(1); }
      100% { opacity: 0.7; transform: scale(1.1); }
    }

    .dust-particles {
      background-image: 
        radial-gradient(circle, rgba(255, 255, 255, 0.15) 1px, transparent 1px),
        radial-gradient(circle, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
      background-size: 300px 300px, 500px 500px;
      background-position: 0 0, 100px 100px;
      animation: dust-drift 120s linear infinite;
      opacity: 0.5;
    }

    @keyframes dust-drift {
      0% { transform: translate(0, 0); }
      100% { transform: translate(-100px, -50px); }
    }

    .deep-stars {
      background-image: 
        radial-gradient(1px 1px at 10% 15%, rgba(255,255,255,0.4), transparent),
        radial-gradient(1px 1px at 25% 45%, rgba(255,255,255,0.3), transparent),
        radial-gradient(2px 2px at 50% 20%, rgba(255,255,255,0.2), transparent),
        radial-gradient(1px 1px at 75% 65%, rgba(255,255,255,0.3), transparent),
        radial-gradient(2px 2px at 90% 10%, rgba(255,255,255,0.25), transparent);
      background-size: 400px 400px;
      opacity: 0.6;
    }

    .galaxy-clouds {
      background-image: 
        radial-gradient(circle at 20% 20%, rgba(68, 0, 255, 0.08) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(255, 0, 100, 0.06) 0%, transparent 50%),
        radial-gradient(circle at 50% 50%, rgba(0, 255, 200, 0.04) 0%, transparent 60%);
      filter: blur(50px);
      animation: pulse-galaxy 25s ease-in-out infinite alternate;
    }

    @keyframes pulse-galaxy {
      0% { opacity: 0.5; transform: scale(1); }
      100% { opacity: 0.8; transform: scale(1.05); }
    }

    .starfield {
      background-image:
        radial-gradient(circle at 10% 20%, rgba(255, 255, 255, 0.9) 1px, transparent 1px),
        radial-gradient(circle at 80% 30%, rgba(255, 255, 255, 0.8) 1px, transparent 1px),
        radial-gradient(circle at 40% 80%, rgba(255, 255, 255, 0.85) 1px, transparent 1px),
        radial-gradient(circle at 15% 50%, rgba(255, 255, 255, 0.7) 1.5px, transparent 1.5px),
        radial-gradient(circle at 85% 90%, rgba(255, 255, 255, 0.7) 1.5px, transparent 1.5px);
      background-size: 350px 350px;
      opacity: 0.9;
      mix-blend-mode: screen;
      animation: twinkle-stars 10s ease-in-out infinite alternate;
    }

    @keyframes twinkle-stars {
      0% { opacity: 0.75; }
      100% { opacity: 0.95; }
    }
    
    .low-performance .nebula-overlay,
    .low-performance .dust-particles,
    .low-performance .far-galaxy { display: none; }
    .low-performance .galaxy-clouds { animation: none; filter: blur(30px); }
    .low-performance .starfield { animation: none; background-size: 500px 500px; }
    .low-performance .deep-stars { background-size: 600px 600px; opacity: 0.5; }
    .low-performance .comet-container { display: none; }
    .low-performance .asteroid-belt::before,
    .low-performance .asteroid-belt::after { animation: none; opacity: 0.4; }
    .low-performance .orbit.animate { animation: none !important; }
    
    @media (prefers-reduced-motion: reduce) {
      .orbit.animate { animation: none !important; }
      .galaxy-clouds { animation: none; }
      .starfield { animation: none; }
      .comet-container { display: none; }
      .asteroid-belt::before,
      .asteroid-belt::after { animation: none; }
    }
    
    /* Asteroid Belt */
    .asteroid-belt {
      position: absolute;
      top: 50%; left: 50%;
      width: 500px; height: 500px;
      transform: translate(-50%, -50%);
      border-radius: 50%;
      pointer-events: none;
      z-index: 1;
    }
    
    .asteroid-belt::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 50%;
        background-image: 
            radial-gradient(1px 1px at 15% 15%, #999, transparent),
            radial-gradient(1px 1px at 35% 55%, #888, transparent),
            radial-gradient(1.5px 1.5px at 65% 25%, #aaa, transparent),
            radial-gradient(1px 1px at 85% 75%, #777, transparent);
        background-size: 60px 60px;
        animation: asteroid-spin 180s linear infinite reverse;
        opacity: 0.5;
        mask-image: radial-gradient(closest-side, transparent 78%, black 82%, black 88%, transparent 92%);
        -webkit-mask-image: radial-gradient(closest-side, transparent 78%, black 82%, black 88%, transparent 92%);
    }

    .asteroid-belt::after {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 50%;
        background-image: 
            radial-gradient(1.5px 1.5px at 10% 10%, #887, transparent),
            radial-gradient(1.5px 1.5px at 20% 30%, #776, transparent),
            radial-gradient(2px 2px at 40% 40%, #998, transparent),
            radial-gradient(1.5px 1.5px at 60% 20%, #887, transparent),
            radial-gradient(1.5px 1.5px at 80% 80%, #776, transparent),
            radial-gradient(2px 2px at 50% 90%, #998, transparent);
        background-size: 80px 80px;
        animation: asteroid-spin 120s linear infinite;
        opacity: 0.7;
        mask-image: radial-gradient(closest-side, transparent 78%, black 82%, black 88%, transparent 92%);
        -webkit-mask-image: radial-gradient(closest-side, transparent 78%, black 82%, black 88%, transparent 92%);
    }

    @keyframes asteroid-spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    /* Comets */
    .comet-container {
        position: absolute;
        inset: -50%;
        width: 200%; height: 200%;
        pointer-events: none;
        z-index: 0;
    }
    
    .comet {
        position: absolute;
        width: 3px; height: 3px;
        background: #fff;
        border-radius: 50%;
        box-shadow: 0 0 8px #fff;
        opacity: 0;
    }
    
    .comet::after {
        content: "";
        position: absolute;
        top: 50%; right: 0;
        width: 80px; height: 1px;
        background: linear-gradient(to left, rgba(255,255,255,0.6), transparent);
        transform: translateY(-50%);
    }
    
    .comet.one { top: 15%; left: -10%; animation: shoot 18s linear infinite 5s; }
    .comet.two { top: 70%; left: -10%; animation: shoot 25s linear infinite 15s; }
    
    /* Far Galaxies */
    .far-galaxy {
      position: absolute;
      pointer-events: none;
      z-index: -1;
      opacity: 0.6;
      filter: blur(1px);
    }

    .far-galaxy.one {
      top: 12%; left: 75%;
      width: 140px; height: 60px;
      background: radial-gradient(ellipse at center, rgba(180, 200, 255, 0.3), transparent 70%);
      transform: rotate(20deg);
      border-radius: 50%;
    }
    
    .far-galaxy.one::after {
      content: "";
      position: absolute;
      top: 50%; left: 50%;
      width: 60%; height: 20%;
      background: rgba(255, 255, 255, 0.4);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
    }

    .far-galaxy.two {
      bottom: 15%; left: 10%;
      width: 100px; height: 100px;
      background: radial-gradient(circle at center, rgba(255, 100, 150, 0.15), transparent 70%);
      animation: galaxy-spin 200s linear infinite;
    }

    .far-galaxy.two::after {
      content: "";
      position: absolute;
      inset: 0;
      background: 
        radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.3) 1px, transparent 1px),
        radial-gradient(circle at 70% 70%, rgba(255, 255, 255, 0.3) 1px, transparent 1px);
      background-size: 20px 20px;
      transform: rotate(45deg);
    }

    @keyframes galaxy-spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    @keyframes shoot {
        0% { transform: translateX(0) translateY(0) rotate(20deg); opacity: 0; }
        5% { opacity: 1; }
        20% { transform: translateX(120vw) translateY(40vh) rotate(20deg); opacity: 0; }
        100% { opacity: 0; }
    }

    .orbit {
      position: absolute;
      border-radius: 50%;
      border: 2.5px solid rgba(100, 180, 255, 0.45);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none;
      box-shadow: 0 0 8px rgba(100, 180, 255, 0.35);
      will-change: transform;
    }

    .orbit.animate {
      animation: orbit-rotate 60s linear infinite;
      transform-origin: center center;
    }

    @keyframes orbit-rotate {
      from { transform: translate(-50%, -50%) rotateZ(0deg); }
      to { transform: translate(-50%, -50%) rotateZ(360deg); }
    }

    .star {
      position: absolute;
      width: 110px;
      height: 110px;
      border-radius: 50%;
      background:
        radial-gradient(circle at 35% 35%, #fff6d5 0%, #ffd36a 40%, #ff9b21 70%, rgba(0,0,0,0) 72%),
        conic-gradient(from 0deg, rgba(255,180,60,0.6), rgba(255,130,40,0.6), rgba(255,220,80,0.6), rgba(255,180,60,0.6));
      box-shadow:
        0 0 50px rgba(255, 150, 40, 1),
        0 0 100px rgba(255, 100, 20, 0.8);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      cursor: pointer;
      z-index: 4;
      transition: all 0.25s ease-out;
    }

    .star::after {
      content: "Click to start";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      white-space: nowrap;
      font-size: 0.9rem;
      font-weight: 700;
      text-transform: uppercase;
      color: rgba(60, 20, 0, 0.8);
      text-shadow: 0 1px 0 rgba(255,255,255,0.4);
      pointer-events: none;
    }

    .star:active {
      transform: translate(-50%, -50%) scale(0.95);
    }

    .planet {
      position: absolute;
      /* Size defined in specific rules */
      transform: translate(-50%, -50%);
      transition: width 0.3s, height 0.3s;
      cursor: pointer;
      /* Removed background/box-shadow from container to allow rotation of shadow independent of label */
    }

    .planet-surface {
      position: absolute;
      inset: 0;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      /* Inner shadow for 3D sphere look (ambient) */
      box-shadow: inset -2px -2px 6px rgba(0,0,0,0.5);
      transition: filter 0.3s;
    }

    .planet-shadow {
      position: absolute;
      inset: -1px; /* Slight overlap */
      border-radius: 50%;
      /* 
         Directional shadow: 
         - Radial part gives a core shadow
         - Linear part gives the day/night terminator
         - Rotate based on --angle from JS
      */
      background: radial-gradient(circle at 50% 50%, transparent 35%, rgba(0,0,0,0.8) 120%),
                  linear-gradient(to right, transparent 25%, rgba(0,0,0,0.95) 100%);
      transform: rotate(var(--angle));
      pointer-events: none;
      z-index: 2;
      mix-blend-mode: multiply; /* Blends shadow nicely with texture */
    }

    .planet:hover .planet-surface {
      filter: brightness(1.2);
    }

    .planet::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      z-index: -1;
    }

    .planet::after {
      content: attr(data-name);
      position: absolute;
      top: 130%; /* Moved down slightly */
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-main);
      text-shadow: 0 0 4px #000;
      pointer-events: none;
      white-space: nowrap;
      opacity: 0.8;
      z-index: 10;
    }

    /* Specific Planet Sizes & Textures */
    /* Note: background applied to .planet-surface */
    .planet.mercury { width: 14px; height: 14px; }
    .planet.mercury .planet-surface {
      background-color: #888;
      background-image:
        radial-gradient(circle at 30% 40%, #9b9b9b 0%, #7d7d7d 30%, transparent 35%),
        radial-gradient(circle at 70% 60%, #a8a8a8 0%, #888888 25%, transparent 30%),
        radial-gradient(circle at 40% 75%, #8a8a8a 0%, #6e6e6e 20%, transparent 25%),
        linear-gradient(135deg, #8d8d8d, #9f9f9f);
    }
    
    .planet.venus { width: 22px; height: 22px; }
    .planet.venus .planet-surface {
      background-color: #e3bb76;
      background-image:
        conic-gradient(from 25deg, rgba(240,210,150,0.6), rgba(220,180,120,0.6), rgba(240,210,150,0.6)),
        radial-gradient(circle at 60% 40%, rgba(255,255,255,0.25), transparent 45%),
        linear-gradient(45deg, #d9b472, #f1d8a2);
    }
    
    .planet.earth { width: 24px; height: 24px; }
    .planet.earth .planet-surface {
      background-color: #22aaff;
      background-image:
        radial-gradient(ellipse at 30% 40%, rgba(50,140,60,0.85) 0%, rgba(50,140,60,0.7) 10%, transparent 18%),
        radial-gradient(ellipse at 65% 55%, rgba(50,140,60,0.85) 0%, rgba(50,140,60,0.7) 10%, transparent 18%),
        radial-gradient(ellipse at 45% 30%, rgba(255,255,255,0.5) 0%, transparent 35%),
        radial-gradient(ellipse at 55% 70%, rgba(255,255,255,0.4) 0%, transparent 35%),
        linear-gradient(45deg, #1a8fd6, #4ac0ff);
    }
    
    .planet.mars { width: 18px; height: 18px; }
    .planet.mars .planet-surface {
      background-color: #dd4422;
      background-image:
        radial-gradient(circle at 30% 30%, rgba(160,60,40,0.9) 0%, transparent 22%),
        radial-gradient(circle at 70% 65%, rgba(120,40,30,0.8) 0%, transparent 25%),
        radial-gradient(circle at 45% 80%, rgba(100,30,20,0.7) 0%, transparent 22%),
        linear-gradient(35deg, #c0392b, #e74c3c);
    }
    
    .planet.jupiter { width: 50px; height: 50px; }
    .planet.jupiter .planet-surface {
      background-color: #d8ca9d;
      background-image:
        repeating-linear-gradient(180deg, #dccdaa 0px, #dccdaa 8px, #cbb78f 8px, #cbb78f 16px, #b59e79 16px, #b59e79 24px, #e4d6b8 24px, #e4d6b8 32px),
        radial-gradient(circle at 58% 62%, rgba(200,120,80,0.45) 0%, transparent 28%);
    }
    
    .planet.saturn { width: 42px; height: 42px; }
    .planet.saturn .planet-surface {
      background-color: #ead6b8;
      background-image:
        repeating-linear-gradient(180deg, #ead6b8 0px, #ead6b8 7px, #d9c7a6 7px, #d9c7a6 14px, #cbb893 14px, #cbb893 21px, #f2e6cf 21px, #f2e6cf 28px);
    }
    
    .planet.uranus { width: 32px; height: 32px; }
    .planet.uranus .planet-surface {
      background-color: #d1e7e7;
      background-image:
        repeating-linear-gradient(180deg, #cfeeee 0px, #cfeeee 6px, #bfe7e7 6px, #bfe7e7 12px, #e2f5f5 12px, #e2f5f5 18px);
    }
    
    .planet.neptune { width: 30px; height: 30px; }
    .planet.neptune .planet-surface {
      background-color: #5b5ddf;
      background-image:
        repeating-linear-gradient(180deg, #4a4cd6 0px, #4a4cd6 6px, #3c40c0 6px, #3c40c0 12px, #6b6df0 12px, #6b6df0 18px);
    }

    /* Saturn Ring visual */
    .planet.saturn::before {
      content: "";
      position: absolute;
      top: 50%; left: 50%;
      width: 180%; height: 50%;
      transform: translate(-50%, -50%) rotate(-15deg);
      border-radius: 50%;
      border: 4px solid rgba(219, 204, 170, 0.6);
      pointer-events: none;
      z-index: -1;
    }

    .planet.highlighted {
      box-shadow: 0 0 25px rgba(255, 255, 255, 0.9);
      filter: brightness(1.3);
      z-index: 10;
    }

    /* Fixed Orbit Sizes */
    .orbit.mercury { width: 160px; height: 160px; }
    .orbit.venus   { width: 220px; height: 220px; }
    .orbit.earth   { width: 290px; height: 290px; }
    .orbit.mars    { width: 360px; height: 360px; }
    .orbit.jupiter { width: 520px; height: 520px; }
    .orbit.saturn  { width: 620px; height: 620px; }
    .orbit.uranus  { width: 720px; height: 720px; }
    .orbit.neptune { width: 820px; height: 820px; }

    /* Overlays */
    .overlay, .quiz-wrapper, .summary-wrapper {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.85);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
      z-index: 60;
      padding: 16px;
      overflow-y: auto;
    }

    .visible {
      opacity: 1;
      pointer-events: auto;
    }

    .countdown-panel, .quiz-card, .summary-card {
      background: var(--card-bg);
      border: 1px solid var(--accent-soft);
      border-radius: var(--radius-card);
      padding: 20px;
      max-width: 600px;
      width: 100%;
      box-shadow: 0 0 30px rgba(0,0,0,0.5);
      position: relative;
    }

    /* Quiz Layout */
    .quiz-card {
      max-height: 90vh;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 16px;
      background-color: var(--card-bg);
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      transition: background-image 0.5s ease-in-out, background-color 0.5s ease-in-out;
    }

    .quiz-card[data-planet="Mercury"] { background-image: linear-gradient(rgba(7,11,30,0.90), rgba(7,11,30,0.96)), radial-gradient(circle at 30% 30%, rgba(136,136,136,0.35), transparent 70%); }
    .quiz-card[data-planet="Venus"]   { background-image: linear-gradient(rgba(7,11,30,0.90), rgba(7,11,30,0.96)), radial-gradient(circle at 30% 30%, rgba(227,187,118,0.35), transparent 70%); }
    .quiz-card[data-planet="Earth"]   { background-image: linear-gradient(rgba(7,11,30,0.90), rgba(7,11,30,0.96)), radial-gradient(circle at 30% 30%, rgba(34,170,255,0.35), transparent 70%); }
    .quiz-card[data-planet="Mars"]    { background-image: linear-gradient(rgba(7,11,30,0.90), rgba(7,11,30,0.96)), radial-gradient(circle at 30% 30%, rgba(221,68,34,0.35), transparent 70%); }
    .quiz-card[data-planet="Jupiter"] { background-image: linear-gradient(rgba(7,11,30,0.90), rgba(7,11,30,0.96)), radial-gradient(circle at 30% 30%, rgba(216,202,157,0.35), transparent 70%); }
    .quiz-card[data-planet="Saturn"]  { background-image: linear-gradient(rgba(7,11,30,0.90), rgba(7,11,30,0.96)), radial-gradient(circle at 30% 30%, rgba(234,214,184,0.35), transparent 70%); }
    .quiz-card[data-planet="Uranus"]  { background-image: linear-gradient(rgba(7,11,30,0.90), rgba(7,11,30,0.96)), radial-gradient(circle at 30% 30%, rgba(209,231,231,0.35), transparent 70%); }
    .quiz-card[data-planet="Neptune"] { background-image: linear-gradient(rgba(7,11,30,0.90), rgba(7,11,30,0.96)), radial-gradient(circle at 30% 30%, rgba(91,93,223,0.35), transparent 70%); }

    .quiz-planet-thumb.mercury {
      background-image:
        radial-gradient(circle at 30% 40%, #9b9b9b 0%, #7d7d7d 30%, transparent 35%),
        radial-gradient(circle at 70% 60%, #a8a8a8 0%, #888888 25%, transparent 30%),
        linear-gradient(135deg, #8d8d8d, #9f9f9f);
    }
    .quiz-planet-thumb.venus {
      background-image:
        conic-gradient(from 25deg, rgba(240,210,150,0.6), rgba(220,180,120,0.6), rgba(240,210,150,0.6)),
        linear-gradient(45deg, #d9b472, #f1d8a2);
    }
    .quiz-planet-thumb.earth {
      background-image:
        radial-gradient(ellipse at 30% 40%, rgba(50,140,60,0.85) 0%, transparent 18%),
        radial-gradient(ellipse at 65% 55%, rgba(50,140,60,0.85) 0%, transparent 18%),
        linear-gradient(45deg, #1a8fd6, #4ac0ff);
    }
    .quiz-planet-thumb.mars {
      background-image:
        radial-gradient(circle at 30% 30%, rgba(160,60,40,0.9) 0%, transparent 22%),
        radial-gradient(circle at 70% 65%, rgba(120,40,30,0.8) 0%, transparent 25%),
        linear-gradient(35deg, #c0392b, #e74c3c);
    }
    .quiz-planet-thumb.jupiter {
      background-image:
        repeating-linear-gradient(180deg, #dccdaa 0px, #dccdaa 8px, #cbb78f 8px, #cbb78f 16px, #b59e79 16px, #b59e79 24px);
    }
    .quiz-planet-thumb.saturn {
      background-image:
        repeating-linear-gradient(180deg, #ead6b8 0px, #ead6b8 7px, #d9c7a6 7px, #d9c7a6 14px, #cbb893 14px, #cbb893 21px);
    }
    .quiz-planet-thumb.uranus {
      background-image:
        repeating-linear-gradient(180deg, #cfeeee 0px, #cfeeee 6px, #bfe7e7 6px, #bfe7e7 12px);
    }
    .quiz-planet-thumb.neptune {
      background-image:
        repeating-linear-gradient(180deg, #4a4cd6 0px, #4a4cd6 6px, #3c40c0 6px, #3c40c0 12px, #6b6df0 12px, #6b6df0 18px);
    }

    .quiz-planet-thumb {
      width: 26px;
      height: 26px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      box-shadow: 0 0 6px rgba(0,0,0,0.6);
      border: 1px solid rgba(255,255,255,0.2);
      display: inline-block;
      vertical-align: middle;
      margin-right: 8px;
    }

    .truth-table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      overflow: hidden;
      font-size: 0.9rem;
    }
    
    .truth-table th, .truth-table td {
      padding: 10px;
      border: 1px solid rgba(255,255,255,0.1);
      text-align: left;
    }
    
    .truth-table th { background: rgba(255,255,255,0.05); }

    .answer-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn-answer {
      flex: 1;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid var(--accent);
      background: rgba(255, 215, 0, 0.1);
      color: var(--accent);
      font-weight: bold;
      cursor: pointer;
      min-width: 80px;
    }

    .btn-answer:hover { background: var(--accent); color: #000; }
    .btn-answer:disabled { opacity: 0.5; pointer-events: none; }

    .btn-next {
      background: var(--accent);
      color: #000;
      border: none;
      padding: 12px 24px;
      border-radius: 99px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
      margin-top: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .btn-next:disabled { background: #555; color: #999; }

    .btn-outline {
      background: transparent;
      border: 1px solid white;
      color: white;
      padding: 10px 20px;
      border-radius: 99px;
      cursor: pointer;
      margin: 5px;
    }

    .btn-outline:hover { background: rgba(255,255,255,0.1); }

    .quiz-meta {
      background: rgba(255,255,255,0.05);
      padding: 15px;
      border-radius: 12px;
      margin-top: 10px;
    }
    
    .hidden { display: none; }

    .answer-status {
      font-weight: bold;
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
      text-align: center;
    }
    .answer-status.correct { background: rgba(74, 222, 128, 0.2); color: var(--success); }
    .answer-status.incorrect { background: rgba(255, 85, 119, 0.2); color: var(--error); }

    /* Mobile Text Sizes */
    @media (max-width: 480px) {
      .countdown-number { font-size: 3rem; color: var(--accent); }
      .quiz-card { padding: 15px; }
      .planet::after { font-size: 0.8rem; top: 115%; }
    }

  </style>
</head>
<body>
  <div class="app-shell">
    <div class="frame">
      <header class="app-header">
        <!-- Removed music toggle button -->
      </header>

      <main class="stage">
        <div class="solar-system-wrapper" id="sceneWrapper">
          <div id="solarSystem" class="solar-system">
            <div class="nebula-overlay"></div>
            <div class="galaxy-clouds"></div>
            <div class="far-galaxy one"></div>
            <div class="far-galaxy two"></div>
            <div class="deep-stars"></div>
            <div class="starfield"></div>
            <div class="dust-particles"></div>
            
            <div class="comet-container">
              <div class="comet one"></div>
              <div class="comet two"></div>
            </div>
            
            <!-- Orbits -->
            <div class="orbit mercury animate"></div>
            <div class="orbit venus animate"></div>
            <div class="orbit earth animate"></div>
            <div class="orbit mars animate"></div>
            <div class="asteroid-belt animate"></div>
            <div class="orbit jupiter animate"></div>
            <div class="orbit saturn animate"></div>
            <div class="orbit uranus animate"></div>
            <div class="orbit neptune animate"></div>

            <!-- Sun -->
            <div id="sun" class="star" role="button" aria-label="Click the Sun to start mission"></div>

            <!-- Planets -->
            <div class="planet mercury orbiting" data-name="Mercury" data-planet-index="0"><div class="planet-surface"></div><div class="planet-shadow"></div></div>
            <div class="planet venus orbiting" data-name="Venus" data-planet-index="1"><div class="planet-surface"></div><div class="planet-shadow"></div></div>
            <div class="planet earth orbiting" data-name="Earth" data-planet-index="2"><div class="planet-surface"></div><div class="planet-shadow"></div></div>
            <div class="planet mars orbiting" data-name="Mars" data-planet-index="3"><div class="planet-surface"></div><div class="planet-shadow"></div></div>
            <div class="planet jupiter orbiting" data-name="Jupiter" data-planet-index="4"><div class="planet-surface"></div><div class="planet-shadow"></div></div>
            <div class="planet saturn orbiting" data-name="Saturn" data-planet-index="5"><div class="planet-surface"></div><div class="planet-shadow"></div></div>
            <div class="planet uranus orbiting" data-name="Uranus" data-planet-index="6"><div class="planet-surface"></div><div class="planet-shadow"></div></div>
            <div class="planet neptune orbiting" data-name="Neptune" data-planet-index="7"><div class="planet-surface"></div><div class="planet-shadow"></div></div>
          </div>
        </div>

        <!-- Countdown overlay -->
        <div id="countdownOverlay" class="overlay" aria-hidden="true">
          <div class="countdown-panel">
            <h2 style="font-size: 1.5rem; margin-bottom:10px;">Ready?</h2>
            <div id="countdownNumber" class="countdown-number" style="font-size:3rem; font-weight:bold; color:var(--accent);">5</div>
            <p style="color:var(--text-muted); margin:10px 0;">Your logic mission begins in:</p>
            <ul id="countdownFacts" style="text-align:left; font-size:0.9rem; padding-left:20px; line-height:1.5;"></ul>
          </div>
        </div>

        <!-- Quiz card -->
        <div id="quizWrapper" class="quiz-wrapper" aria-hidden="true">
          <article id="quizCard" class="quiz-card" data-planet="">
            <div class="quiz-badge-row" style="display:flex; justify-content:space-between; margin-bottom:10px; color:var(--text-muted); font-size:0.8rem;">
              <span>LOGIC MODULE</span>
              <span>
                Planet 
                <span id="quizPlanetThumb" class="quiz-planet-thumb"></span>
                <span id="quizPlanetName" style="color:var(--accent)"></span>
              </span>
            </div>
            
            <div class="quiz-question-heading" id="questionText" style="font-weight:600; margin-bottom:10px;"></div>

            <div id="pqStatements" style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:6px;">
              <span id="pStatement" style="background:rgba(255,255,255,0.08); padding:6px 10px; border-radius:8px; font-size:0.85rem;">P:</span>
              <span id="qStatement" style="background:rgba(255,255,255,0.08); padding:6px 10px; border-radius:8px; font-size:0.85rem;">Q:</span>
            </div>

            <table class="truth-table">
              <thead>
                <tr>
                  <th style="width: 60%;">Statement</th>
                  <th style="width: 40%;">Truth</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td id="pLabel">P</td>
                  <td id="pValueCell">True</td>
                </tr>
                <tr>
                  <td id="qLabel">Q</td>
                  <td id="qValueCell">True</td>
                </tr>
                <tr>
                  <td>Result of <span id="exprLabel">P ∧ Q</span></td>
                  <td id="truthAnswerCell" style="text-align:center; font-weight:bold; color:var(--accent);">?</td>
                </tr>
              </tbody>
            </table>

            <div class="answer-buttons">
              <button id="btnTrue" class="btn-answer" type="button">True (T)</button>
              <button id="btnFalse" class="btn-answer" type="button">False (F)</button>
            </div>
            
            <div id="answerStatus" class="answer-status"></div>

            <div class="quiz-meta hidden" id="quizMeta">
              <h3 style="font-size:0.9rem; color:var(--accent); margin-bottom:5px;">Explanation</h3>
              <p id="explanationText" style="font-size:0.85rem; margin-bottom:10px;"></p>
              
              <h3 style="font-size:0.9rem; color:var(--accent); margin-bottom:5px;">Did you know?</h3>
              <p id="planetFactText" style="font-size:0.85rem;"></p>
              
              <h3 style="font-size:0.9rem; color:var(--accent); margin:12px 0 6px;">Sources</h3>
              <p style="font-size:0.82rem;">
                <a id="sourceLink" href="#" target="_blank" rel="noopener noreferrer" style="color:var(--accent); text-decoration:underline;">Open NASA source</a>
              </p>
              
              <div style="margin-top:15px; display:flex; flex-direction:column; gap:5px;">
                <span id="progressText" style="font-size:0.7rem; color:var(--text-muted); text-align:center;">Planet 1 of 8</span>
                <button id="btnNext" class="btn-next" type="button" disabled>Next Planet</button>
              </div>
            </div>
          </article>
        </div>

        <!-- Summary -->
        <div id="summaryWrapper" class="summary-wrapper" aria-hidden="true">
          <section class="summary-card" style="text-align:center;">
            <h2 style="font-size: 1.5rem; margin-bottom:10px;">Mission Complete</h2>
            <div id="summaryScore" style="font-size: 3rem; font-weight:700; color:var(--accent);"></div>
            <p id="summaryDetail" style="color:var(--text-muted); margin:10px 0;"></p>
            <div style="display:flex; justify-content:center; gap:10px; margin:15px 0; font-size:0.9rem;">
              <span id="summaryAccuracy" style="background:rgba(255,255,255,0.1); padding:5px 10px; border-radius:99px;"></span>
              <span id="summaryTier" style="background:rgba(255,255,255,0.1); padding:5px 10px; border-radius:99px;"></span>
            </div>
            <div class="summary-actions">
              <button id="btnRestart" class="btn-outline" type="button">Run Again</button>
              <button id="btnVisitSite" class="btn-outline" type="button" style="border-color:var(--accent); color:var(--accent);">Back to Main Site</button>
            </div>
          </section>
        </div>

      </main>
    </div>
  </div>

  <script>
    (function () {
      // --- DATA ---
      const planetQuestionsBank = {
        Mercury: [
          {
            pText: "Mercury is the closest planet to the Sun.",
            qText: "Mercury is the hottest planet.",
            pValue: true, qValue: false,
            expr: "OR", exprDisplay: "P ∨ Q",
            explanation: "P ∨ Q is True because P is True.",
            funFact: "Mercury has extreme temperature swings: very hot days and very cold nights.",
            sourceUrl: "https://solarsystem.nasa.gov/planets/mercury/overview/",
            sourceTitle: "NASA: Mercury Overview"
          }
        ],
        Venus: [
          {
            pText: "Venus rotates in a retrograde (clockwise) direction.",
            qText: "Venus has a very thick atmosphere.",
            pValue: true, qValue: true,
            expr: "AND", exprDisplay: "P ∧ Q",
            explanation: "P ∧ Q is True because both P and Q are True.",
            funFact: "A day on Venus is longer than its year due to slow retrograde rotation.",
            sourceUrl: "https://solarsystem.nasa.gov/planets/venus/overview/",
            sourceTitle: "NASA: Venus Overview"
          }
        ],
        Earth: [
          {
            pText: "Earth has liquid water at its surface.",
            qText: "Earth has two moons.",
            pValue: true, qValue: false,
            expr: "IMPLIES", exprDisplay: "P → Q",
            explanation: "P → Q is False because True → False is False.",
            funFact: "Earth is the only known planet with abundant surface liquid water.",
            sourceUrl: "https://solarsystem.nasa.gov/planets/earth/overview/",
            sourceTitle: "NASA: Earth Overview"
          }
        ],
        Mars: [
          {
            pText: "Mars is the Red Planet.",
            qText: "Mars has two moons.",
            pValue: true, qValue: true,
            expr: "AND", exprDisplay: "P ∧ Q",
            explanation: "P ∧ Q is True because both P and Q are True.",
            funFact: "Mars has two small moons: Phobos and Deimos.",
            sourceUrl: "https://solarsystem.nasa.gov/planets/mars/overview/",
            sourceTitle: "NASA: Mars Overview"
          }
        ],
        Jupiter: [
          {
            pText: "Jupiter is the largest planet.",
            qText: "Jupiter has a solid surface.",
            pValue: true, qValue: false,
            expr: "AND", exprDisplay: "P ∧ Q",
            explanation: "P ∧ Q is False because Q is False.",
            funFact: "Jupiter is the largest planet, with a mass greater than all others combined.",
            sourceUrl: "https://solarsystem.nasa.gov/planets/jupiter/overview/",
            sourceTitle: "NASA: Jupiter Overview"
          }
        ],
        Saturn: [
          {
            pText: "Saturn is a gas giant.",
            qText: "Saturn is the only planet with rings.",
            pValue: true, qValue: false,
            expr: "AND", exprDisplay: "P ∧ Q",
            explanation: "P ∧ Q is False because Q is False.",
            funFact: "Saturn’s rings are the most prominent but other giants have rings too.",
            sourceUrl: "https://solarsystem.nasa.gov/planets/saturn/overview/",
            sourceTitle: "NASA: Saturn Overview"
          }
        ],
        Uranus: [
          {
            pText: "Uranus has rings.",
            qText: "Uranus has no rings.",
            pValue: true, qValue: false,
            expr: "OR", exprDisplay: "P ∨ Q",
            explanation: "P ∨ Q is True because P is True.",
            funFact: "Uranus rotates on its side, likely due to a massive ancient collision.",
            sourceUrl: "https://solarsystem.nasa.gov/planets/uranus/overview/",
            sourceTitle: "NASA: Uranus Overview"
          }
        ],
        Neptune: [
          {
            pText: "Neptune is not visible to the naked eye.",
            qText: "Neptune has strong winds.",
            pValue: true, qValue: true,
            expr: "AND", exprDisplay: "P ∧ Q",
            explanation: "P ∧ Q is True: Neptune requires a telescope and has extreme winds.",
            funFact: "Neptune’s winds can exceed 1,200 mph, the fastest in the solar system.",
            sourceUrl: "https://solarsystem.nasa.gov/planets/neptune/overview/",
            sourceTitle: "NASA: Neptune Overview"
          }
        ]
      };

      // --- SETUP ---
      function getRandomQuestion(planetName) {
        const questions = planetQuestionsBank[planetName] || planetQuestionsBank["Mercury"];
        return questions[Math.floor(Math.random() * questions.length)];
      }

      const planets = [
        { name: "Mercury", ...getRandomQuestion("Mercury") },
        { name: "Venus",   ...getRandomQuestion("Venus") },
        { name: "Earth",   ...getRandomQuestion("Earth") },
        { name: "Mars",    ...getRandomQuestion("Mars") },
        { name: "Jupiter", ...getRandomQuestion("Jupiter") },
        { name: "Saturn",  ...getRandomQuestion("Saturn") },
        { name: "Uranus",  ...getRandomQuestion("Uranus") },
        { name: "Neptune", ...getRandomQuestion("Neptune") }
      ];

      // --- DOM ELEMENTS ---
      const solarSystemEl = document.getElementById("solarSystem");
      const sceneWrapper = document.getElementById("sceneWrapper");
      const sunEl = document.getElementById("sun");
      const countdownOverlay = document.getElementById("countdownOverlay");
      const countdownNumberEl = document.getElementById("countdownNumber");
      const countdownFactsEl = document.getElementById("countdownFacts");
      const quizWrapper = document.getElementById("quizWrapper");
      const quizCard = document.getElementById("quizCard");
      const quizPlanetNameEl = document.getElementById("quizPlanetName");
      const quizPlanetThumbEl = document.getElementById("quizPlanetThumb");
      const questionTextEl = document.getElementById("questionText");
      const pStatementEl = document.getElementById("pStatement");
      const qStatementEl = document.getElementById("qStatement");
      const pValueCellEl = document.getElementById("pValueCell");
      const qValueCellEl = document.getElementById("qValueCell");
      const exprLabelEl = document.getElementById("exprLabel");
      const truthAnswerCellEl = document.getElementById("truthAnswerCell");
      const sourceLinkEl = document.getElementById("sourceLink");
      const btnTrue = document.getElementById("btnTrue");
      const btnFalse = document.getElementById("btnFalse");
      const answerStatusEl = document.getElementById("answerStatus");
      const explanationTextEl = document.getElementById("explanationText");
      const planetFactTextEl = document.getElementById("planetFactText");
      const btnNext = document.getElementById("btnNext");
      const progressTextEl = document.getElementById("progressText");
      const summaryWrapper = document.getElementById("summaryWrapper");
      const summaryScoreEl = document.getElementById("summaryScore");
      const summaryDetailEl = document.getElementById("summaryDetail");
      const summaryAccuracyEl = document.getElementById("summaryAccuracy");
      const summaryTierEl = document.getElementById("summaryTier");
      const btnRestart = document.getElementById("btnRestart");
      const quizMetaEl = document.getElementById("quizMeta");
      const planetElements = Array.from(document.querySelectorAll(".planet"));

      let currentPlanetIndex = 0;
      let score = 0;
      let answersGiven = 0;
      let countdownTimer = null;
      let animationFrameId;

      // --- SCALING LOGIC ---
      const BASE_SIZE = 1000; 
      const MAX_ORBIT_DIAMETER = 820;
      const SAFE_PADDING = 40;

      function handleResize() {
        if (!solarSystemEl) return;
        const availableWidth = window.innerWidth;
        const availableHeight = window.innerHeight;
        const minDimension = Math.min(availableWidth, availableHeight);
        let scaleFactor = (minDimension - SAFE_PADDING) / MAX_ORBIT_DIAMETER;
        scaleFactor = Math.max(0.6, Math.min(scaleFactor, 1.2));
        solarSystemEl.style.transform = `scale(${scaleFactor})`;
      }

      window.addEventListener('resize', handleResize);
      window.addEventListener('orientationchange', handleResize);
      setTimeout(handleResize, 100);

      // --- PERFORMANCE MODE ---
      function detectPerformanceMode() {
        const cores = navigator.hardwareConcurrency || 2;
        const isMobile = /Android|Mobi|iPhone|iPad/i.test(navigator.userAgent);
        const dpr = window.devicePixelRatio || 1;
        return (cores <= 4) || (isMobile && dpr >= 2) ? "low" : "high";
      }
      const performanceMode = detectPerformanceMode();
      if (performanceMode === "low") {
        solarSystemEl.classList.add("low-performance");
      }

      // --- ORBIT LOGIC ---
      const orbitRadii = [80, 110, 145, 180, 260, 310, 360, 410];
      const orbitSpeeds = [4.1, 1.6, 1.0, 0.53, 0.35, 0.18, 0.095, 0.055];

      let lastTick = 0;
      const targetFrameMs = performanceMode === "low" ? 50 : 16;

      function animateOrbits(timestamp) {
        if ((timestamp - lastTick) < targetFrameMs) {
          animationFrameId = window.requestAnimationFrame(animateOrbits);
          return;
        }
        lastTick = timestamp;
        const orbitTime = timestamp * 0.0002;
        const centerX = 500; 
        const centerY = 500;

        planetElements.forEach((el, index) => {
          const radius = orbitRadii[index];
          const speed = orbitSpeeds[index];
          const angle = orbitTime * speed + index * 0.9;
          
          const x = centerX + radius * Math.cos(angle);
          const y = centerY + radius * Math.sin(angle);

          el.style.left = `${x}px`;
          el.style.top = `${y}px`;
          el.style.transform = `translate(-50%, -50%)`;
          
          // Set rotation for shadow (opposite to sun angle)
          el.style.setProperty('--angle', `${angle}rad`);
        });

        animationFrameId = window.requestAnimationFrame(animateOrbits);
      }
      
      function startOrbitAnimation() {
        if (!animationFrameId) {
          animationFrameId = window.requestAnimationFrame(animateOrbits);
        }
      }
      function stopOrbitAnimation() {
        if (animationFrameId) {
          window.cancelAnimationFrame(animationFrameId);
          animationFrameId = null;
        }
      }
      startOrbitAnimation();

      // --- GAMEPLAY FUNCTIONS ---

      function highlightCurrentPlanet(index) {
        planetElements.forEach((el) => el.classList.remove("highlighted"));
        const match = planetElements.find((el) => Number(el.dataset.planetIndex) === index);
        if (match) { match.classList.add("highlighted"); }
      }

      function startCountdown() {
        document.body.classList.add("top-down-view");
        stopOrbitAnimation();
        
        const facts = [
            "Inner planets are rock; outer planets are gas/ice.",
            "The Sun is 99% of the solar system's mass.",
            "Jupiter spins the fastest of all planets."
        ];
        
        countdownFactsEl.innerHTML = "";
        facts.forEach(f => {
            const li = document.createElement("li");
            li.textContent = f;
            li.style.marginBottom = "5px";
            countdownFactsEl.appendChild(li);
        });

        countdownNumberEl.textContent = "5";
        countdownOverlay.classList.add("visible");
        countdownOverlay.setAttribute("aria-hidden", "false");

        let remaining = 5;
        if(countdownTimer) clearInterval(countdownTimer);
        
        countdownTimer = setInterval(() => {
          remaining -= 1;
          countdownNumberEl.textContent = String(remaining);
          if (remaining <= 0) {
            clearInterval(countdownTimer);
            beginQuiz();
          }
        }, 1000);
      }

      function beginQuiz() {
        countdownOverlay.classList.remove("visible");
        countdownOverlay.setAttribute("aria-hidden", "true");
        solarSystemEl.classList.remove("dimmed");
        startOrbitAnimation();
        
        currentPlanetIndex = 0;
        score = 0;
        answersGiven = 0;
        summaryWrapper.classList.remove("visible");
        summaryWrapper.setAttribute("aria-hidden", "true");

        showQuestionForPlanet(currentPlanetIndex);
      }

      function evalExpr(expr, p, q) {
        if (expr === "AND") return p && q;
        if (expr === "OR") return p || q;
        if (expr === "IMPLIES") return (!p || q);
        if (expr === "NOT_P_AND_Q") return (!p && q);
        return false;
      }

      /* simplified UI: no full truth table */

      function showQuestionForPlanet(index) {
        const planet = planets[index];
        if (!planet) return;

        highlightCurrentPlanet(index);

        quizCard.dataset.planet = planet.name;
        quizPlanetNameEl.textContent = planet.name;
        if (quizPlanetThumbEl) {
          const cls = planet.name.toLowerCase();
          quizPlanetThumbEl.className = `quiz-planet-thumb ${cls}`;
        }
        questionTextEl.textContent = `Evaluate: ${planet.exprDisplay}`;
        pStatementEl.textContent = `P: ${planet.pText}`;
        qStatementEl.textContent = `Q: ${planet.qText}`;
        exprLabelEl.textContent = planet.exprDisplay;
        pValueCellEl.textContent = planet.pValue ? "True" : "False";
        qValueCellEl.textContent = planet.qValue ? "True" : "False";
        if (sourceLinkEl && planet.sourceUrl) {
          sourceLinkEl.href = planet.sourceUrl;
          sourceLinkEl.textContent = planet.sourceTitle || "Open NASA source";
        }
        planet.correctIsTrue = evalExpr(planet.expr, planet.pValue, planet.qValue);
        truthAnswerCellEl.textContent = "?";
        truthAnswerCellEl.style.color = "var(--accent)";

        explanationTextEl.textContent = "";
        planetFactTextEl.textContent = "";
        quizMetaEl.classList.add("hidden");

        answerStatusEl.textContent = "";
        answerStatusEl.className = "answer-status";

        btnTrue.disabled = false;
        btnFalse.disabled = false;
        btnNext.disabled = true;

        progressTextEl.textContent = `Planet ${index + 1} of ${planets.length}`;
        quizWrapper.classList.add("visible");
        quizWrapper.setAttribute("aria-hidden", "false");
      }

      function handleAnswer(isTrueSelected) {
        const planet = planets[currentPlanetIndex];
        
        truthAnswerCellEl.textContent = isTrueSelected ? "T" : "F";
        const correct = planet.correctIsTrue === isTrueSelected;
        
        truthAnswerCellEl.style.color = correct ? "var(--success)" : "var(--error)";

        if (correct) {
          score++;
          answerStatusEl.textContent = "CORRECT";
          answerStatusEl.classList.add("correct");
        } else {
          answerStatusEl.textContent = "INCORRECT";
          answerStatusEl.classList.add("incorrect");
        }

        explanationTextEl.textContent = planet.explanation;
        planetFactTextEl.textContent = planet.funFact;
        quizMetaEl.classList.remove("hidden");

        btnTrue.disabled = true;
        btnFalse.disabled = true;
        btnNext.disabled = false;
      }

      function goToNextPlanet() {
        if (currentPlanetIndex + 1 >= planets.length) {
          finishMission();
        } else {
          currentPlanetIndex++;
          showQuestionForPlanet(currentPlanetIndex);
        }
      }

      function finishMission() {
        quizWrapper.classList.remove("visible");
        quizWrapper.setAttribute("aria-hidden", "true");
        planetElements.forEach(el => el.classList.remove("highlighted"));
        stopOrbitAnimation();

        const accuracy = Math.round((score / planets.length) * 100);
        summaryScoreEl.textContent = `${score} / ${planets.length}`;
        summaryDetailEl.textContent = "Mission Debrief Complete";
        summaryAccuracyEl.textContent = `Accuracy: ${accuracy}%`;
        
        if (accuracy === 100) summaryTierEl.textContent = "Rank: Admiral";
        else if (accuracy >= 75) summaryTierEl.textContent = "Rank: Commander";
        else if (accuracy >= 50) summaryTierEl.textContent = "Rank: Pilot";
        else summaryTierEl.textContent = "Rank: Cadet";

        summaryWrapper.classList.add("visible");
        summaryWrapper.setAttribute("aria-hidden", "false");
      }

      function restartMission() {
        summaryWrapper.classList.remove("visible");
        summaryWrapper.setAttribute("aria-hidden", "true");
        document.body.classList.remove("top-down-view");
        
        handleResize();
      }

      // --- EVENTS ---
      sunEl.addEventListener("click", startCountdown);
      document.addEventListener("visibilitychange", () => {
        if (document.hidden) stopOrbitAnimation();
        else startOrbitAnimation();
      });
      btnTrue.addEventListener("click", () => handleAnswer(true));
      btnFalse.addEventListener("click", () => handleAnswer(false));
      btnNext.addEventListener("click", goToNextPlanet);
      btnRestart.addEventListener("click", restartMission);
      
      document.getElementById('btnVisitSite').addEventListener('click', function() {
        window.open('https://sirp0o0kiebear.wixsite.com/solar-system', '_blank');
      });

    })();
  </script>
</body>
</html>
